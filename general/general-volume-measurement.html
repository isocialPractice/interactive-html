<html lang="en">
<!-- InstanceBegin template="/Templates/page.html" codeOutsideHTMLIsLocked="true" -->
<head>
<link rel="stylesheet" href="https://isocialpractice.github.io/interactive-html/css/style.css">
<link rel="icon" type="image/svg+xml" href="https://isocialpractice.github.io/interactive-html/img/favicon.svg">
<!-- InstanceBeginEditable name="head" -->
  <title>Volume Measurement Tracker</title>
  <style>
   * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
  }
  body {
   font-family: 'Inter', 'Segoe UI', -apple-system, system-ui, sans-serif;
   background: linear-gradient(135deg, #E6F2FF 0%, #F5F7FA 100%);
   color: #1A1A1A;
   min-height: 100vh;
   padding: 24px;
  }
  .container {
   background: #FFFFFF;
   border-radius: 16px;
   padding: 32px;
   max-width: 1400px;
   margin: 0 auto;
   box-shadow: 0 8px 24px rgba(0,0,0,0.12);
   border: 1px solid #E1E4E8;
  }
  h1 {
   text-align: center;
   color: #004080;
   margin-bottom: 8px;
   font-weight: 700;
   font-size: 28px;
   display: flex;
   align-items: center;
   justify-content: center;
   gap: 12px;
  }
  .subtitle {
   text-align: center;
   color: #6C757D;
   margin-bottom: 32px;
   font-size: 15px;
   font-weight: 500;
  }
  .controls-section {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
   gap: 20px;
   margin: 24px 0;
  }
  .control-group {
   display: flex;
   flex-direction: column;
  }
  label {
   margin-bottom: 8px;
   font-weight: 600;
   color: #1A1A1A;
   font-size: 14px;
  }
   input[type="number"],
   input[type="date"],
   input[type="text"],
  select {
   padding: 12px 16px;
   border-radius: 8px;
   border: 2px solid #E1E4E8;
   background: #FFFFFF;
   color: #1A1A1A;
   font-size: 16px;
   transition: all 0.2s ease;
  }
   input:focus, select:focus {
   outline: none;
   border-color: #0066CC;
   box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
  }
  .btn-group {
   display: flex;
   gap: 12px;
   margin: 24px 0;
   flex-wrap: wrap;
  }
  button {
   padding: 12px 24px;
   border: none;
   border-radius: 8px;
   background: #0066CC;
   color: #fff;
   font-size: 16px;
   font-weight: 600;
   cursor: pointer;
   transition: all 0.2s ease;
   box-shadow: 0 2px 8px rgba(0,102,204,0.2);
  }
  button:hover {
   background: #004080;
   transform: translateY(-1px);
  }
  button.secondary {
   background: #6C757D;
  }
  button.danger {
   background: #DC3545;
  }
  .visualization {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
   gap: 24px;
   margin: 32px 0;
  }
  .tank-container {
   background: #F5F7FA;
   border-radius: 12px;
   padding: 20px;
   border: 2px solid #E1E4E8;
   text-align: center;
  }
  .tank-title {
   font-weight: 600;
   color: #004080;
   margin-bottom: 16px;
   font-size: 16px;
  }
  .tank {
   width: 100%;
   height: 300px;
   border: 3px solid #1A1A1A;
   border-radius: 8px;
   position: relative;
   background: linear-gradient(180deg, #FFFFFF 0%, #F5F7FA 100%);
   overflow: hidden;
  }
  .tank-fill {
   position: absolute;
   bottom: 0;
   width: 100%;
   background: linear-gradient(180deg, #0099FF 0%, #0066CC 100%);
   transition: height 0.5s ease;
   display: flex;
   align-items: center;
   justify-content: center;
   color: white;
   font-weight: 700;
   font-size: 18px;
  }
  .tank-marker {
   position: absolute;
   width: 100%;
   border-top: 2px dashed #DC3545;
   left: 0;
   z-index: 10;
  }
  .tank-marker-label {
   position: absolute;
   right: 8px;
   top: -10px;
   background: #DC3545;
   color: white;
   padding: 2px 8px;
   border-radius: 4px;
   font-size: 12px;
   font-weight: 600;
  }
  .tank-info {
   margin-top: 12px;
   font-size: 14px;
   color: #6C757D;
  }
  .data-table {
   overflow-x: auto;
   margin: 32px 0;
  }
  table {
   width: 100%;
   border-collapse: collapse;
   font-size: 14px;
  }
  thead {
   background: #004080;
   color: white;
  }
   th, td {
   padding: 12px;
   text-align: left;
   border: 1px solid #E1E4E8;
  }
   tbody tr:nth-child(even) {
   background: #F5F7FA;
  }
   tbody tr:hover {
   background: #E6F2FF;
  }
  .range-0 { background-color: rgba(0, 102, 204, 0.1); }
  .range-1 { background-color: rgba(40, 167, 69, 0.1); }
  .range-2 { background-color: rgba(255, 193, 7, 0.1); }
  .range-3 { background-color: rgba(220, 53, 69, 0.1); }
  .range-4 { background-color: rgba(111, 66, 193, 0.1); }
  .range-5 { background-color: rgba(255, 133, 27, 0.1); }
  .limit-reached {
   font-weight: 700;
   color: #28A745;
  }
  .action-trigger {
   background-color: #FFF3CD;
   font-weight: 700;
   color: #856404;
  }
  .info-box {
   background: #E6F2FF;
   border-left: 4px solid #0066CC;
   padding: 16px 20px;
   margin: 24px 0;
   font-size: 14px;
   color: #004080;
   border-radius: 8px;
   line-height: 1.6;
  }
  .summary-cards {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
   gap: 20px;
   margin: 24px 0;
  }
  .summary-card {
   background: linear-gradient(135deg, #0066CC 0%, #004080 100%);
   color: white;
   padding: 20px;
   border-radius: 12px;
   text-align: center;
  }
  .summary-card-value {
   font-size: 32px;
   font-weight: 700;
   margin: 8px 0;
  }
  .summary-card-label {
   font-size: 14px;
   opacity: 0.9;
  }
  .chart-container {
   background: #F5F7FA;
   border-radius: 12px;
   padding: 24px;
   margin: 24px 0;
   border: 1px solid #E1E4E8;
  }
  .bar-chart {
   display: flex;
   align-items: flex-end;
   justify-content: space-around;
   height: 300px;
   gap: 8px;
   padding: 20px 0;
   border-bottom: 2px solid #1A1A1A;
  }
  .bar {
   flex: 1;
   max-width: 60px;
   background: linear-gradient(180deg, #0066CC 0%, #004080 100%);
   border-radius: 4px 4px 0 0;
   position: relative;
   transition: all 0.3s ease;
   min-height: 10px;
  }
  .bar:hover {
   opacity: 0.8;
  }
  .bar-label {
   position: absolute;
   bottom: -25px;
   left: 50%;
   transform: translateX(-50%);
   font-size: 11px;
   color: #6C757D;
   white-space: nowrap;
  }
  .bar-value {
   position: absolute;
   top: -25px;
   left: 50%;
   transform: translateX(-50%);
   font-size: 12px;
   font-weight: 600;
   color: #1A1A1A;
   white-space: nowrap;
  }
  </style>

<!-- InstanceEndEditable -->
</head>

<body>
 <nav class="site-nav">
  <div class="nav-container">
   <a href="https://isocialpractice.github.io/interactive-html/index.html" class="nav-brand">
    <img src="https://isocialpractice.github.io/interactive-html/img/favicon.svg" alt="Electronics Tools" class="nav-logo">
    <span>Interactive Tools</span>
   </a>
   <button class="nav-toggle" aria-label="Toggle menu" onclick="document.querySelector('.nav-menu').classList.toggle('active')">‚ò∞</button>
   <ul class="nav-menu">
    <li class="nav-item">
     <a href="https://isocialpractice.github.io/interactive-html/index.html" class="nav-link"><span>üè†</span> <span>Home</span></a>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/555/index.html" class="nav-link dropdown-toggle"><span>‚è±Ô∏è</span> <span>555 Timer</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/555/555-timer-simulator.html" class="nav-link">Interactive Simulator</a>
      <a href="https://isocialpractice.github.io/interactive-html/555/555-astable-calculator.html" class="nav-link">Astable Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/555/555-monostable-simulator.html" class="nav-link">Monostable Simulator</a>
      <a href="https://isocialpractice.github.io/interactive-html/555/555-logic-simulator.html" class="nav-link">Clock Logic Simulator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/electronics/index.html#resistorTools" class="nav-link dropdown-toggle"><span>üîå</span> <span>Resistors</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-resistor-calculator.html" class="nav-link">Color Code Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-parallel-resistor-calculator.html" class="nav-link">Parallel Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-fusible-resistor-calculator.html" class="nav-link">Fusible Calculator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/electronics/index.html#ledAndPowerTools" class="nav-link dropdown-toggle"><span>üí°</span> <span>LED & Power</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-ohms-law-calculator.html" class="nav-link">Ohm's Law</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-led-current-calculator.html" class="nav-link">LED Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-voltage-divider-calculator.html" class="nav-link">Voltage Divider</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-varistor-simulator.html" class="nav-link">Varistor Simulator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a ef="https://isocialpractice.github.io/interactive-html/electronics/index.html#components" class="nav-link dropdown-toggle"><span>üîß</span> <span>Components</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-potentiometer-simulator.html" class="nav-link">Potentiometer Simulator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-potentiometer-decoder.html" class="nav-link">Potentiometer Decoder</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-surface-mount-decoder.html" class="nav-link">SMD Decoder</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-breadboard-simulator.html" class="nav-link">Breadboard Simulator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/general/index.html" class="nav-link dropdown-toggle"><span>üìê</span> <span>General</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/general/general-volume-measurement.html" class="nav-link">Volume Measurement</a>
      <a href="https://isocialpractice.github.io/interactive-html/general/general-area-and-perimeter-calculator.html" class="nav-link">Area & Perimeter</a>
     </div>
    </li>
   </ul>
  </div>
 </nav>

<!-- InstanceBeginEditable name="page" -->
  <div class="container">
   <h1>üìä Volume Measurement Tracker</h1>
   <div class="subtitle">Track volume changes and determine operation triggers based on cumulative decreases</div>

   <div class="info-box">
    <strong>How it works:</strong> This tool tracks a tank's volume that increases and decreases daily.
    When the sum of decreases reaches or exceeds an increase amount, a new increase range begins.
    This helps determine optimal timing for operations like changing prices or making orders.
   </div>

   <div class="summary-cards">
    <div class="summary-card">
     <div class="summary-card-label">Current Volume</div>
     <div class="summary-card-value" id="currentVolume">0</div>
     <div class="summary-card-label" id="currentVolumeUnit">gallons</div>
    </div>
    <div class="summary-card">
     <div class="summary-card-label">Current Range</div>
     <div class="summary-card-value" id="currentRange">0</div>
    </div>
    <div class="summary-card">
     <div class="summary-card-label">Total Entries</div>
     <div class="summary-card-value" id="totalEntries">0</div>
    </div>
    <div class="summary-card">
     <div class="summary-card-label">Limit Triggers</div>
     <div class="summary-card-value" id="limitTriggers">0</div>
    </div>
   </div>

   <h2 style="margin-top: 32px; color: #004080;">Add New Entry</h2>
   <div class="controls-section">
    <div class="control-group">
     <label>Date</label>
     <input type="date" id="entryDate" />
    </div>
    <div class="control-group">
     <label>Day of Week</label>
     <select id="entryDay">
      <option value="Monday">Monday</option>
      <option value="Tuesday">Tuesday</option>
      <option value="Wednesday">Wednesday</option>
      <option value="Thursday">Thursday</option>
      <option value="Friday">Friday</option>
      <option value="Saturday">Saturday</option>
      <option value="Sunday">Sunday</option>
     </select>
    </div>
    <div class="control-group">
     <label>Volume Unit</label>
     <select id="volumeUnit">
      <option value="gallons">Gallons</option>
      <option value="liters">Liters</option>
      <option value="cubic feet">Cubic Feet</option>
      <option value="cubic meters">Cubic Meters</option>
     </select>
    </div>
   </div>

   <div class="controls-section">
    <div class="control-group">
     <label>Decrease Amount</label>
     <input type="number" id="decreaseAmount" min="0" step="0.01" placeholder="0" />
    </div>
    <div class="control-group">
     <label>Increase Amount (when limit reached)</label>
     <input type="number" id="increaseAmount" min="0" step="0.01" placeholder="0" />
    </div>
    <div class="control-group">
     <label>Initial Volume (first entry only)</label>
     <input type="number" id="initialVolume" min="0" step="0.01" placeholder="0" />
    </div>
   </div>

   <div class="btn-group">
    <button onclick="addEntry()">Add Entry</button>
    <button class="secondary" onclick="loadSampleData()">Load Sample Data</button>
    <button class="danger" onclick="clearAllData()">Clear All Data</button>
    <button class="secondary" onclick="exportData()">Export Data</button>
   </div>

   <h2 style="margin-top: 32px; color: #004080;">Volume Visualization</h2>
   <div class="visualization" id="tankVisualization">
    <!-- Tanks will be dynamically generated -->
   </div>

   <h2 style="margin-top: 32px; color: #004080;">Volume Chart</h2>
   <div class="chart-container">
    <div class="bar-chart" id="barChart">
     <!-- Bars will be dynamically generated -->
    </div>
   </div>

   <h2 style="margin-top: 32px; color: #004080;">Data Table</h2>
   <div class="data-table">
    <table id="dataTable">
     <thead>
      <tr>
       <th>Range</th>
       <th>Count</th>
       <th>Resetter</th>
       <th>Limit Reached</th>
       <th>Date</th>
       <th>Day</th>
       <th>Begin Volume</th>
       <th>Decrease</th>
       <th>Increase</th>
       <th>End Volume</th>
       <th>Actions</th>
      </tr>
     </thead>
     <tbody id="tableBody">
      <!-- Rows will be dynamically generated -->
     </tbody>
    </table>
   </div>

   <div class="info-box" style="margin-top: 32px;">
    <strong>Understanding the System:</strong>
    <ul style="margin: 10px 0; padding-left: 20px;">
     <li><strong>Range:</strong> A period that starts when a new increase is applied</li>
     <li><strong>Resetter:</strong> Cumulative sum of decreases in current range</li>
     <li><strong>Limit Reached:</strong> Triggers when resetter sum ‚â• previous increase amount</li>
     <li><strong>Count:</strong> Entry number within the current range</li>
     <li><strong>Operation Trigger:</strong> When limit is reached, it signals optimal time for price changes or orders</li>
    </ul>
   </div>
  </div>

  <script>
  let entries = [];
  let currentRangeIndex = 0;
  let currentRangeResetter = 0;
  let lastIncrease = 0;

  // Initialize with today's date
  document.addEventListener('DOMContentLoaded', function() {
   const today = new Date().toISOString().split('T')[0];
   document.getElementById('entryDate').value = today;
   updateDayFromDate();
   loadFromLocalStorage();
   updateDisplay();
  });

  // Auto-update day when date changes
  document.getElementById('entryDate').addEventListener('change', updateDayFromDate);

  function updateDayFromDate() {
   const dateInput = document.getElementById('entryDate').value;
   if (dateInput) {
    const date = new Date(dateInput + 'T12:00:00');
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    document.getElementById('entryDay').value = days[date.getDay()];
   }
  }

  function addEntry() {
   const date = document.getElementById('entryDate').value;
   const day = document.getElementById('entryDay').value;
   const decrease = parseFloat(document.getElementById('decreaseAmount').value) || 0;
   const increase = parseFloat(document.getElementById('increaseAmount').value) || 0;
   const initial = parseFloat(document.getElementById('initialVolume').value) || 0;
   const unit = document.getElementById('volumeUnit').value;

   if (!date) {
    alert('Please enter a date');
    return;
   }

   let beginVolume = 0;
   let count = 0;
   let limitReached = false;
   let resetterDisplay = 0;

   if (entries.length === 0) {
    // First entry
    if (initial <= 0) {
     alert('Please enter an initial volume for the first entry');
     return;
    }
    beginVolume = initial;
    count = 0;
    resetterDisplay = 0;
    currentRangeResetter = 0;
    lastIncrease = 0;

    // If first entry has an increase, set it
    if (increase > 0) {
     lastIncrease = increase;
     // Reset accumulator after this increase
     currentRangeResetter = 0;
    }
   } else {
   // Get the last entry's end volume
   const lastEntry = entries[entries.length - 1];
   beginVolume = lastEntry.endVolume;
   count = lastEntry.count + 1;

   // Check if previous entry had an increase
   if (lastEntry.increase > 0) {
    // Previous entry had increase, so reset the accumulator
    currentRangeResetter = 0;
    resetterDisplay = 0;
   } else {
   // Display current accumulated value (before adding this row's decrease)
   resetterDisplay = currentRangeResetter;
  }

  // Add current decrease to accumulator
  const newAccumulated = currentRangeResetter + decrease;

  // Check if limit is reached (only if we have a previous increase to compare against)
  if (lastIncrease > 0 && newAccumulated >= lastIncrease) {
   limitReached = true;
   // Reset accumulator for next entries
   currentRangeResetter = 0;
   // If there's an increase on this row, update lastIncrease
   if (increase > 0) {
    lastIncrease = increase;
    currentRangeIndex++;
    count = 0;
   }
  } else {
  // Update accumulator
  currentRangeResetter = newAccumulated;
  // If there's an increase on this row without limit being reached
  if (increase > 0) {
   lastIncrease = increase;
   currentRangeIndex++;
   count = 0;
   // Reset accumulator after increase
   currentRangeResetter = 0;
  }
  }
  }

  const endVolume = beginVolume - decrease + increase;

  const entry = {
   range: currentRangeIndex,
   count: count,
   resetter: resetterDisplay,
   limitReached: limitReached,
   date: date,
   day: day,
   beginVolume: beginVolume,
   decrease: decrease,
   increase: increase,
   endVolume: endVolume,
   unit: unit
  };

  entries.push(entry);
  saveToLocalStorage();
  updateDisplay();

  // Clear input fields
  document.getElementById('decreaseAmount').value = '';
  document.getElementById('increaseAmount').value = '';
  document.getElementById('initialVolume').value = '';

  // Set next date
  const nextDate = new Date(date);
  nextDate.setDate(nextDate.getDate() + 1);
  document.getElementById('entryDate').value = nextDate.toISOString().split('T')[0];
  updateDayFromDate();
  }

  function updateDisplay() {
   updateSummaryCards();
   updateTable();
   updateVisualization();
   updateChart();
  }

  function updateSummaryCards() {
   const current = entries.length > 0 ? entries[entries.length - 1] : null;
   document.getElementById('currentVolume').textContent = current ? current.endVolume.toFixed(0) : '0';
   document.getElementById('currentVolumeUnit').textContent = current ? current.unit : 'gallons';
   document.getElementById('currentRange').textContent = current ? current.range : '0';
   document.getElementById('totalEntries').textContent = entries.length;
   document.getElementById('limitTriggers').textContent = entries.filter(e => e.limitReached).length;
  }

  function updateTable() {
   const tbody = document.getElementById('tableBody');
   tbody.innerHTML = '';

   entries.forEach((entry, index) => {
    const row = document.createElement('tr');
    row.className = `range-${entry.range % 6}`;
    if (entry.limitReached) {
     row.classList.add('action-trigger');
    }

    row.innerHTML = `
    <td>${entry.range}</td>
    <td>${entry.count}</td>
    <td>${entry.resetter.toFixed(0)}</td>
    <td class="${entry.limitReached ? 'limit-reached' : ''}">${entry.limitReached ? 'Yes' : 'No'}</td>
    <td>${entry.date}</td>
    <td>${entry.day}</td>
    <td>${entry.beginVolume.toFixed(0)}</td>
    <td>${entry.decrease.toFixed(0)}</td>
    <td>${entry.increase.toFixed(0)}</td>
    <td>${entry.endVolume.toFixed(0)}</td>
    <td><button class="danger" onclick="deleteEntry(${index})" style="padding: 6px 12px; font-size: 12px;">Delete</button></td>
    `;
    tbody.appendChild(row);
   });
  }

  function updateVisualization() {
   const container = document.getElementById('tankVisualization');
   container.innerHTML = '';

   // Get unique ranges
   const ranges = [...new Set(entries.map(e => e.range))];
   const recentRanges = ranges.slice(-5); // Show last 5 ranges

   recentRanges.forEach(rangeNum => {
    const rangeEntries = entries.filter(e => e.range === rangeNum);
    const lastEntry = rangeEntries[rangeEntries.length - 1];
    const maxVolume = Math.max(...entries.map(e => Math.max(e.beginVolume, e.endVolume)));

    const tankDiv = document.createElement('div');
    tankDiv.className = 'tank-container';

    const fillPercent = maxVolume > 0 ? (lastEntry.endVolume / maxVolume) * 100 : 0;
    const markerPercent = maxVolume > 0 ? (lastEntry.resetter / maxVolume) * 100 : 0;

    tankDiv.innerHTML = `
    <div class="tank-title">Range ${rangeNum}</div>
    <div class="tank">
    <div class="tank-marker" style="bottom: ${markerPercent}%;">
    <span class="tank-marker-label">Decrease: ${lastEntry.resetter.toFixed(0)}</span>
    </div>
    <div class="tank-fill" style="height: ${fillPercent}%;">
    ${lastEntry.endVolume.toFixed(0)}
    </div>
    </div>
    <div class="tank-info">
    <div>Count: ${lastEntry.count}</div>
    <div>Status: ${lastEntry.limitReached ? '‚úì Limit Reached' : 'Active'}</div>
    </div>
    `;

    container.appendChild(tankDiv);
   });
  }

  function updateChart() {
   const chartDiv = document.getElementById('barChart');
   chartDiv.innerHTML = '';

   const recentEntries = entries.slice(-15); // Show last 15 entries
   const maxVolume = Math.max(...entries.map(e => Math.max(e.beginVolume, e.endVolume)));

   recentEntries.forEach(entry => {
    const bar = document.createElement('div');
    bar.className = 'bar';
    const heightPercent = maxVolume > 0 ? (entry.endVolume / maxVolume) * 100 : 0;
    bar.style.height = `${heightPercent}%`;

    const colors = ['#0066CC', '#28A745', '#FFC107', '#DC3545', '#6F42C1', '#FF851B'];
    bar.style.background = `linear-gradient(180deg, ${colors[entry.range % 6]} 0%, ${colors[entry.range % 6]}CC 100%)`;

    bar.innerHTML = `
    <span class="bar-value">${entry.endVolume.toFixed(0)}</span>
    <span class="bar-label">${entry.date.substring(5)}</span>
    `;

    chartDiv.appendChild(bar);
   });
  }

  function deleteEntry(index) {
   if (confirm('Are you sure you want to delete this entry?')) {
    entries.splice(index, 1);
    recalculateAllEntries();
    saveToLocalStorage();
    updateDisplay();
   }
  }

  function recalculateAllEntries() {
   // Recalculate all ranges and resetters
   currentRangeIndex = 0;
   currentRangeResetter = 0;
   lastIncrease = 0;

   for (let i = 0; i < entries.length; i++) {
    const entry = entries[i];

    if (i === 0) {
     entry.range = 0;
     entry.count = 0;
     entry.resetter = 0;
     entry.limitReached = false;
     currentRangeResetter = 0;

     // If first entry has increase, set it and reset accumulator
     if (entry.increase > 0) {
      lastIncrease = entry.increase;
      currentRangeResetter = 0;
     }
    } else {
    const prevEntry = entries[i - 1];
    entry.beginVolume = prevEntry.endVolume;
    entry.count = prevEntry.count + 1;

    // Check if previous entry had an increase
    if (prevEntry.increase > 0) {
     // Previous entry had increase, so reset the accumulator
     currentRangeResetter = 0;
     entry.resetter = 0;
    } else {
    // Display current accumulated value (before adding this row's decrease)
    entry.resetter = currentRangeResetter;
   }

   // Add current decrease to accumulator
   const newAccumulated = currentRangeResetter + entry.decrease;

   // Check if limit is reached (only if we have a previous increase to compare against)
   if (lastIncrease > 0 && newAccumulated >= lastIncrease) {
    entry.limitReached = true;
    entry.range = currentRangeIndex;
    // Reset accumulator for next entries
    currentRangeResetter = 0;
    // If there's an increase on this row, update lastIncrease and range
    if (entry.increase > 0) {
     lastIncrease = entry.increase;
     currentRangeIndex++;
     entry.range = currentRangeIndex;
     entry.count = 0;
    }
   } else {
   entry.limitReached = false;
   entry.range = currentRangeIndex;
   // Update accumulator
   currentRangeResetter = newAccumulated;
   // If there's an increase on this row without limit being reached
   if (entry.increase > 0) {
    lastIncrease = entry.increase;
    currentRangeIndex++;
    entry.range = currentRangeIndex;
    entry.count = 0;
    // Reset accumulator after increase
    currentRangeResetter = 0;
   }
  }
  }

  entry.endVolume = entry.beginVolume - entry.decrease + entry.increase;
  }
  }

  function clearAllData() {
   if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
    entries = [];
    currentRangeIndex = 0;
    currentRangeResetter = 0;
    lastIncrease = 0;
    saveToLocalStorage();
    updateDisplay();
   }
  }

  function loadSampleData() {
   if (entries.length > 0 && !confirm('This will clear existing data. Continue?')) {
    return;
   }

   entries = [
   {range: 0, count: 0, resetter: 0, limitReached: false, date: '2022-10-03', day: 'Monday', beginVolume: 13570, decrease: 2935, increase: 0, endVolume: 10635, unit: 'gallons'},
   {range: 0, count: 1, resetter: 2935, limitReached: false, date: '2022-10-04', day: 'Tuesday', beginVolume: 10635, decrease: 3368, increase: 0, endVolume: 7267, unit: 'gallons'},
   {range: 0, count: 2, resetter: 6303, limitReached: false, date: '2022-10-05', day: 'Wednesday', beginVolume: 7267, decrease: 2750, increase: 0, endVolume: 4517, unit: 'gallons'},
   {range: 1, count: 0, resetter: 0, limitReached: true, date: '2022-10-06', day: 'Thursday', beginVolume: 4517, decrease: 2912, increase: 7420, endVolume: 9025, unit: 'gallons'},
   {range: 1, count: 1, resetter: 2912, limitReached: false, date: '2022-10-07', day: 'Friday', beginVolume: 9025, decrease: 1660, increase: 0, endVolume: 7365, unit: 'gallons'},
   {range: 1, count: 2, resetter: 4572, limitReached: false, date: '2022-10-08', day: 'Saturday', beginVolume: 7365, decrease: 955, increase: 0, endVolume: 6410, unit: 'gallons'},
   {range: 2, count: 0, resetter: 0, limitReached: true, date: '2022-10-09', day: 'Sunday', beginVolume: 6410, decrease: 84, increase: 7620, endVolume: 13946, unit: 'gallons'},
   {range: 2, count: 1, resetter: 84, limitReached: false, date: '2022-10-10', day: 'Monday', beginVolume: 13946, decrease: 3717, increase: 0, endVolume: 10229, unit: 'gallons'}
   ];

   // Recalculate to ensure consistency
   currentRangeIndex = 2;
   currentRangeResetter = 84;
   lastIncrease = 7620;

   saveToLocalStorage();
   updateDisplay();
  }

  function exportData() {
   const csv = ['Range,Count,Resetter,Limit Reached,Date,Day,Begin Volume,Decrease,Increase,End Volume,Unit'];
   entries.forEach(entry => {
    csv.push(`${entry.range},${entry.count},${entry.resetter.toFixed(2)},${entry.limitReached ? 'Yes' : 'No'},${entry.date},${entry.day},${entry.beginVolume.toFixed(2)},${entry.decrease.toFixed(2)},${entry.increase.toFixed(2)},${entry.endVolume.toFixed(2)},${entry.unit}`);
   });

   const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
   const url = window.URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url;
   a.download = `volume-measurement-${new Date().toISOString().split('T')[0]}.csv`;
   a.click();
   window.URL.revokeObjectURL(url);
  }

  function saveToLocalStorage() {
   localStorage.setItem('volumeMeasurementEntries', JSON.stringify(entries));
   localStorage.setItem('volumeMeasurementState', JSON.stringify({
    currentRangeIndex,
    currentRangeResetter,
    lastIncrease
   }));
  }

  function loadFromLocalStorage() {
   const savedEntries = localStorage.getItem('volumeMeasurementEntries');
   const savedState = localStorage.getItem('volumeMeasurementState');

   if (savedEntries) {
    entries = JSON.parse(savedEntries);
   }

   if (savedState) {
    const state = JSON.parse(savedState);
    currentRangeIndex = state.currentRangeIndex || 0;
    currentRangeResetter = state.currentRangeResetter || 0;
    lastIncrease = state.lastIncrease || 0;
   }
  }
  </script>

<!-- InstanceEndEditable -->
<script>
  // embeddedScript
  // Debugging tool to adjust root link per localhost test, and github pages.

  var href = location.href;
  var pgHref = document.querySelectorAll("[href], [src]");
  if (href.indexOf("localhost") > -1) {
   let pgHrefLen = pgHref.length;
   for (i = 0; i < pgHrefLen; i++) {
    let curVal;
    if (pgHref[i].hasAttribute("href")) {
     curVal = pgHref[i].getAttribute("href");
     pgHref[i].setAttribute("href", curVal.replace("https://isocialpractice.github.io/interactive-html", ""));
    }
    if (pgHref[i].hasAttribute("src")) {
     curVal = pgHref[i].getAttribute("src");
     pgHref[i].setAttribute("src", curVal.replace("https://isocialpractice.github.io/interactive-html", ""));
    }
   }
  }
</script>
</body>
<!-- InstanceEnd --></html>