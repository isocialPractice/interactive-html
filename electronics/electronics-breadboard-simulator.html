<html lang="en"><!-- InstanceBegin template="/Templates/page.html" codeOutsideHTMLIsLocked="true" -->
<head>
<link rel="stylesheet" href="https://isocialpractice.github.io/interactive-html/css/style.css">
<link rel="icon" type="image/svg+xml" href="https://isocialpractice.github.io/interactive-html/img/favicon.svg">
<!-- InstanceBeginEditable name="head" -->
 <title>6502 Breadboard Simulator - Ben Eater Tutorial</title>
 <style>
  * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
  }

  body {
   font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
   background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
   padding: 20px;
   min-height: 100vh;
  }

  .container {
   max-width: 1600px;
   margin: 0 auto;
   background: white;
   border-radius: 10px;
   box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
   overflow: hidden;
  }

  .header {
   background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
   color: white;
   padding: 20px 30px;
   display: flex;
   justify-content: space-between;
   align-items: center;
  }

  .header h1 {
   color: white;
   font-size: 24px;
   font-weight: 600;
  }

  .header .tutorial-ref {
   font-size: 14px;
   opacity: 0.9;
  }

  .toolbar {
   background: #f8f9fa;
   padding: 15px 30px;
   border-bottom: 2px solid #e0e0e0;
   display: flex;
   gap: 10px;
   flex-wrap: wrap;
   align-items: center;
  }

  .toolbar-section {
   display: flex;
   gap: 10px;
   align-items: center;
   padding-right: 20px;
   border-right: 2px solid #d0d0d0;
  }

  .toolbar-section:last-child {
   border-right: none;
  }

  .toolbar-label {
   font-weight: 600;
   color: #333;
   font-size: 14px;
  }

  .btn {
   padding: 8px 16px;
   border: none;
   border-radius: 5px;
   cursor: pointer;
   font-size: 14px;
   transition: all 0.2s;
   font-weight: 500;
  }

  .btn-primary {
   background: #4CAF50;
   color: white;
  }

  .btn-primary:hover {
   background: #45a049;
   transform: translateY(-1px);
   box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
  }

  .btn-secondary {
   background: #2196F3;
   color: white;
  }

  .btn-secondary:hover {
   background: #0b7dda;
   transform: translateY(-1px);
   box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
  }

  .btn-danger {
   background: #f44336;
   color: white;
  }

  .btn-danger:hover {
   background: #da190b;
   transform: translateY(-1px);
   box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
  }

  .btn-warning {
   background: #2c3e50;
   color: white;
  }

  .btn-warning:hover {
   background: #1a252f;
  }

  .btn-component {
   background: white;
   border: 2px solid #ddd;
   color: #333;
   padding: 10px 15px;
   display: flex;
   flex-direction: column;
   align-items: center;
   gap: 5px;
  }

  .btn-component:hover {
   border-color: #4CAF50;
   background: #f0f8f0;
   transform: translateY(-2px);
   box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .btn-component .icon {
   font-size: 20px;
  }

  .btn-component .label {
   font-size: 11px;
   font-weight: 600;
  }

  .workspace {
   display: flex;
   height: calc(100vh - 200px);
   min-height: 600px;
  }

  .sidebar {
   width: 280px;
   background: #fafafa;
   border-right: 2px solid #e0e0e0;
   padding: 20px;
   overflow-y: auto;
  }

  .sidebar h3 {
   font-size: 16px;
   margin-bottom: 15px;
   color: #333;
   border-bottom: 2px solid #4CAF50;
   padding-bottom: 8px;
  }

  .component-list {
   display: flex;
   flex-direction: column;
   gap: 8px;
  }

  .component-item {
   background: white;
   border: 2px solid #ddd;
   border-radius: 5px;
   padding: 12px;
   cursor: grab;
   transition: all 0.2s;
   display: flex;
   align-items: center;
   gap: 10px;
  }

  .component-item:hover {
   border-color: #4CAF50;
   background: #f0f8f0;
   transform: translateX(5px);
  }

  .component-item:active {
   cursor: grabbing;
  }

  .component-icon {
   font-size: 24px;
  }

  .component-info {
   flex: 1;
  }

  .component-name {
   font-weight: 600;
   font-size: 14px;
   color: #333;
  }

  .component-desc {
   font-size: 11px;
   color: #666;
   margin-top: 2px;
  }

  .canvas-container {
   flex: 1;
   position: relative;
   overflow: auto;
   background: #fff;
  }

  #breadboard-canvas {
   display: block;
   cursor: crosshair;
  }

  .properties-panel {
   width: 300px;
   background: #fafafa;
   border-left: 2px solid #e0e0e0;
   padding: 20px;
   overflow-y: auto;
  }

  .properties-panel h3 {
   font-size: 16px;
   margin-bottom: 15px;
   color: #333;
   border-bottom: 2px solid #2196F3;
   padding-bottom: 8px;
  }

  .property-group {
   margin-bottom: 20px;
  }

  .property-label {
   font-size: 12px;
   font-weight: 600;
   color: #666;
   margin-bottom: 5px;
   display: block;
  }

  .property-input {
   width: 100%;
   padding: 8px;
   border: 1px solid #ddd;
   border-radius: 4px;
   font-size: 14px;
  }

  .property-input:focus {
   outline: none;
   border-color: #2196F3;
   box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
  }

  .info-box {
   background: #e3f2fd;
   border-left: 4px solid #2196F3;
   padding: 12px;
   margin-top: 20px;
   border-radius: 4px;
  }

  .info-box h4 {
   font-size: 14px;
   margin-bottom: 8px;
   color: #1976D2;
  }

  .info-box p {
   font-size: 12px;
   color: #666;
   line-height: 1.5;
  }

  .status-bar {
   background: #263238;
   color: white;
   padding: 10px 30px;
   display: flex;
   justify-content: space-between;
   align-items: center;
   font-size: 12px;
  }

  .status-item {
   display: flex;
   gap: 20px;
  }

  .modal {
   display: none;
   position: fixed;
   top: 0;
   left: 0;
   width: 100%;
   height: 100%;
   background: rgba(0, 0, 0, 0.7);
   z-index: 1000;
   align-items: center;
   justify-content: center;
  }

  .modal.active {
   display: flex;
  }

.modal-content {
   background: white;
   border-radius: 10px;
   padding: 30px;
   max-width: 600px;
   width: 90%;
   max-height: 80vh;
   overflow-y: auto;
  }

  .modal-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   margin-bottom: 20px;
   padding-bottom: 15px;
   border-bottom: 2px solid #e0e0e0;
  }

  .modal-header h2 {
   font-size: 20px;
   color: #333;
  }

  .modal-close {
   background: none;
   border: none;
   font-size: 28px;
   cursor: pointer;
   color: #666;
   width: 30px;
   height: 30px;
   display: flex;
   align-items: center;
   justify-content: center;
   border-radius: 50%;
   transition: all 0.2s;
  }

  .modal-close:hover {
   background: #f0f0f0;
   color: #333;
  }

  .connection-mode {
   background: #e3f2fd;
   border-left: 4px solid #2196F3;
   padding: 10px;
   margin: 10px 30px;
   border-radius: 4px;
   display: none;
  }

  .connection-mode.active {
   display: block;
  }

  .connection-mode p {
   font-size: 13px;
   color: #1565c0;
   font-weight: 500;
  }

  /* Component styles on canvas */
  .placed-component {
   position: absolute;
   border: 2px solid #333;
   background: rgba(255, 255, 255, 0.9);
   cursor: move;
   transition: box-shadow 0.2s;
      user-select: none;
  }

  .placed-component:hover {
   box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
   z-index: 10;
  }

  .placed-component.selected {
   border-color: #2196F3;
   box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.3);
   z-index: 20;
  }

  .chip-label {
   position: absolute;
   bottom: 5px;
   left: 50%;
   transform: translateX(-50%);
   font-size: 10px;
   font-weight: bold;
   background: rgba(255, 255, 255, 0.9);
   padding: 2px 6px;
   border-radius: 3px;
  }

  @media (max-width: 1200px) {
      .sidebar {
       width: 200px;
      }

      .properties-panel {
       width: 250px;
      }
  }

  @media (max-width: 768px) {
   .workspace {
    flex-direction: column;
   }

   .sidebar,
   .properties-panel {
    width: 100%;
    height: auto;
    max-height: 200px;
   }
  }
 </style>

<!-- InstanceEndEditable -->
</head>

<body>
 <nav class="site-nav">
  <div class="nav-container">
   <a href="https://isocialpractice.github.io/interactive-html/index.html" class="nav-brand">
    <img src="https://isocialpractice.github.io/interactive-html/img/favicon.svg" alt="Electronics Tools" class="nav-logo">
    <span>Interactive Tools</span>
   </a>
   <button class="nav-toggle" aria-label="Toggle menu" onclick="document.querySelector('.nav-menu').classList.toggle('active')">‚ò∞</button>
   <ul class="nav-menu">
    <li class="nav-item">
     <a href="https://isocialpractice.github.io/interactive-html/index.html" class="nav-link"><span>üè†</span> <span>Home</span></a>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/555/index.html" class="nav-link dropdown-toggle"><span>‚è±Ô∏è</span> <span>555 Timer</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/555/555-timer-simulator.html" class="nav-link">Interactive Simulator</a>
      <a href="https://isocialpractice.github.io/interactive-html/555/555-astable-calculator.html" class="nav-link">Astable Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/555/555-monostable-simulator.html" class="nav-link">Monostable Simulator</a>
      <a href="https://isocialpractice.github.io/interactive-html/555/555-logic-simulator.html" class="nav-link">Clock Logic Simulator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/electronics/index.html#resistorTools" class="nav-link dropdown-toggle"><span>üîå</span> <span>Resistors</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-resistor-calculator.html" class="nav-link">Color Code Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-parallel-resistor-calculator.html" class="nav-link">Parallel Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-fusible-resistor-calculator.html" class="nav-link">Fusible Calculator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/electronics/index.html#ledAndPowerTools" class="nav-link dropdown-toggle"><span>üí°</span> <span>LED & Power</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-ohms-law-calculator.html" class="nav-link">Ohm's Law</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-led-current-calculator.html" class="nav-link">LED Calculator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-voltage-divider-calculator.html" class="nav-link">Voltage Divider</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-varistor-simulator.html" class="nav-link">Varistor Simulator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/electronics/index.html#components" class="nav-link dropdown-toggle"><span>üîß</span> <span>Components</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-potentiometer-simulator.html" class="nav-link">Potentiometer Simulator</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-potentiometer-decoder.html" class="nav-link">Potentiometer Decoder</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-surface-mount-decoder.html" class="nav-link">SMD Decoder</a>
      <a href="https://isocialpractice.github.io/interactive-html/electronics/electronics-breadboard-simulator.html" class="nav-link">Breadboard Simulator</a>
     </div>
    </li>
    <li class="nav-item nav-dropdown">
     <a href="https://isocialpractice.github.io/interactive-html/general/index.html" class="nav-link dropdown-toggle"><span>üìê</span> <span>General</span></a>
     <div class="dropdown-menu">
      <a href="https://isocialpractice.github.io/interactive-html/general/general-volume-measurement.html" class="nav-link">Volume Measurement</a>
      <a href="https://isocialpractice.github.io/interactive-html/general/general-area-and-perimeter-calculator.html" class="nav-link">Area & Perimeter</a>
     </div>
    </li>
   </ul>
  </div>
 </nav>

<!-- InstanceBeginEditable name="page" -->
 <div class="container">
  <div class="header">
   <div>
    <h1>üîå 6502 Breadboard Simulator</h1>
    <div class="tutorial-ref">Based on Ben Eater's 6502 Computer Tutorial Series</div>
   </div>
  </div>

  <div class="toolbar">
   <div class="toolbar-section">
    <span class="toolbar-label">File:</span>
    <button class="btn btn-primary" onclick="simulator.newProject()">New</button>
    <button class="btn btn-secondary" onclick="simulator.saveProject()">Save</button>
    <button class="btn btn-secondary" onclick="simulator.loadProject()">Load</button>
    <button class="btn btn-secondary" onclick="simulator.exportImage()">Export</button>
   </div>

   <div class="toolbar-section">
    <span class="toolbar-label">Edit:</span>
    <button class="btn btn-warning" onclick="simulator.deleteSelected()">Delete</button>
    <button class="btn btn-secondary" onclick="simulator.rotateSelected()">üîÑ Rotate</button>
    <button class="btn btn-danger" onclick="simulator.clearCanvas()">Clear All</button>
   </div>

   <div class="toolbar-section">
    <span class="toolbar-label">Tools:</span>
    <button class="btn btn-secondary" onclick="simulator.toggleConnectionMode()"
    ()=">" id="wireMode">Wire Mode OFF</button>
    <button class="btn btn-secondary" onclick="simulator.toggleGrid()">Toggle Grid</button>
    <button class="btn btn-primary" onclick="simulator.autoRoute()">Auto Route</button>
   </div>

   <div class="toolbar-section">
    <span class="toolbar-label">View:</span>
    <button class="btn btn-secondary" onclick="simulator.zoomIn()">üîç +</button>
    <button class="btn btn-secondary" onclick="simulator.zoomOut()">üîç -</button>
    <button class="btn btn-secondary" onclick="simulator.resetView()">Reset</button>
   </div>
  </div>

     <div class="connection-mode" id="connectionMode">
      <p id="wireModeText">üîå Wire Mode Active: Click on two points to create a connection</p>
     </div>

     <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 12px 30px; margin: 0; display: flex; gap: 30px; align-items: center; border-bottom: 1px solid #ddd;" id="quickTips">
      <strong style="color: #1976D2;">üí° Quick Tips:</strong>
      <span style="font-size: 13px; color: #555;"><strong>Drag & Drop:</strong> Drag components onto the breadboard</span>
      <span style="font-size: 13px; color: #555;"><strong>Wire Mode:</strong> Click two points to connect</span>
      <span style="font-size: 13px; color: #555;"><strong>Delete:</strong> Select and press Delete key</span>
      <span style="font-size: 13px; color: #555;"><strong>Move:</strong> Click and drag components</span>
      <span style="font-size: 13px; color: #555;"><strong>Rotate:</strong> Select component and click Rotate (R key)</span>
     </div>

     <div class="workspace">
      <div class="sidebar">
       <h3>üì¶ Components</h3>
       <div class="component-list">
        <div class="component-item" draggable="true" data-type="w65c02s">
         <div class="component-icon">üñ•Ô∏è</div>
         <div class="component-info">
          <div class="component-name">W65C02S</div>
          <div class="component-desc">Microprocessor</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="28c256">
         <div class="component-icon">üíæ</div>
         <div class="component-info">
          <div class="component-name">28C256</div>
          <div class="component-desc">EEPROM 32KB</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="62256">
         <div class="component-icon">üß†</div>
         <div class="component-info">
          <div class="component-name">62256</div>
          <div class="component-desc">SRAM 32KB</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="w65c22">
         <div class="component-icon">üîå</div>
         <div class="component-info">
          <div class="component-name">W65C22</div>
          <div class="component-desc">VIA Interface</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="7400-series">
         <div class="component-icon">‚ö°</div>
         <div class="component-info">
          <div class="component-name">7400-series</div>
          <div class="component-desc">Logic Gate ICs</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="ne555">
         <div class="component-icon">‚è±Ô∏è</div>
         <div class="component-info">
          <div class="component-name">NE555</div>
          <div class="component-desc">Timer IC</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="led">
         <div class="component-icon">üí°</div>
         <div class="component-info">
          <div class="component-name">LED</div>
          <div class="component-desc">Light Emitting Diode</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="resistor">
         <div class="component-icon">üìè</div>
         <div class="component-info">
          <div class="component-name">Resistor</div>
          <div class="component-desc">1kŒ© Default</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="capacitor">
         <div class="component-icon">üîã</div>
         <div class="component-info">
          <div class="component-name">Capacitor</div>
          <div class="component-desc">100nF Default</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="switch">
         <div class="component-icon">üîò</div>
         <div class="component-info">
          <div class="component-name">Switch</div>
          <div class="component-desc">Toggle Switch</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="button">
         <div class="component-icon">‚è∫Ô∏è</div>
         <div class="component-info">
          <div class="component-name">Button</div>
          <div class="component-desc">Momentary (Hold to activate)</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="crystal">
         <div class="component-icon">üíé</div>
         <div class="component-info">
          <div class="component-name">Crystal</div>
          <div class="component-desc">1MHz Oscillator</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="potentiometer">
         <div class="component-icon">üéöÔ∏è</div>
         <div class="component-info">
          <div class="component-name">Potentiometer</div>
          <div class="component-desc">Variable Resistor</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="photoresistor">
         <div class="component-icon">‚òÄÔ∏è</div>
         <div class="component-info">
          <div class="component-name">Photoresistor</div>
          <div class="component-desc">Light-Dependent Resistor</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="power">
         <div class="component-icon">üîå</div>
         <div class="component-info">
          <div class="component-name">Power (+5V)</div>
          <div class="component-desc">Power Rail</div>
         </div>
        </div>

        <div class="component-item" draggable="true" data-type="ground">
         <div class="component-icon">‚èö</div>
         <div class="component-info">
          <div class="component-name">Ground (GND)</div>
          <div class="component-desc">Ground Rail</div>
         </div>
        </div>
       </div>
      </div>

      <div class="canvas-container">
       <canvas id="breadboard-canvas" width="1200" height="800"></canvas>
      </div>

      <div class="properties-panel">
       <h3>‚öôÔ∏è Properties</h3>
       
       <div class="property-group" id="7400-series-selector" style="display: none;">
        <label class="property-label">7400 Chip Type</label>
        <select class="property-input" id="7400-chip-select" onchange="simulator.change7400ChipType(this.value)">
         <option value="7400">7400 - NAND Gate</option>
         <option value="7402">7402 - NOR Gate</option>
         <option value="7404">7404 - Inverter NOT Gate</option>
         <option value="7408">7408 - AND Gate</option>
         <option value="7432">7432 - OR Gate</option>
        </select>
       </div>
       
       <div id="properties-content">
        <p style="color: #999; font-size: 14px; text-align: center; margin-top: 50px;">
            Select a component to view properties
        </p>
       </div>

       <div class="info-box">
           <h4>üìö Reference: Ben Eater Tutorial</h4>
        <p><strong>Video 1:</strong> Basic 6502 hookup with clock and address/data monitoring</p>
        <p><strong>Video 2:</strong> Adding 28C256 EEPROM for program storage</p>
        <p><strong>Key Concepts:</strong></p>
        <ul style="font-size: 12px; margin-left: 20px; margin-top: 5px;">
         <li>Address bus (A0-A15)</li>
         <li>Data bus (D0-D7)</li>
         <li>PHI2 Clock signal</li>
         <li>R/WÃÖ control line</li>
         <li>RESBÃÖ reset button</li>
        </ul>
       </div>
      </div>
     </div>

     <div class="status-bar">
      <div class="status-item">
       <span>Components: <strong id="componentCount">0</strong></span>
       <span>Connections: <strong id="connectionCount">0</strong></span>
       <span>Selected: <strong id="selectedComponent">None</strong></span>
      </div>
      <div class="status-item">
       <span>Zoom: <strong id="zoomLevel">100%</strong></span>
       <span>Grid: <strong id="gridStatus">ON</strong></span>
      </div>
     </div>
 </div>

 <script>
  class BreadboardSimulator {
   constructor() {
    this.canvas = document.getElementById('breadboard-canvas');
    this.ctx = this.canvas.getContext('2d');
    this.components = [];
    this.connections = [];
    this.selectedComponent = null;
    this.selectedWire = null;
    this.selectedPin = null; // Track selected pin for IC components
    this.connectionMode = false;
    this.connectionStart = null;
    this.showGrid = true;
    this.zoom = 1.0;
    this.offset = { x: 0, y: 0 };
    this.isDragging = false;
    this.dragStart = { x: 0, y: 0 };
    this.mousePos = { x: 0, y: 0 };
    this.ctrlPressed = false;
    this.editingWire = null;
    this.editingWirePoint = null; // 'start' or 'end'
    this.hoveredWirePoint = null; // Track hovered wire endpoint for highlighting
    this.isDraggingWire = false;
    this.wireDragOffset = { x: 0, y: 0 };
    this.activeButton = null; // Track active momentary button for mouseup release
    
    // 555 Timer simulation interval
    this.simulationInterval = null;
    this.simulationRunning = false;

    // 555 Timer IC Pin Data
    this.ne555PinData = {
     essential: {
      name: 'NE555 Timer IC',
      description: 'Versatile timer IC for generating accurate time delays or oscillation',
      applications: ['Astable multivibrator', 'Monostable (one-shot)', 'Bistable flip-flop', 'PWM generation'],
      voltageRange: '4.5V to 16V (NE555), 2V to 15V (CMOS)',
      maxCurrent: '200mA output',
      timingFormula: 'T = 1.1 √ó R √ó C (monostable)',
      astableFormulas: {
       frequency: 'f = 1.44 / ((R1 + 2√óR2) √ó C)',
       highTime: 't‚ÇÅ = 0.693 √ó (R1 + R2) √ó C',
       lowTime: 't‚ÇÇ = 0.693 √ó R2 √ó C',
       dutyCycle: 'D = (R1 + R2) / (R1 + 2√óR2) √ó 100%'
      },
      monostableFormulas: {
       pulseWidth: 'T = 1.1 √ó R √ó C',
       description: 'One-shot pulse when triggered'
      },
      thresholds: {
       trigger: '‚Öì Vcc (triggers when below)',
       threshold: '‚Öî Vcc (resets when above)',
       controlDefault: '‚Öî Vcc'
      }
     },
     pins: {
      1: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to negative supply rail.', type: 'power' },
      2: { name: 'TRIG', fullName: 'Trigger', description: 'Trigger input. When voltage falls below 1/3 Vcc, output goes HIGH and timing cycle begins.', type: 'input' },
      3: { name: 'OUT', fullName: 'Output', description: 'Output pin. Can source or sink up to 200mA. Swings between Vcc and GND.', type: 'output' },
      4: { name: 'RESET', fullName: 'Reset', description: 'Active-low reset. When pulled LOW, resets the flip-flop and forces output LOW. Tie to Vcc if not used.', type: 'input' },
      5: { name: 'CTRL', fullName: 'Control Voltage', description: 'Provides access to internal 2/3 Vcc divider. Can modulate timing. Typically bypassed to GND with 10nF capacitor.', type: 'control' },
      6: { name: 'THR', fullName: 'Threshold', description: 'Threshold input. When voltage rises above 2/3 Vcc, output goes LOW and discharge transistor turns ON.', type: 'input' },
      7: { name: 'DIS', fullName: 'Discharge', description: 'Open-collector output. Used to discharge external timing capacitor. Connected internally to output flip-flop.', type: 'output' },
      8: { name: 'Vcc', fullName: 'Supply Voltage', description: 'Positive supply (4.5V-16V for bipolar, 2V-15V for CMOS). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    // W65C02S Microprocessor Pin Data (40-pin DIP)
    this.w65c02sPinData = {
     essential: {
      name: 'W65C02S Microprocessor',
      description: '8-bit microprocessor with 16-bit address bus, capable of addressing 64KB of memory. Static core design allows stopping the clock.',
      applications: ['Retro computing', 'Embedded systems', 'Educational projects', 'Ben Eater 6502 computer'],
      voltageRange: '1.8V to 5.5V (W65C02S)',
      maxFrequency: '14 MHz',
      architecture: '8-bit data bus, 16-bit address bus',
      registers: 'A (Accumulator), X, Y (Index), SP (Stack Pointer), PC (Program Counter), P (Status)'
     },
     pins: {
      1: { name: 'VPB', fullName: 'Vector Pull', description: 'Output LOW during interrupt vector fetch (addresses $FFFA-$FFFF). Useful for vector mapping.', type: 'output' },
      2: { name: 'RDY', fullName: 'Ready', description: 'Bi-directional. When LOW, halts the processor at the end of the current cycle. Used for single-stepping or wait states.', type: 'control' },
      3: { name: 'PHI1O', fullName: 'Phase 1 Out', description: 'Inverted PHI2 clock output. Active when PHI2 is LOW. Used for timing peripherals.', type: 'output' },
      4: { name: 'IRQB', fullName: 'Interrupt Request', description: 'Active-LOW maskable interrupt input. When asserted and I flag is clear, vectors to $FFFE-$FFFF.', type: 'input' },
      5: { name: 'MLB', fullName: 'Memory Lock', description: 'Output LOW during read-modify-write instructions. Indicates atomic operation in progress.', type: 'output' },
      6: { name: 'NMIB', fullName: 'Non-Maskable Interrupt', description: 'Active-LOW edge-triggered interrupt. Cannot be disabled. Vectors to $FFFA-$FFFB.', type: 'input' },
      7: { name: 'SYNC', fullName: 'Synchronize', description: 'Output HIGH during opcode fetch cycles. Useful for debugging and single-stepping.', type: 'output' },
      8: { name: 'VDD', fullName: 'Power Supply', description: 'Positive supply voltage (1.8V to 5.5V). Bypass with 100nF capacitor to VSS.', type: 'power' },
      9: { name: 'A0', fullName: 'Address Bus 0', description: 'Address bus bit 0 (LSB). Three-state output during bus hold.', type: 'address' },
      10: { name: 'A1', fullName: 'Address Bus 1', description: 'Address bus bit 1. Three-state output during bus hold.', type: 'address' },
      11: { name: 'A2', fullName: 'Address Bus 2', description: 'Address bus bit 2. Three-state output during bus hold.', type: 'address' },
      12: { name: 'A3', fullName: 'Address Bus 3', description: 'Address bus bit 3. Three-state output during bus hold.', type: 'address' },
      13: { name: 'A4', fullName: 'Address Bus 4', description: 'Address bus bit 4. Three-state output during bus hold.', type: 'address' },
      14: { name: 'A5', fullName: 'Address Bus 5', description: 'Address bus bit 5. Three-state output during bus hold.', type: 'address' },
      15: { name: 'A6', fullName: 'Address Bus 6', description: 'Address bus bit 6. Three-state output during bus hold.', type: 'address' },
      16: { name: 'A7', fullName: 'Address Bus 7', description: 'Address bus bit 7. Three-state output during bus hold.', type: 'address' },
      17: { name: 'A8', fullName: 'Address Bus 8', description: 'Address bus bit 8. Three-state output during bus hold.', type: 'address' },
      18: { name: 'A9', fullName: 'Address Bus 9', description: 'Address bus bit 9. Three-state output during bus hold.', type: 'address' },
      19: { name: 'A10', fullName: 'Address Bus 10', description: 'Address bus bit 10. Three-state output during bus hold.', type: 'address' },
      20: { name: 'A11', fullName: 'Address Bus 11', description: 'Address bus bit 11. Three-state output during bus hold.', type: 'address' },
      21: { name: 'VSS', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground.', type: 'power' },
      22: { name: 'A12', fullName: 'Address Bus 12', description: 'Address bus bit 12. Three-state output during bus hold.', type: 'address' },
      23: { name: 'A13', fullName: 'Address Bus 13', description: 'Address bus bit 13. Three-state output during bus hold.', type: 'address' },
      24: { name: 'A14', fullName: 'Address Bus 14', description: 'Address bus bit 14. Three-state output during bus hold.', type: 'address' },
      25: { name: 'A15', fullName: 'Address Bus 15', description: 'Address bus bit 15 (MSB). Three-state output during bus hold.', type: 'address' },
      26: { name: 'D7', fullName: 'Data Bus 7', description: 'Data bus bit 7 (MSB). Bidirectional three-state.', type: 'data' },
      27: { name: 'D6', fullName: 'Data Bus 6', description: 'Data bus bit 6. Bidirectional three-state.', type: 'data' },
      28: { name: 'D5', fullName: 'Data Bus 5', description: 'Data bus bit 5. Bidirectional three-state.', type: 'data' },
      29: { name: 'D4', fullName: 'Data Bus 4', description: 'Data bus bit 4. Bidirectional three-state.', type: 'data' },
      30: { name: 'D3', fullName: 'Data Bus 3', description: 'Data bus bit 3. Bidirectional three-state.', type: 'data' },
      31: { name: 'D2', fullName: 'Data Bus 2', description: 'Data bus bit 2. Bidirectional three-state.', type: 'data' },
      32: { name: 'D1', fullName: 'Data Bus 1', description: 'Data bus bit 1. Bidirectional three-state.', type: 'data' },
      33: { name: 'D0', fullName: 'Data Bus 0', description: 'Data bus bit 0 (LSB). Bidirectional three-state.', type: 'data' },
      34: { name: 'RWB', fullName: 'Read/Write', description: 'HIGH = Read cycle, LOW = Write cycle. Directly controls memory/peripheral direction.', type: 'output' },
      35: { name: 'NC', fullName: 'No Connection', description: 'No internal connection. Leave unconnected or tie to VDD.', type: 'nc' },
      36: { name: 'BE', fullName: 'Bus Enable', description: 'When LOW, address/data/RWB buses go high-impedance. Used for DMA or bus sharing.', type: 'input' },
      37: { name: 'PHI2', fullName: 'Phase 2 Clock', description: 'System clock input. Data is valid on the falling edge. Max 14MHz for W65C02S.', type: 'input' },
      38: { name: 'SOB', fullName: 'Set Overflow', description: 'Active-LOW. Negative edge sets the V (overflow) flag in the status register.', type: 'input' },
      39: { name: 'PHI2O', fullName: 'Phase 2 Out', description: 'Buffered PHI2 clock output. Used for timing external logic.', type: 'output' },
      40: { name: 'RESB', fullName: 'Reset', description: 'Active-LOW reset. Hold LOW for at least 2 clock cycles. Vectors to $FFFC-$FFFD on release.', type: 'input' }
     }
    };

    // W65C22 VIA (Versatile Interface Adapter) Pin Data (40-pin DIP)
    this.w65c22PinData = {
     essential: {
      name: 'W65C22 VIA (Versatile Interface Adapter)',
      description: '40-pin peripheral interface chip providing two 8-bit parallel I/O ports, two 16-bit timer/counters, and a serial shift register. Essential for 6502 system I/O.',
      applications: ['Parallel I/O expansion', '6502 peripheral interface', 'Timer/counter applications', 'Ben Eater 6502 computer'],
      voltageRange: '1.8V to 5.5V (W65C22S)',
      maxFrequency: '14 MHz',
      ioPorts: 'Port A (8-bit), Port B (8-bit)',
      timers: 'Timer 1 (16-bit), Timer 2 (16-bit)',
      features: 'Shift register, Handshake control, Interrupt control'
     },
     pins: {
      1: { name: 'VSS', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground.', type: 'power' },
      2: { name: 'PA0', fullName: 'Port A Bit 0', description: 'Port A data bit 0. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      3: { name: 'PA1', fullName: 'Port A Bit 1', description: 'Port A data bit 1. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      4: { name: 'PA2', fullName: 'Port A Bit 2', description: 'Port A data bit 2. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      5: { name: 'PA3', fullName: 'Port A Bit 3', description: 'Port A data bit 3. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      6: { name: 'PA4', fullName: 'Port A Bit 4', description: 'Port A data bit 4. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      7: { name: 'PA5', fullName: 'Port A Bit 5', description: 'Port A data bit 5. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      8: { name: 'PA6', fullName: 'Port A Bit 6', description: 'Port A data bit 6. Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      9: { name: 'PA7', fullName: 'Port A Bit 7', description: 'Port A data bit 7 (MSB). Bidirectional I/O, directly controlled by DDRA register.', type: 'io' },
      10: { name: 'PB0', fullName: 'Port B Bit 0', description: 'Port B data bit 0. Bidirectional I/O, directly controlled by DDRB register.', type: 'io' },
      11: { name: 'PB1', fullName: 'Port B Bit 1', description: 'Port B data bit 1. Bidirectional I/O, directly controlled by DDRB register.', type: 'io' },
      12: { name: 'PB2', fullName: 'Port B Bit 2', description: 'Port B data bit 2. Bidirectional I/O, directly controlled by DDRB register.', type: 'io' },
      13: { name: 'PB3', fullName: 'Port B Bit 3', description: 'Port B data bit 3. Bidirectional I/O, directly controlled by DDRB register.', type: 'io' },
      14: { name: 'PB4', fullName: 'Port B Bit 4', description: 'Port B data bit 4. Bidirectional I/O, directly controlled by DDRB register.', type: 'io' },
      15: { name: 'PB5', fullName: 'Port B Bit 5', description: 'Port B data bit 5. Bidirectional I/O, directly controlled by DDRB register.', type: 'io' },
      16: { name: 'PB6', fullName: 'Port B Bit 6', description: 'Port B data bit 6. Also serves as Timer 2 count input (T2 pulse counting mode).', type: 'io' },
      17: { name: 'PB7', fullName: 'Port B Bit 7', description: 'Port B data bit 7 (MSB). Also serves as Timer 1 output (square wave mode).', type: 'io' },
      18: { name: 'CB1', fullName: 'Port B Control 1', description: 'Control line 1 for Port B. Input only. Used for handshake or interrupt input. Edge-triggered.', type: 'control' },
      19: { name: 'CB2', fullName: 'Port B Control 2', description: 'Control line 2 for Port B. Bidirectional. Handshake output, serial data, or manual control.', type: 'control' },
      20: { name: 'VDD', fullName: 'Power Supply', description: 'Positive supply voltage (1.8V to 5.5V). Bypass with 100nF capacitor to VSS.', type: 'power' },
      21: { name: 'IRQB', fullName: 'Interrupt Request', description: 'Active-LOW open-drain interrupt output. Directly connects to CPU IRQB. Multiple sources.', type: 'output' },
      22: { name: 'RWB', fullName: 'Read/Write', description: 'Read/Write select from CPU. HIGH = CPU reads VIA registers, LOW = CPU writes to VIA.', type: 'input' },
      23: { name: 'CS2B', fullName: 'Chip Select 2', description: 'Active-LOW chip select. Both CS1=HIGH and CS2B=LOW required for VIA access.', type: 'input' },
      24: { name: 'CS1', fullName: 'Chip Select 1', description: 'Active-HIGH chip select. Both CS1=HIGH and CS2B=LOW required for VIA access.', type: 'input' },
      25: { name: 'PHI2', fullName: 'Phase 2 Clock', description: 'System clock input from CPU. Data transfers occur on PHI2 HIGH when chip is selected.', type: 'input' },
      26: { name: 'D7', fullName: 'Data Bus 7', description: 'Data bus bit 7 (MSB). Bidirectional three-state.', type: 'data' },
      27: { name: 'D6', fullName: 'Data Bus 6', description: 'Data bus bit 6. Bidirectional three-state.', type: 'data' },
      28: { name: 'D5', fullName: 'Data Bus 5', description: 'Data bus bit 5. Bidirectional three-state.', type: 'data' },
      29: { name: 'D4', fullName: 'Data Bus 4', description: 'Data bus bit 4. Bidirectional three-state.', type: 'data' },
      30: { name: 'D3', fullName: 'Data Bus 3', description: 'Data bus bit 3. Bidirectional three-state.', type: 'data' },
      31: { name: 'D2', fullName: 'Data Bus 2', description: 'Data bus bit 2. Bidirectional three-state.', type: 'data' },
      32: { name: 'D1', fullName: 'Data Bus 1', description: 'Data bus bit 1. Bidirectional three-state.', type: 'data' },
      33: { name: 'D0', fullName: 'Data Bus 0', description: 'Data bus bit 0 (LSB). Bidirectional three-state.', type: 'data' },
      34: { name: 'RESB', fullName: 'Reset', description: 'Active-LOW reset input. Clears all registers and sets ports to input mode.', type: 'input' },
      35: { name: 'RS3', fullName: 'Register Select 3', description: 'Register select bit 3 (MSB). Combined with RS0-RS2 to address 16 internal registers.', type: 'input' },
      36: { name: 'RS2', fullName: 'Register Select 2', description: 'Register select bit 2. Combined with RS0-RS3 to address 16 internal registers.', type: 'input' },
      37: { name: 'RS1', fullName: 'Register Select 1', description: 'Register select bit 1. Combined with RS0-RS3 to address 16 internal registers.', type: 'input' },
      38: { name: 'RS0', fullName: 'Register Select 0', description: 'Register select bit 0 (LSB). Combined with RS1-RS3 to address 16 internal registers.', type: 'input' },
      39: { name: 'CA2', fullName: 'Port A Control 2', description: 'Control line 2 for Port A. Bidirectional. Handshake output, serial clock, or manual control.', type: 'control' },
      40: { name: 'CA1', fullName: 'Port A Control 1', description: 'Control line 1 for Port A. Input only. Used for handshake or interrupt input. Edge-triggered.', type: 'control' }
     }
    };

    // AT28C256 EEPROM Pin Data (28-pin DIP)
    this.at28c256PinData = {
     essential: {
      name: 'AT28C256 EEPROM (32K x 8)',
      description: '256 Kbit (32K x 8) parallel EEPROM with fast read access. Features page write capability for efficient programming and data protection.',
      applications: ['Program storage', '6502 computer ROM', 'Firmware storage', 'Ben Eater 6502 computer'],
      voltageRange: '4.5V to 5.5V',
      accessTime: '150ns (AT28C256-15)',
      capacity: '32,768 bytes (32KB)',
      organization: '32K x 8 bits',
      writeTime: '10ms max (byte), 10ms max (page)',
      endurance: '100,000 write cycles'
     },
     pins: {
      1: { name: 'A14', fullName: 'Address 14', description: 'Address bus bit 14. Part of the 15-bit address bus (A0-A14) for 32KB addressing.', type: 'address' },
      2: { name: 'A12', fullName: 'Address 12', description: 'Address bus bit 12. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      3: { name: 'A7', fullName: 'Address 7', description: 'Address bus bit 7. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      4: { name: 'A6', fullName: 'Address 6', description: 'Address bus bit 6. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      5: { name: 'A5', fullName: 'Address 5', description: 'Address bus bit 5. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      6: { name: 'A4', fullName: 'Address 4', description: 'Address bus bit 4. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      7: { name: 'A3', fullName: 'Address 3', description: 'Address bus bit 3. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      8: { name: 'A2', fullName: 'Address 2', description: 'Address bus bit 2. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      9: { name: 'A1', fullName: 'Address 1', description: 'Address bus bit 1. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      10: { name: 'A0', fullName: 'Address 0', description: 'Address bus bit 0 (LSB). Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      11: { name: 'I/O0', fullName: 'Data I/O 0', description: 'Data bus bit 0 (LSB). Bidirectional data line for read/write operations.', type: 'data' },
      12: { name: 'I/O1', fullName: 'Data I/O 1', description: 'Data bus bit 1. Bidirectional data line for read/write operations.', type: 'data' },
      13: { name: 'I/O2', fullName: 'Data I/O 2', description: 'Data bus bit 2. Bidirectional data line for read/write operations.', type: 'data' },
      14: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground.', type: 'power' },
      15: { name: 'I/O3', fullName: 'Data I/O 3', description: 'Data bus bit 3. Bidirectional data line for read/write operations.', type: 'data' },
      16: { name: 'I/O4', fullName: 'Data I/O 4', description: 'Data bus bit 4. Bidirectional data line for read/write operations.', type: 'data' },
      17: { name: 'I/O5', fullName: 'Data I/O 5', description: 'Data bus bit 5. Bidirectional data line for read/write operations.', type: 'data' },
      18: { name: 'I/O6', fullName: 'Data I/O 6', description: 'Data bus bit 6. Bidirectional data line for read/write operations.', type: 'data' },
      19: { name: 'I/O7', fullName: 'Data I/O 7', description: 'Data bus bit 7 (MSB). Bidirectional data line for read/write operations.', type: 'data' },
      20: { name: 'CE', fullName: 'Chip Enable', description: 'Active-LOW chip enable. Must be LOW for read or write operations. Controls power-down mode when HIGH.', type: 'control' },
      21: { name: 'A10', fullName: 'Address 10', description: 'Address bus bit 10. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      22: { name: 'OE', fullName: 'Output Enable', description: 'Active-LOW output enable. Must be LOW to read data. Controls data bus output drivers.', type: 'control' },
      23: { name: 'A11', fullName: 'Address 11', description: 'Address bus bit 11. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      24: { name: 'A9', fullName: 'Address 9', description: 'Address bus bit 9. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      25: { name: 'A8', fullName: 'Address 8', description: 'Address bus bit 8. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      26: { name: 'A13', fullName: 'Address 13', description: 'Address bus bit 13. Part of the 15-bit address bus for 32KB addressing.', type: 'address' },
      27: { name: 'WE', fullName: 'Write Enable', description: 'Active-LOW write enable. Pulse LOW with CE LOW to write data. 100ns min pulse width.', type: 'control' },
      28: { name: 'VCC', fullName: 'Power Supply', description: 'Positive supply voltage (4.5V to 5.5V). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    // SN7400 Quad 2-Input NAND Gate Pin Data (14-pin DIP)
    this.sn7400PinData = {
     essential: {
      name: 'SN7400 Quad 2-Input NAND Gate',
      description: 'Contains four independent 2-input NAND gates. Fundamental building block for digital logic - any logic function can be built from NAND gates.',
      applications: ['Digital logic circuits', 'Address decoding', 'Clock gating', 'Ben Eater 6502 computer'],
      voltageRange: '4.75V to 5.25V',
      propagationDelay: '22ns typical',
      fanOut: '10 standard TTL loads',
      gateCount: '4 gates',
      inputsPerGate: '2 inputs',
      truthTable: 'Y = NOT(A AND B)'
     },
     pins: {
      1: { name: '1A', fullName: 'Gate 1 Input A', description: 'First input to NAND gate 1. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      2: { name: '1B', fullName: 'Gate 1 Input B', description: 'Second input to NAND gate 1. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      3: { name: '1Y', fullName: 'Gate 1 Output', description: 'Output of NAND gate 1. Y = NOT(1A AND 1B). LOW only when both inputs are HIGH.', type: 'output' },
      4: { name: '2A', fullName: 'Gate 2 Input A', description: 'First input to NAND gate 2. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      5: { name: '2B', fullName: 'Gate 2 Input B', description: 'Second input to NAND gate 2. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      6: { name: '2Y', fullName: 'Gate 2 Output', description: 'Output of NAND gate 2. Y = NOT(2A AND 2B). LOW only when both inputs are HIGH.', type: 'output' },
      7: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground. Essential for proper operation.', type: 'power' },
      8: { name: '3Y', fullName: 'Gate 3 Output', description: 'Output of NAND gate 3. Y = NOT(3A AND 3B). LOW only when both inputs are HIGH.', type: 'output' },
      9: { name: '3A', fullName: 'Gate 3 Input A', description: 'First input to NAND gate 3. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      10: { name: '3B', fullName: 'Gate 3 Input B', description: 'Second input to NAND gate 3. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      11: { name: '4Y', fullName: 'Gate 4 Output', description: 'Output of NAND gate 4. Y = NOT(4A AND 4B). LOW only when both inputs are HIGH.', type: 'output' },
      12: { name: '4A', fullName: 'Gate 4 Input A', description: 'First input to NAND gate 4. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      13: { name: '4B', fullName: 'Gate 4 Input B', description: 'Second input to NAND gate 4. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      14: { name: 'VCC', fullName: 'Power Supply', description: 'Positive supply voltage (4.75V to 5.25V). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    // SN7404 Hex Inverter (NOT Gate) Pin Data (14-pin DIP)
    this.sn7404PinData = {
     essential: {
      name: 'SN7404 Hex Inverter (NOT Gate)',
      description: 'Contains six independent inverter (NOT) gates. Each gate outputs the logical complement of its input - HIGH becomes LOW and LOW becomes HIGH.',
      applications: ['Signal inversion', 'Logic level conversion', 'Clock inversion', 'Ben Eater 6502 computer'],
      voltageRange: '4.75V to 5.25V',
      propagationDelay: '22ns typical',
      fanOut: '10 standard TTL loads',
      gateCount: '6 gates',
      inputsPerGate: '1 input',
      truthTable: 'Y = NOT(A)'
     },
     pins: {
      1: { name: '1A', fullName: 'Gate 1 Input', description: 'Input to inverter gate 1. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      2: { name: '1Y', fullName: 'Gate 1 Output', description: 'Output of inverter gate 1. Y = NOT(1A). Outputs opposite logic level of input.', type: 'output' },
      3: { name: '2A', fullName: 'Gate 2 Input', description: 'Input to inverter gate 2. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      4: { name: '2Y', fullName: 'Gate 2 Output', description: 'Output of inverter gate 2. Y = NOT(2A). Outputs opposite logic level of input.', type: 'output' },
      5: { name: '3A', fullName: 'Gate 3 Input', description: 'Input to inverter gate 3. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      6: { name: '3Y', fullName: 'Gate 3 Output', description: 'Output of inverter gate 3. Y = NOT(3A). Outputs opposite logic level of input.', type: 'output' },
      7: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground. Essential for proper operation.', type: 'power' },
      8: { name: '4Y', fullName: 'Gate 4 Output', description: 'Output of inverter gate 4. Y = NOT(4A). Outputs opposite logic level of input.', type: 'output' },
      9: { name: '4A', fullName: 'Gate 4 Input', description: 'Input to inverter gate 4. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      10: { name: '5Y', fullName: 'Gate 5 Output', description: 'Output of inverter gate 5. Y = NOT(5A). Outputs opposite logic level of input.', type: 'output' },
      11: { name: '5A', fullName: 'Gate 5 Input', description: 'Input to inverter gate 5. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      12: { name: '6Y', fullName: 'Gate 6 Output', description: 'Output of inverter gate 6. Y = NOT(6A). Outputs opposite logic level of input.', type: 'output' },
      13: { name: '6A', fullName: 'Gate 6 Input', description: 'Input to inverter gate 6. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      14: { name: 'VCC', fullName: 'Power Supply', description: 'Positive supply voltage (4.75V to 5.25V). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    // SN7402 Quad 2-Input NOR Gate Pin Data (14-pin DIP)
    this.sn7402PinData = {
     essential: {
      name: 'SN7402 Quad 2-Input NOR Gate',
      description: 'Contains four independent 2-input NOR gates. Output is HIGH only when BOTH inputs are LOW. NOR is a universal gate - any logic function can be built from NOR gates.',
      applications: ['Digital logic circuits', 'Set-Reset latches', 'Address decoding', 'Ben Eater 6502 computer'],
      voltageRange: '4.75V to 5.25V',
      propagationDelay: '22ns typical',
      fanOut: '10 standard TTL loads',
      gateCount: '4 gates',
      inputsPerGate: '2 inputs',
      truthTable: 'Y = NOT(A OR B)'
     },
     pins: {
      1: { name: '1Y', fullName: 'Gate 1 Output', description: 'Output of NOR gate 1. Y = NOT(1A OR 1B). HIGH only when both inputs are LOW.', type: 'output' },
      2: { name: '1A', fullName: 'Gate 1 Input A', description: 'First input to NOR gate 1. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      3: { name: '1B', fullName: 'Gate 1 Input B', description: 'Second input to NOR gate 1. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      4: { name: '2Y', fullName: 'Gate 2 Output', description: 'Output of NOR gate 2. Y = NOT(2A OR 2B). HIGH only when both inputs are LOW.', type: 'output' },
      5: { name: '2A', fullName: 'Gate 2 Input A', description: 'First input to NOR gate 2. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      6: { name: '2B', fullName: 'Gate 2 Input B', description: 'Second input to NOR gate 2. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      7: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground. Essential for proper operation.', type: 'power' },
      8: { name: '3A', fullName: 'Gate 3 Input A', description: 'First input to NOR gate 3. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      9: { name: '3B', fullName: 'Gate 3 Input B', description: 'Second input to NOR gate 3. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      10: { name: '3Y', fullName: 'Gate 3 Output', description: 'Output of NOR gate 3. Y = NOT(3A OR 3B). HIGH only when both inputs are LOW.', type: 'output' },
      11: { name: '4A', fullName: 'Gate 4 Input A', description: 'First input to NOR gate 4. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      12: { name: '4B', fullName: 'Gate 4 Input B', description: 'Second input to NOR gate 4. Connect to logic signal or tie HIGH/LOW if unused.', type: 'input' },
      13: { name: '4Y', fullName: 'Gate 4 Output', description: 'Output of NOR gate 4. Y = NOT(4A OR 4B). HIGH only when both inputs are LOW.', type: 'output' },
      14: { name: 'VCC', fullName: 'Power Supply', description: 'Positive supply voltage (4.75V to 5.25V). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    // SN7408 Quad 2-Input AND Gate Pin Data (14-pin DIP)
    this.sn7408PinData = {
     essential: {
      name: 'SN7408 Quad 2-Input AND Gate',
      description: 'Contains four independent 2-input AND gates. Output is HIGH only when BOTH inputs are HIGH. Essential for enabling signals and implementing logical AND operations.',
      applications: ['Digital logic circuits', 'Signal gating', 'Address decoding', 'Enable/disable control', 'Ben Eater 6502 computer'],
      voltageRange: '4.75V to 5.25V',
      propagationDelay: '15ns typical',
      fanOut: '10 standard TTL loads',
      gateCount: '4 gates',
      inputsPerGate: '2 inputs',
      truthTable: 'Y = A AND B'
     },
     pins: {
      1: { name: '1A', fullName: 'Gate 1 Input A', description: 'First input to AND gate 1. Must be HIGH along with 1B for output to be HIGH.', type: 'input' },
      2: { name: '1B', fullName: 'Gate 1 Input B', description: 'Second input to AND gate 1. Must be HIGH along with 1A for output to be HIGH.', type: 'input' },
      3: { name: '1Y', fullName: 'Gate 1 Output', description: 'Output of AND gate 1. Y = 1A AND 1B. HIGH only when both inputs are HIGH.', type: 'output' },
      4: { name: '2A', fullName: 'Gate 2 Input A', description: 'First input to AND gate 2. Must be HIGH along with 2B for output to be HIGH.', type: 'input' },
      5: { name: '2B', fullName: 'Gate 2 Input B', description: 'Second input to AND gate 2. Must be HIGH along with 2A for output to be HIGH.', type: 'input' },
      6: { name: '2Y', fullName: 'Gate 2 Output', description: 'Output of AND gate 2. Y = 2A AND 2B. HIGH only when both inputs are HIGH.', type: 'output' },
      7: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground. Essential for proper operation.', type: 'power' },
      8: { name: '3Y', fullName: 'Gate 3 Output', description: 'Output of AND gate 3. Y = 3A AND 3B. HIGH only when both inputs are HIGH.', type: 'output' },
      9: { name: '3A', fullName: 'Gate 3 Input A', description: 'First input to AND gate 3. Must be HIGH along with 3B for output to be HIGH.', type: 'input' },
      10: { name: '3B', fullName: 'Gate 3 Input B', description: 'Second input to AND gate 3. Must be HIGH along with 3A for output to be HIGH.', type: 'input' },
      11: { name: '4Y', fullName: 'Gate 4 Output', description: 'Output of AND gate 4. Y = 4A AND 4B. HIGH only when both inputs are HIGH.', type: 'output' },
      12: { name: '4A', fullName: 'Gate 4 Input A', description: 'First input to AND gate 4. Must be HIGH along with 4B for output to be HIGH.', type: 'input' },
      13: { name: '4B', fullName: 'Gate 4 Input B', description: 'Second input to AND gate 4. Must be HIGH along with 4A for output to be HIGH.', type: 'input' },
      14: { name: 'VCC', fullName: 'Power Supply', description: 'Positive supply voltage (4.75V to 5.25V). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    // SN7432 Quad 2-Input OR Gate Pin Data (14-pin DIP)
    this.sn7432PinData = {
     essential: {
      name: 'SN7432 Quad 2-Input OR Gate',
      description: 'Contains four independent 2-input OR gates. Output is HIGH when at least ONE input is HIGH. Essential for combining signals and implementing logical OR operations.',
      applications: ['Digital logic circuits', 'Signal combining', 'Multiplexing', 'Priority encoding', 'Ben Eater 6502 computer'],
      voltageRange: '4.75V to 5.25V',
      propagationDelay: '15ns typical',
      fanOut: '10 standard TTL loads',
      gateCount: '4 gates',
      inputsPerGate: '2 inputs',
      truthTable: 'Y = A OR B'
     },
     pins: {
      1: { name: '1A', fullName: 'Gate 1 Input A', description: 'First input to OR gate 1. If HIGH, output will be HIGH regardless of 1B.', type: 'input' },
      2: { name: '1B', fullName: 'Gate 1 Input B', description: 'Second input to OR gate 1. If HIGH, output will be HIGH regardless of 1A.', type: 'input' },
      3: { name: '1Y', fullName: 'Gate 1 Output', description: 'Output of OR gate 1. Y = 1A OR 1B. HIGH when either or both inputs are HIGH.', type: 'output' },
      4: { name: '2A', fullName: 'Gate 2 Input A', description: 'First input to OR gate 2. If HIGH, output will be HIGH regardless of 2B.', type: 'input' },
      5: { name: '2B', fullName: 'Gate 2 Input B', description: 'Second input to OR gate 2. If HIGH, output will be HIGH regardless of 2A.', type: 'input' },
      6: { name: '2Y', fullName: 'Gate 2 Output', description: 'Output of OR gate 2. Y = 2A OR 2B. HIGH when either or both inputs are HIGH.', type: 'output' },
      7: { name: 'GND', fullName: 'Ground', description: 'Ground reference (0V). Connect to system ground. Essential for proper operation.', type: 'power' },
      8: { name: '3Y', fullName: 'Gate 3 Output', description: 'Output of OR gate 3. Y = 3A OR 3B. HIGH when either or both inputs are HIGH.', type: 'output' },
      9: { name: '3A', fullName: 'Gate 3 Input A', description: 'First input to OR gate 3. If HIGH, output will be HIGH regardless of 3B.', type: 'input' },
      10: { name: '3B', fullName: 'Gate 3 Input B', description: 'Second input to OR gate 3. If HIGH, output will be HIGH regardless of 3A.', type: 'input' },
      11: { name: '4Y', fullName: 'Gate 4 Output', description: 'Output of OR gate 4. Y = 4A OR 4B. HIGH when either or both inputs are HIGH.', type: 'output' },
      12: { name: '4A', fullName: 'Gate 4 Input A', description: 'First input to OR gate 4. If HIGH, output will be HIGH regardless of 4B.', type: 'input' },
      13: { name: '4B', fullName: 'Gate 4 Input B', description: 'Second input to OR gate 4. If HIGH, output will be HIGH regardless of 4A.', type: 'input' },
      14: { name: 'VCC', fullName: 'Power Supply', description: 'Positive supply voltage (4.75V to 5.25V). Bypass with 100nF capacitor to GND.', type: 'power' }
     }
    };

    this.initCanvas();
    this.initDragAndDrop();
    this.initEventListeners();
    this.startSimulationLoop();
    this.draw();
   }
   
   startSimulationLoop() {
    // Start a simulation loop that runs at adaptive rate for 555 astable oscillation
    if (this.simulationInterval) {
     clearInterval(this.simulationInterval);
    }
    // Base interval - will be adjusted based on fastest 555 frequency
    this.baseSimulationInterval = 100; // 100ms base tick
    this.lastToggleTime = {};
    
    this.simulationInterval = setInterval(() => {
     this.runSimulationStep();
    }, this.baseSimulationInterval);
   }
   
   runSimulationStep() {
    // Toggle any 555s in astable mode based on their calculated timing
    const now = Date.now();
    let needsRedraw = false;
    
    for (const comp of this.components) {
     if (comp.type === 'ne555' && comp.astableMode && comp.hasPower && !comp.resetActive) {
      const compId = comp.id || this.components.indexOf(comp);
      
      // Initialize toggle time if not set
      if (!this.lastToggleTime[compId]) {
       this.lastToggleTime[compId] = now;
       comp.outputState = true; // Start HIGH
      }
      
      // Calculate toggle interval based on timing values
      let toggleInterval;
      if (comp.timingValues && comp.timingValues.period) {
       // Use calculated period, scaled for visibility (min 200ms, max 2000ms per half-cycle)
       const halfPeriodMs = (comp.timingValues.period * 1000) / 2;
       // Scale: if actual period < 400ms, slow it down; if > 4000ms, speed it up
       if (halfPeriodMs < 200) {
        toggleInterval = 200 + (halfPeriodMs / 200) * 100; // Scale up slow oscillations
       } else if (halfPeriodMs > 2000) {
        toggleInterval = 1500 + Math.log10(halfPeriodMs / 2000) * 500; // Scale down fast ones
       } else {
        toggleInterval = halfPeriodMs;
       }
      } else {
       // Default to 500ms if no timing calculated
       toggleInterval = 500;
      }
      
      // Check if it's time to toggle
      if (now - this.lastToggleTime[compId] >= toggleInterval) {
       comp.outputState = !comp.outputState;
       this.lastToggleTime[compId] = now;
       needsRedraw = true;
      }
     }
    }
    
    if (needsRedraw) {
     this.updateLEDStates();
     this.draw();
     this.updatePropertiesPanel();
    }
   }

   initCanvas() {
    // Set canvas size to fit container
    const container = this.canvas.parentElement;
    this.canvas.width = container.clientWidth;
    this.canvas.height = container.clientHeight;
   }

   initDragAndDrop() {
    const componentItems = document.querySelectorAll('.component-item');

    componentItems.forEach(item => {
     item.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('componentType', item.dataset.type);
     });
    });

    this.canvas.addEventListener('dragover', (e) => {
     e.preventDefault();
    });

    this.canvas.addEventListener('drop', (e) => {
     e.preventDefault();
     const componentType = e.dataTransfer.getData('componentType');
     const rect = this.canvas.getBoundingClientRect();
     const x = (e.clientX - rect.left - this.offset.x) / this.zoom;
     const y = (e.clientY - rect.top - this.offset.y) / this.zoom;
     this.addComponent(componentType, x, y);
    });
   }

   initEventListeners() {
    // Mouse events for dragging and selecting
    this.canvas.addEventListener('mousedown', (e) => this.handleMouseDown(e));
    this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
    this.canvas.addEventListener('mouseup', (e) => this.handleMouseUp(e));
    this.canvas.addEventListener('mouseleave', (e) => this.handleMouseLeave(e));

    // Global mouse up to catch releases outside canvas
    document.addEventListener('mouseup', (e) => {
     if (this.isDragging) {
      this.handleMouseUp(e);
     }
    });

    // Keyboard events
    document.addEventListener('keydown', (e) => {
     if (e.key === 'Delete' && (this.selectedComponent || this.selectedWire)) {
      this.deleteSelected();
     }
     if ((e.key === 'r' || e.key === 'R') && this.selectedComponent && !e.ctrlKey && !e.metaKey) {
      this.rotateSelected();
     }
     if (e.key === 'Control' || e.key === 'Meta') {
      this.ctrlPressed = true;
      // Change cursor to default when Ctrl is pressed in wire mode
      if (this.connectionMode) {
       this.canvas.style.cursor = 'default';
       this.draw();
      }
     }
     // Escape key cancels wire drawing in progress
     if (e.key === 'Escape' && this.connectionMode && this.connectionStart) {
      this.connectionStart = null;
      this.draw();
     }
    });

    document.addEventListener('keyup', (e) => {
     if (e.key === 'Control' || e.key === 'Meta') {
      this.ctrlPressed = false;
      // Reset wire editing mode when Ctrl is released (but keep selectedWire)
      this.editingWire = null;
      this.editingWirePoint = null;
      // Restore crosshair cursor in wire mode
      if (this.connectionMode) {
       this.canvas.style.cursor = 'crosshair';
      }
      this.draw();
     }
    });

    // Right-click cancels wire drawing in progress
    this.canvas.addEventListener('contextmenu', (e) => {
     if (this.connectionMode && this.connectionStart) {
      e.preventDefault();
      this.connectionStart = null;
      this.draw();
     }
    });

    // Window resize
    window.addEventListener('resize', () => {
     this.initCanvas();
     this.draw();
    });
   }

   handleMouseDown(e) {
    const rect = this.canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left - this.offset.x) / this.zoom;
    const y = (e.clientY - rect.top - this.offset.y) / this.zoom;

    if (this.connectionMode && this.ctrlPressed) {
     // Wire editing mode: check if clicking near a wire endpoint
     const wirePoint = this.getWirePointAt(x, y);
     if (wirePoint) {
      this.editingWire = wirePoint.connection;
      this.editingWirePoint = wirePoint.point;
      this.selectedWire = wirePoint.connection;
      this.selectedComponent = null;
      this.isDragging = true;
      this.updatePropertiesPanel();
      this.updateStatusBar();
      this.draw();
      return;
     }
     // Check if clicking on a wire (not endpoint) to select it
     const clickedWire = this.getWireAt(x, y);
     if (clickedWire) {
      this.selectedWire = clickedWire;
      this.selectedComponent = null;
      this.updatePropertiesPanel();
      this.updateStatusBar();
      this.draw();
      return;
     }
     // Clicking on empty space deselects wire
     this.selectedWire = null;
     this.updatePropertiesPanel();
     this.updateStatusBar();
     this.draw();
     return;
    }

    if (this.connectionMode) {
        this.handleConnectionClick(x, y);
        return;
    }

    // Check if clicking on a component
    const clickedComponent = this.getComponentAt(x, y);

    if (clickedComponent) {
     // Special handling for switch: toggle on center click, drag on border click
     if (clickedComponent.type === 'switch') {
      const borderSize = 8; // 8px border for dragging
      const isBorderClick =
       x < clickedComponent.x + borderSize ||
       x > clickedComponent.x + clickedComponent.width - borderSize ||
       y < clickedComponent.y + borderSize ||
       y > clickedComponent.y + clickedComponent.height - borderSize;

      if (isBorderClick) {
       // Drag switch
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.isDragging = true;
       this.dragStart = {
        x: x - clickedComponent.x,
        y: y - clickedComponent.y
       };
      } else {
       // Toggle switch state
       clickedComponent.isPressed = !clickedComponent.isPressed;
       this.updateLEDStates();
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
      }
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }

     // Special handling for button (momentary): activate on mousedown, deactivate on mouseup
     if (clickedComponent.type === 'button') {
      const borderSize = 8; // 8px border for dragging
      const isBorderClick =
       x < clickedComponent.x + borderSize ||
       x > clickedComponent.x + clickedComponent.width - borderSize ||
       y < clickedComponent.y + borderSize ||
       y > clickedComponent.y + clickedComponent.height - borderSize;

      if (isBorderClick) {
       // Drag button
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.isDragging = true;
       this.dragStart = {
        x: x - clickedComponent.x,
        y: y - clickedComponent.y
       };
      } else {
       // Momentary button: activate on mousedown (will deactivate on mouseup)
       clickedComponent.isPressed = true;
       this.activeButton = clickedComponent; // Track the active button for mouseup
       this.updateLEDStates();
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
      }
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }

     // Special handling for 555: detect pin vs body click
     if (clickedComponent.type === 'ne555') {
      const clickZone = this.get555ClickZone(clickedComponent, x, y);
      if (typeof clickZone === 'number') {
       // Clicked on a specific pin - show pin info only if not dragging
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.selectedPin = clickZone;
       this.updatePropertiesPanel();
       this.draw();
       this.updateStatusBar();
       return;
      }
      // Clicked on body or border - allow dragging
      this.selectedComponent = clickedComponent;
      this.selectedWire = null;
      this.selectedPin = null;
      this.isDragging = true;
      this.dragStart = {
       x: x - clickedComponent.x,
       y: y - clickedComponent.y
      };
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }

     // Special handling for W65C02S (6502): detect pin vs body click
     if (clickedComponent.type === 'w65c02s') {
      const clickZone = this.get6502ClickZone(clickedComponent, x, y);
      if (typeof clickZone === 'number') {
       // Clicked on a specific pin - show pin info only
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.selectedPin = clickZone;
       this.updatePropertiesPanel();
       this.draw();
       this.updateStatusBar();
       return;
      }
      // Clicked on body or border - allow dragging
      this.selectedComponent = clickedComponent;
      this.selectedWire = null;
      this.selectedPin = null;
      this.isDragging = true;
      this.dragStart = {
       x: x - clickedComponent.x,
       y: y - clickedComponent.y
      };
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }

     // Special handling for W65C22 (6522 VIA): detect pin vs body click
     if (clickedComponent.type === 'w65c22') {
      const clickZone = this.get6522ClickZone(clickedComponent, x, y);
      if (typeof clickZone === 'number') {
       // Clicked on a specific pin - show pin info only
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.selectedPin = clickZone;
       this.updatePropertiesPanel();
       this.draw();
       this.updateStatusBar();
       return;
      }
      // Clicked on body or border - allow dragging
      this.selectedComponent = clickedComponent;
      this.selectedWire = null;
      this.selectedPin = null;
      this.isDragging = true;
      this.dragStart = {
       x: x - clickedComponent.x,
       y: y - clickedComponent.y
      };
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }

     // Special handling for AT28C256 (EEPROM): detect pin vs body click
     if (clickedComponent.type === '28c256') {
      const clickZone = this.get28c256ClickZone(clickedComponent, x, y);
      if (typeof clickZone === 'number') {
       // Clicked on a specific pin - show pin info only
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.selectedPin = clickZone;
       this.updatePropertiesPanel();
       this.draw();
       this.updateStatusBar();
       return;
      }
      // Clicked on body or border - allow dragging
      this.selectedComponent = clickedComponent;
      this.selectedWire = null;
      this.selectedPin = null;
      this.isDragging = true;
      this.dragStart = {
       x: x - clickedComponent.x,
       y: y - clickedComponent.y
      };
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }

     // Special handling for 7400-series (Logic Gates): detect pin vs body click
     if (clickedComponent.type === '7400-series') {
      const clickZone = this.get7400ClickZone(clickedComponent, x, y);
      if (typeof clickZone === 'number') {
       // Clicked on a specific pin - show pin info only
       this.selectedComponent = clickedComponent;
       this.selectedWire = null;
       this.selectedPin = clickZone;
       this.updatePropertiesPanel();
       this.draw();
       this.updateStatusBar();
       return;
      }
      // Clicked on body or border - allow dragging
      this.selectedComponent = clickedComponent;
      this.selectedWire = null;
      this.selectedPin = null;
      this.isDragging = true;
      this.dragStart = {
       x: x - clickedComponent.x,
       y: y - clickedComponent.y
      };
      this.updatePropertiesPanel();
      this.draw();
      this.updateStatusBar();
      return;
     }
     
     // Default behavior for all other components
     this.selectedComponent = clickedComponent;
     this.selectedWire = null;
     this.selectedPin = null;
     this.isDragging = true;
     this.dragStart = {
      x: x - clickedComponent.x,
      y: y - clickedComponent.y
     };
     this.updatePropertiesPanel();
    } else {
     // Check if clicking on a wire (when NOT in connection mode)
     const clickedWire = this.getWireAt(x, y);
     if (clickedWire) {
      // If clicking on already selected wire, start dragging it
      if (this.selectedWire === clickedWire) {
       this.isDraggingWire = true;
       this.wireDragOffset = { x, y };
      } else {
       this.selectedWire = clickedWire;
       this.selectedComponent = null;
       this.selectedPin = null;
      }
      this.updatePropertiesPanel();
     } else {
      this.selectedComponent = null;
      this.selectedWire = null;
      this.selectedPin = null;
      this.updatePropertiesPanel();
     }
    }

    this.draw();
    this.updateStatusBar();
   }

   handleMouseMove(e) {
    const rect = this.canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left - this.offset.x) / this.zoom;
    const y = (e.clientY - rect.top - this.offset.y) / this.zoom;

    this.mousePos = { x, y };
    
    // Track hovered endpoint for highlighting in wire mode with Ctrl
    if (this.connectionMode && this.ctrlPressed) {
     this.hoveredWirePoint = this.getWirePointAt(x, y);
     this.draw();
    } else {
     this.hoveredWirePoint = null;
    }
    
    // Update cursor when hovering over selected wire (only when NOT in connection mode)
    if (!this.connectionMode) {
     if (this.selectedWire && !this.isDraggingWire) {
      const hoveredWire = this.getWireAt(x, y);
      if (hoveredWire === this.selectedWire) {
       this.canvas.style.cursor = 'move';
      } else {
       this.canvas.style.cursor = 'default';
      }
     } else if (!this.isDraggingWire && !this.isDragging) {
      this.canvas.style.cursor = 'default';
     }
    }

    if (this.isDragging && this.editingWire && this.editingWirePoint) {
     // Move wire endpoint
     const snapped = this.snapToGrid(x, y);
     const centerX = snapped.x + 10; // Center in grid cell
     const centerY = snapped.y + 10;
     this.editingWire[this.editingWirePoint] = { x: centerX, y: centerY };
     this.draw();
    } else if (this.isDraggingWire && this.selectedWire) {
     // Move entire wire and connected wires
     const dx = x - this.wireDragOffset.x;
     const dy = y - this.wireDragOffset.y;
     
     this.moveWireWithConnected(this.selectedWire, dx, dy);
     
     this.wireDragOffset = { x, y };
     this.draw();
    } else if (this.isDragging && this.selectedComponent) {
     this.selectedComponent.x = x - this.dragStart.x;
     this.selectedComponent.y = y - this.dragStart.y;
     this.draw();
    } else if (this.connectionMode && this.connectionStart) {
     // Redraw to show connection preview
     this.draw();
    }
   }

   handleMouseLeave(e) {
    // Release drag if mouse leaves canvas
    if (this.isDragging && this.selectedComponent) {
     const snapped = this.snapToGrid(this.selectedComponent.x, this.selectedComponent.y);
     this.selectedComponent.x = snapped.x;
     this.selectedComponent.y = snapped.y;
     this.updatePropertiesPanel();
     this.draw();
    }
    if (this.isDraggingWire && this.selectedWire) {
     const gridSize = 20;
     const snappedStart = this.snapToGrid(this.selectedWire.start.x - 10, this.selectedWire.start.y - 10);
     const snappedEnd = this.snapToGrid(this.selectedWire.end.x - 10, this.selectedWire.end.y - 10);
     
     this.selectedWire.start.x = snappedStart.x + 10;
     this.selectedWire.start.y = snappedStart.y + 10;
     this.selectedWire.end.x = snappedEnd.x + 10;
     this.selectedWire.end.y = snappedEnd.y + 10;
     
     this.updateLEDStates();
     this.updatePropertiesPanel();
     this.draw();
    }
    this.isDragging = false;
    this.isDraggingWire = false;
    this.dragStart = { x: 0, y: 0 };
   }
   handleMouseUp(e) {
    // Handle momentary button release (deactivate on mouseup)
    if (this.activeButton && this.activeButton.type === 'button') {
     this.activeButton.isPressed = false;
     this.activeButton = null;
     this.updateLEDStates();
     this.draw();
     this.updatePropertiesPanel();
    }

    if (this.isDragging && this.editingWire && this.editingWirePoint) {
     // Finish wire editing
     this.draw();
     if (!this.ctrlPressed) {
      this.editingWire = null;
      this.editingWirePoint = null;
     }
    } else if (this.isDraggingWire && this.selectedWire) {
     // Snap wire endpoints to grid
     const gridSize = 20;
     const snappedStart = this.snapToGrid(this.selectedWire.start.x - 10, this.selectedWire.start.y - 10);
     const snappedEnd = this.snapToGrid(this.selectedWire.end.x - 10, this.selectedWire.end.y - 10);
     
     this.selectedWire.start.x = snappedStart.x + 10;
     this.selectedWire.start.y = snappedStart.y + 10;
     this.selectedWire.end.x = snappedEnd.x + 10;
     this.selectedWire.end.y = snappedEnd.y + 10;
     
     this.updateLEDStates();
     this.draw();
     this.updatePropertiesPanel();
    } else if (this.isDragging && this.selectedComponent) {
     const snapped = this.snapToGrid(this.selectedComponent.x, this.selectedComponent.y);
     this.selectedComponent.x = snapped.x;
     this.selectedComponent.y = snapped.y;
     this.draw();
    }
    this.isDragging = false;
    this.isDraggingWire = false;
   }

   handleConnectionClick(x, y) {
    // Determine which grid cell the cursor is in and snap to its center
    const gridSize = 20;
    const cellX = Math.floor(x / gridSize) * gridSize;
    const cellY = Math.floor(y / gridSize) * gridSize;
    // Snap to center of the grid cell
    const centerX = cellX + gridSize / 2;
    const centerY = cellY + gridSize / 2;
    
    if (!this.connectionStart) {
     this.connectionStart = { x: centerX, y: centerY };
    } else {
     this.connections.push({
      start: this.connectionStart,
      end: { x: centerX, y: centerY },
      color: this.getRandomWireColor()
     });
     this.connectionStart = null;
     this.updateLEDStates();
     this.draw();
     this.updateStatusBar();
    }
   }

   getWirePointAt(x, y) {
    // Check if clicking near a wire endpoint (within 10 pixels)
    const threshold = 10;
    for (let conn of this.connections) {
     const distToStart = Math.sqrt(
      Math.pow(x - conn.start.x, 2) + Math.pow(y - conn.start.y, 2)
     );
     if (distToStart < threshold) {
      return { connection: conn, point: 'start' };
     }
     
     const distToEnd = Math.sqrt(
      Math.pow(x - conn.end.x, 2) + Math.pow(y - conn.end.y, 2)
     );
     if (distToEnd < threshold) {
      return { connection: conn, point: 'end' };
     }
    }
    return null;
   }

   getWireAt(x, y) {
    // Check if clicking on a wire line (within 8 pixels of the line)
    const threshold = 8;
    
    for (let conn of this.connections) {
     // Calculate distance from point to line segment
     const dx = conn.end.x - conn.start.x;
     const dy = conn.end.y - conn.start.y;
     const length = Math.sqrt(dx * dx + dy * dy);
     
     if (length === 0) continue; // Degenerate line
     
     // Calculate projection of point onto line
     const t = Math.max(0, Math.min(1, 
      ((x - conn.start.x) * dx + (y - conn.start.y) * dy) / (length * length)
     ));
     
     // Find closest point on line segment
     const closestX = conn.start.x + t * dx;
     const closestY = conn.start.y + t * dy;
     
     // Calculate distance to closest point
     const distance = Math.sqrt(
      Math.pow(x - closestX, 2) + Math.pow(y - closestY, 2)
     );
     
     if (distance < threshold) {
      return conn;
     }
    }
    
    return null;
   }

   moveWireWithConnected(wire, dx, dy) {
    // Move the wire's endpoints
    const oldStart = { x: wire.start.x, y: wire.start.y };
    const oldEnd = { x: wire.end.x, y: wire.end.y };
    
    wire.start.x += dx;
    wire.start.y += dy;
    wire.end.x += dx;
    wire.end.y += dy;
    
    // Find and move connected wires
    const threshold = 5; // Pixels to consider as "connected"
    
    for (let conn of this.connections) {
     if (conn === wire) continue;
     
     // Check if this wire's start was connected to the moved wire's start
     if (Math.abs(conn.start.x - oldStart.x) < threshold && 
         Math.abs(conn.start.y - oldStart.y) < threshold) {
      conn.start.x = wire.start.x;
      conn.start.y = wire.start.y;
     }
     // Check if this wire's start was connected to the moved wire's end
     else if (Math.abs(conn.start.x - oldEnd.x) < threshold && 
              Math.abs(conn.start.y - oldEnd.y) < threshold) {
      conn.start.x = wire.end.x;
      conn.start.y = wire.end.y;
     }
     
     // Check if this wire's end was connected to the moved wire's start
     if (Math.abs(conn.end.x - oldStart.x) < threshold && 
         Math.abs(conn.end.y - oldStart.y) < threshold) {
      conn.end.x = wire.start.x;
      conn.end.y = wire.start.y;
     }
     // Check if this wire's end was connected to the moved wire's end
     else if (Math.abs(conn.end.x - oldEnd.x) < threshold && 
              Math.abs(conn.end.y - oldEnd.y) < threshold) {
      conn.end.x = wire.end.x;
      conn.end.y = wire.end.y;
     }
    }
   }

   getComponentAt(x, y) {
    // Check in reverse order (top to bottom)
    for (let i = this.components.length - 1; i >= 0; i--) {
     const comp = this.components[i];
     if (x >= comp.x && x <= comp.x + comp.width &&
      y >= comp.y && y <= comp.y + comp.height) {
      return comp;
     }
    }
    return null;
   }

   // Check if click is on a 555 pin (returns pin number) or IC body (returns 'body')
   get555ClickZone(comp, x, y) {
    if (comp.type !== 'ne555') return null;
    
    const gridSize = 20;
    const pinsPerSide = comp.pins / 2; // 4 pins per side for 555
    const pinAreaWidth = gridSize;
    
    // Check left side pins (pins 1-4, bottom to top in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x - gridSize;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return i + 1; // Pins 1-4 on left side
     }
    }
    
    // Check right side pins (pins 8-5, bottom to top in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x + comp.width;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return 8 - i; // Pins 8-5 on right side (reversed)
     }
    }
    
    // Check if click is on IC body (inner border area)
    const borderSize = 6;
    if (x >= comp.x + borderSize && x <= comp.x + comp.width - borderSize &&
        y >= comp.y + borderSize && y <= comp.y + comp.height - borderSize) {
     return 'body';
    }
    
    return null;
   }

   // Check if click is on a W65C02S (6502) pin (returns pin number) or IC body (returns 'body')
   get6502ClickZone(comp, x, y) {
    if (comp.type !== 'w65c02s') return null;
    
    const gridSize = 20;
    const pinsPerSide = comp.pins / 2; // 20 pins per side for 40-pin DIP
    
    // Check left side pins (pins 1-20, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x - gridSize;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return i + 1; // Pins 1-20 on left side
     }
    }
    
    // Check right side pins (pins 40-21, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x + comp.width;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return 40 - i; // Pins 40-21 on right side (reversed)
     }
    }
    
    // Check if click is on IC body (inner border area)
    const borderSize = 6;
    if (x >= comp.x + borderSize && x <= comp.x + comp.width - borderSize &&
        y >= comp.y + borderSize && y <= comp.y + comp.height - borderSize) {
     return 'body';
    }
    
    return null;
   }

   // Check if click is on a W65C22 (6522 VIA) pin (returns pin number) or IC body (returns 'body')
   get6522ClickZone(comp, x, y) {
    if (comp.type !== 'w65c22') return null;
    
    const gridSize = 20;
    const pinsPerSide = comp.pins / 2; // 20 pins per side for 40-pin DIP
    
    // Check left side pins (pins 1-20, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x - gridSize;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return i + 1; // Pins 1-20 on left side
     }
    }
    
    // Check right side pins (pins 40-21, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x + comp.width;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return 40 - i; // Pins 40-21 on right side (reversed)
     }
    }
    
    // Check if click is on IC body (inner border area)
    const borderSize = 6;
    if (x >= comp.x + borderSize && x <= comp.x + comp.width - borderSize &&
        y >= comp.y + borderSize && y <= comp.y + comp.height - borderSize) {
     return 'body';
    }
    
    return null;
   }

   // Check if click is on an AT28C256 (EEPROM) pin (returns pin number) or IC body (returns 'body')
   get28c256ClickZone(comp, x, y) {
    if (comp.type !== '28c256') return null;
    
    const gridSize = 20;
    const pinsPerSide = comp.pins / 2; // 14 pins per side for 28-pin DIP
    
    // Check left side pins (pins 1-14, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x - gridSize;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return i + 1; // Pins 1-14 on left side
     }
    }
    
    // Check right side pins (pins 28-15, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x + comp.width;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return 28 - i; // Pins 28-15 on right side (reversed)
     }
    }
    
    // Check if click is on IC body (inner border area)
    const borderSize = 6;
    if (x >= comp.x + borderSize && x <= comp.x + comp.width - borderSize &&
        y >= comp.y + borderSize && y <= comp.y + comp.height - borderSize) {
     return 'body';
    }
    
    return null;
   }

   // Check if click is on a 7400-series (Logic Gate) pin (returns pin number) or IC body (returns 'body')
   get7400ClickZone(comp, x, y) {
    if (comp.type !== '7400-series') return null;
    
    const gridSize = 20;
    const pinsPerSide = comp.pins / 2; // 7 pins per side for 14-pin DIP
    
    // Check left side pins (pins 1-7, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x - gridSize;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return i + 1; // Pins 1-7 on left side
     }
    }
    
    // Check right side pins (pins 14-8, top to bottom in standard DIP orientation)
    for (let i = 0; i < pinsPerSide; i++) {
     const pinY = comp.y + (i * gridSize);
     const pinX = comp.x + comp.width;
     if (x >= pinX && x <= pinX + gridSize && y >= pinY && y <= pinY + gridSize) {
      return 14 - i; // Pins 14-8 on right side (reversed)
     }
    }
    
    // Check if click is on IC body (inner border area)
    const borderSize = 6;
    if (x >= comp.x + borderSize && x <= comp.x + comp.width - borderSize &&
        y >= comp.y + borderSize && y <= comp.y + comp.height - borderSize) {
     return 'body';
    }
    
    return null;
   }

   addComponent(type, x, y) {
    const snapped = this.snapToGrid(x, y);
    const component = {
     type,
     x: snapped.x,
     y: snapped.y,
     id: Date.now() + Math.random(),
     rotation: 0,
     ...this.getComponentSpecs(type)
    };

    this.components.push(component);
    this.updateLEDStates();
    this.draw();
    this.updateStatusBar();
   }

   getComponentSpecs(type) {
    const gridSize = 20;
    const specs = {
     'w65c02s': {
      width: gridSize * 6,
      height: gridSize * 20,
      pins: 40,
      label: 'W65C02S',
      color: '#2c3e50'
     },
     '28c256': {
      width: gridSize * 6,
      height: gridSize * 14,
      pins: 28,
      label: '28C256',
      color: '#34495e'
     },
     '62256': {
      width: gridSize * 6,
      height: gridSize * 14,
      pins: 28,
      label: '62256',
      color: '#2c3e50'
     },
     'w65c22': {
      width: gridSize * 6,
      height: gridSize * 20,
      pins: 40,
      label: 'W65C22',
      color: '#2c3e50'
     },
     '7400-series': {
      width: gridSize * 4,
      height: gridSize * 7,
      pins: 14,
      label: '7400',
      chipType: '7400',
      color: '#7f8c8d'
     },
     'ne555': {
      width: gridSize * 3,
      height: gridSize * 4,
      pins: 8,
      label: 'NE555',
      color: '#95a5a6'
     },
     'led': {
      width: gridSize * 1,
      height: gridSize * 1,
      pins: 2,
      label: 'LED',
      color: '#c0392b',
      value: 'Red',
      isPowered: false
     },
     'resistor': {
      width: gridSize * 2,
      height: gridSize * 1,
      pins: 2,
      label: 'R',
      color: '#95a5a6',
      value: '1kŒ©'
     },
     'capacitor': {
      width: gridSize * 1,
      height: gridSize * 2,
      pins: 2,
      label: 'C',
      color: '#3498db',
      value: '100nF'
     },
     'switch': {
      width: gridSize * 2,
      height: gridSize * 2,
      pins: 4,
      label: 'SW',
      color: '#34495e',
      isPressed: false
     },
     'button': {
      width: gridSize * 2,
      height: gridSize * 2,
      pins: 4,
      label: 'BTN',
      color: '#2c3e50',
      isPressed: false,
      isMomentary: true
     },
     'crystal': {
      width: gridSize * 2,
      height: gridSize * 2,
      pins: 4,
      label: 'XTAL',
      color: '#1abc9c',
      value: '1MHz'
     },
     'potentiometer': {
      width: gridSize * 2,
      height: gridSize * 2,
      pins: 3,
      label: 'POT',
      color: '#3498db',
      value: '10kŒ©'
     },
     'photoresistor': {
      width: gridSize * 1.5,
      height: gridSize * 1.5,
      pins: 2,
      label: 'LDR',
      color: '#e67e22',
      value: '10kŒ©-1MŒ©'
     },
     'power': {
      width: gridSize * 1,
      height: gridSize * 1,
      pins: 1,
      label: '+5V',
      color: '#c0392b'
     },
     'ground': {
      width: gridSize * 1,
      height: gridSize * 1,
      pins: 1,
      label: 'GND',
      color: '#34495e'
     }
    };

    return specs[type] || specs['resistor'];
   }

   getRandomWireColor() {
    const colors = ['#3498db', '#2ecc71', '#1abc9c', '#34495e', '#16a085', '#2980b9', '#27ae60'];
    return colors[Math.floor(Math.random() * colors.length)];
   }

   snapToGrid(x, y) {
    const gridSize = 20;
    return {
     x: Math.round(x / gridSize) * gridSize,
     y: Math.round(y / gridSize) * gridSize
    };
   }

   draw() {
    // Clear canvas
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

    // Save context and apply transformations
    this.ctx.save();
    this.ctx.translate(this.offset.x, this.offset.y);
    this.ctx.scale(this.zoom, this.zoom);

    // Draw breadboard background
    this.drawBreadboard();

    // Draw grid if enabled
    if (this.showGrid) {
     this.drawGrid();
    }

    // Draw connections
    this.drawConnections();

    // Draw components
    this.drawComponents();

    // Draw connection preview if in connection mode
    if (this.connectionMode && this.connectionStart) {
     this.drawConnectionPreview();
    }

    // Restore context
    this.ctx.restore();
   }

   drawBreadboard() {
    // Background
    this.ctx.fillStyle = '#fafafa';
    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

    // Draw power rails
    const railHeight = 30;
    const railY1 = 50;
    const railY2 = this.canvas.height - 80;

    // Positive rail (red)
    this.ctx.fillStyle = '#ffe5e5';
    this.ctx.fillRect(20, railY1, this.canvas.width - 40, railHeight);
    this.ctx.fillRect(20, railY2, this.canvas.width - 40, railHeight);

    // Ground rail (blue)
    this.ctx.fillStyle = '#e3f2fd';
    this.ctx.fillRect(20, railY1 + railHeight + 10, this.canvas.width - 40, railHeight);
    this.ctx.fillRect(20, railY2 + railHeight + 10, this.canvas.width - 40, railHeight);

    // Draw labels
    this.ctx.fillStyle = '#666';
    this.ctx.font = 'bold 14px sans-serif';
    this.ctx.fillText('+', 30, railY1 + 20);
    this.ctx.fillText('-', 30, railY1 + railHeight + 30);
    this.ctx.fillText('+', 30, railY2 + 20);
    this.ctx.fillText('-', 30, railY2 + railHeight + 30);
   }

   drawGrid() {
    const gridSize = 20;
    this.ctx.strokeStyle = '#e0e0e0';
    this.ctx.lineWidth = 0.5;

    // Vertical lines
    for (let x = 0; x < this.canvas.width; x += gridSize) {
     this.ctx.beginPath();
     this.ctx.moveTo(x, 0);
     this.ctx.lineTo(x, this.canvas.height);
     this.ctx.stroke();
    }

    // Horizontal lines
    for (let y = 0; y < this.canvas.height; y += gridSize) {
     this.ctx.beginPath();
     this.ctx.moveTo(0, y);
     this.ctx.lineTo(this.canvas.width, y);
     this.ctx.stroke();
    }
   }

   drawConnections() {
    this.connections.forEach(conn => {
     const isSelected = conn === this.selectedWire;
     
     // Draw selection highlight for selected wire
     if (isSelected) {
      this.ctx.strokeStyle = '#FFD700';
      this.ctx.lineWidth = 7;
      this.ctx.beginPath();
      this.ctx.moveTo(conn.start.x, conn.start.y);
      this.ctx.lineTo(conn.end.x, conn.end.y);
      this.ctx.stroke();
     }
     
     this.ctx.strokeStyle = conn.color;
     this.ctx.lineWidth = 3;
     this.ctx.beginPath();
     this.ctx.moveTo(conn.start.x, conn.start.y);
     this.ctx.lineTo(conn.end.x, conn.end.y);
     this.ctx.stroke();

     // Draw connection points (larger if selected)
     this.ctx.fillStyle = isSelected ? '#FFD700' : conn.color;
     const pointRadius = isSelected ? 6 : 4;
     this.ctx.beginPath();
     this.ctx.arc(conn.start.x, conn.start.y, pointRadius, 0, Math.PI * 2);
     this.ctx.fill();
     this.ctx.beginPath();
     this.ctx.arc(conn.end.x, conn.end.y, pointRadius, 0, Math.PI * 2);
     this.ctx.fill();
    });
   }

   drawConnectionPreview() {
    if (this.connectionStart && this.mousePos) {
     this.ctx.strokeStyle = '#2196F3';
     this.ctx.lineWidth = 3;
     this.ctx.setLineDash([5, 5]);
     this.ctx.beginPath();
     this.ctx.moveTo(this.connectionStart.x, this.connectionStart.y);
     this.ctx.lineTo(this.mousePos.x, this.mousePos.y);
     this.ctx.stroke();
     this.ctx.setLineDash([]);

     // Draw start point
     this.ctx.fillStyle = '#2196F3';
     this.ctx.beginPath();
     this.ctx.arc(this.connectionStart.x, this.connectionStart.y, 5, 0, Math.PI * 2);
     this.ctx.fill();
    }
    
    // Highlight selected wire in wire mode (even when Ctrl is not pressed)
    if (this.connectionMode && this.selectedWire && !this.isDragging) {
     const conn = this.selectedWire;
     // Draw highlight glow around the selected wire
     this.ctx.strokeStyle = '#FFD700';
     this.ctx.lineWidth = 8;
     this.ctx.lineCap = 'round';
     this.ctx.globalAlpha = 0.4;
     this.ctx.beginPath();
     this.ctx.moveTo(conn.start.x, conn.start.y);
     this.ctx.lineTo(conn.end.x, conn.end.y);
     this.ctx.stroke();
     this.ctx.globalAlpha = 1.0;
     this.ctx.lineCap = 'butt';
    }
    
    // Highlight wire endpoints when Ctrl is pressed in wire mode
    if (this.connectionMode && this.ctrlPressed && !this.isDragging) {
     this.connections.forEach(conn => {
      const isSelectedWire = conn === this.selectedWire;
      
      // Highlight all wire endpoints (more prominent for selected wire)
      this.ctx.strokeStyle = isSelectedWire ? '#FF6600' : '#FFD700';
      this.ctx.lineWidth = isSelectedWire ? 3 : 2;
      this.ctx.fillStyle = isSelectedWire ? 'rgba(255, 102, 0, 0.4)' : 'rgba(255, 215, 0, 0.3)';
      
      // Check if this endpoint is being hovered
      const isStartHovered = this.hoveredWirePoint && 
       this.hoveredWirePoint.connection === conn && 
       this.hoveredWirePoint.point === 'start';
      const isEndHovered = this.hoveredWirePoint && 
       this.hoveredWirePoint.connection === conn && 
       this.hoveredWirePoint.point === 'end';
      
      // Draw start endpoint
      if (isStartHovered) {
       this.ctx.strokeStyle = '#00FF00';
       this.ctx.lineWidth = 4;
       this.ctx.fillStyle = 'rgba(0, 255, 0, 0.5)';
      }
      this.ctx.beginPath();
      this.ctx.arc(conn.start.x, conn.start.y, isStartHovered ? 10 : 8, 0, Math.PI * 2);
      this.ctx.fill();
      this.ctx.stroke();
      
      // Reset style for end endpoint
      this.ctx.strokeStyle = isSelectedWire ? '#FF6600' : '#FFD700';
      this.ctx.lineWidth = isSelectedWire ? 3 : 2;
      this.ctx.fillStyle = isSelectedWire ? 'rgba(255, 102, 0, 0.4)' : 'rgba(255, 215, 0, 0.3)';
      
      // Draw end endpoint
      if (isEndHovered) {
       this.ctx.strokeStyle = '#00FF00';
       this.ctx.lineWidth = 4;
       this.ctx.fillStyle = 'rgba(0, 255, 0, 0.5)';
      }
      this.ctx.beginPath();
      this.ctx.arc(conn.end.x, conn.end.y, isEndHovered ? 10 : 8, 0, Math.PI * 2);
      this.ctx.fill();
      this.ctx.stroke();
     });
    }
   }

   drawComponents() {
    this.components.forEach(comp => {
     // Draw LED glow effect if powered
     if (comp.type === 'led' && comp.isPowered) {
      const glowRadius = 40;
      const centerX = comp.x + comp.width / 2;
      const centerY = comp.y + comp.height / 2;
      
      // Draw multiple layers for stronger glow
      for (let i = 0; i < 3; i++) {
       const radius = glowRadius - (i * 10);
       const gradient = this.ctx.createRadialGradient(
        centerX, centerY, 0,
        centerX, centerY, radius
       );
       
       const glowColor = this.getLEDLitColor(comp.color);
       gradient.addColorStop(0, glowColor + 'cc');
       gradient.addColorStop(0.4, glowColor + '66');
       gradient.addColorStop(0.7, glowColor + '22');
       gradient.addColorStop(1, glowColor + '00');
       
       this.ctx.fillStyle = gradient;
       this.ctx.fillRect(
        comp.x - radius,
        comp.y - radius,
        comp.width + radius * 2,
        comp.height + radius * 2
       );
      }
     }
     
     // Draw 555 output glow when output is HIGH
     if (comp.type === 'ne555' && comp.outputState) {
      const gridSize = 20;
      // Pin 3 (OUT) is at position index 1 on left side (from top: 4, 3, 2, 1)
      const outputPinX = comp.x - gridSize / 2;
      const outputPinY = comp.y + gridSize + gridSize / 2; // Second row
      
      const glowRadius = 25;
      const gradient = this.ctx.createRadialGradient(
       outputPinX, outputPinY, 0,
       outputPinX, outputPinY, glowRadius
      );
      gradient.addColorStop(0, '#4CAF50cc');
      gradient.addColorStop(0.5, '#4CAF5066');
      gradient.addColorStop(1, '#4CAF5000');
      
      this.ctx.fillStyle = gradient;
      this.ctx.beginPath();
      this.ctx.arc(outputPinX, outputPinY, glowRadius, 0, Math.PI * 2);
      this.ctx.fill();
     }
     
     // Draw component body
     let bodyColor = comp.color;
     if (comp.type === 'led' && comp.isPowered) {
      bodyColor = this.getLEDLitColor(comp.color);
     } else if ((comp.type === 'button' || comp.type === 'switch') && comp.isPressed) {
      bodyColor = '#27ae60'; // Green when pressed
     } else if (comp.type === 'ne555' && comp.hasPower) {
      bodyColor = '#2c3e50'; // Darker when powered
     }
     this.ctx.fillStyle = bodyColor;
     
     // Calculate body position (offset for capacitor to center with pins)
     const gridSize = 20;
     const rotation = comp.rotation || 0;
     const isVertical = (rotation === 90 || rotation === 270);
     let bodyX = comp.x;
     let bodyY = comp.y;
     if (comp.type === 'capacitor') {
      if (!isVertical) {
       bodyY = comp.y + gridSize / 2; // Move down to center with pins
      } else {
       bodyX = comp.x + gridSize / 2; // Move right to center with pins
      }
     }
     this.ctx.fillRect(bodyX, bodyY, comp.width, comp.height);

     // For buttons and switches, draw an inner area to indicate the toggle zone
     if (comp.type === 'button' || comp.type === 'switch') {
      const borderSize = 8;
      this.ctx.fillStyle = comp.isPressed ? 'rgba(255,255,255,0.4)' : 'rgba(0,0,0,0.2)';
      this.ctx.fillRect(
       comp.x + borderSize,
       comp.y + borderSize,
       comp.width - borderSize * 2,
       comp.height - borderSize * 2
      );
      // Draw 'M' or 'T' label for momentary/toggle indication
      this.ctx.fillStyle = comp.isPressed ? '#fff' : '#666';
      this.ctx.font = 'bold 10px sans-serif';
      this.ctx.textAlign = 'right';
      this.ctx.textBaseline = 'top';
      this.ctx.fillText(comp.type === 'button' ? 'M' : 'T', comp.x + comp.width - 3, comp.y + 2);
     }
     
     // Draw 555 output indicator on the IC
     if (comp.type === 'ne555') {
      const gridSize = 20;
      const rotation = comp.rotation || 0;
      
      // Draw small LED-like indicator for output state - position depends on rotation
      let indicatorX, indicatorY;
      if (rotation === 0) {
       indicatorX = comp.x + comp.width / 2;
       indicatorY = comp.y + 8;
      } else if (rotation === 90) {
       indicatorX = comp.x + comp.width - 8;
       indicatorY = comp.y + comp.height / 2;
      } else if (rotation === 180) {
       indicatorX = comp.x + comp.width / 2;
       indicatorY = comp.y + comp.height - 8;
      } else { // 270
       indicatorX = comp.x + 8;
       indicatorY = comp.y + comp.height / 2;
      }
      const indicatorRadius = 4;
      
      this.ctx.beginPath();
      this.ctx.arc(indicatorX, indicatorY, indicatorRadius, 0, Math.PI * 2);
      this.ctx.fillStyle = comp.outputState ? '#4CAF50' : '#333';
      this.ctx.fill();
      this.ctx.strokeStyle = '#000';
      this.ctx.lineWidth = 1;
      this.ctx.stroke();
      
      // Draw notch to indicate pin 1 orientation - position depends on rotation
      this.ctx.beginPath();
      if (rotation === 0) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y, 6, 0, Math.PI, false);
      } else if (rotation === 90) {
       this.ctx.arc(comp.x + comp.width, comp.y + comp.height / 2, 6, -Math.PI / 2, Math.PI / 2, true);
      } else if (rotation === 180) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y + comp.height, 6, 0, Math.PI, true);
      } else { // 270
       this.ctx.arc(comp.x, comp.y + comp.height / 2, 6, -Math.PI / 2, Math.PI / 2, false);
      }
      this.ctx.fillStyle = '#666';
      this.ctx.fill();
     }

     // Draw notch/dimple for W65C02S (6502) chip - position depends on rotation
     if (comp.type === 'w65c02s') {
      const rotation = comp.rotation || 0;
      this.ctx.beginPath();
      if (rotation === 0) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y, 8, 0, Math.PI, false);
      } else if (rotation === 90) {
       this.ctx.arc(comp.x + comp.width, comp.y + comp.height / 2, 8, -Math.PI / 2, Math.PI / 2, true);
      } else if (rotation === 180) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y + comp.height, 8, 0, Math.PI, true);
      } else if (rotation === 270) {
       this.ctx.arc(comp.x, comp.y + comp.height / 2, 8, -Math.PI / 2, Math.PI / 2, false);
      }
      this.ctx.fillStyle = '#1a2a3a';
      this.ctx.fill();
     }

     // Draw notch/dimple for W65C22 (6522 VIA) chip - position depends on rotation
     if (comp.type === 'w65c22') {
      const rotation = comp.rotation || 0;
      this.ctx.beginPath();
      if (rotation === 0) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y, 8, 0, Math.PI, false);
      } else if (rotation === 90) {
       this.ctx.arc(comp.x + comp.width, comp.y + comp.height / 2, 8, -Math.PI / 2, Math.PI / 2, true);
      } else if (rotation === 180) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y + comp.height, 8, 0, Math.PI, true);
      } else if (rotation === 270) {
       this.ctx.arc(comp.x, comp.y + comp.height / 2, 8, -Math.PI / 2, Math.PI / 2, false);
      }
      this.ctx.fillStyle = '#1a2a3a';
      this.ctx.fill();
     }

     // Draw notch/dimple for 28C256 (EEPROM) chip - position depends on rotation
     if (comp.type === '28c256') {
      const rotation = comp.rotation || 0;
      this.ctx.beginPath();
      if (rotation === 0) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y, 7, 0, Math.PI, false);
      } else if (rotation === 90) {
       this.ctx.arc(comp.x + comp.width, comp.y + comp.height / 2, 7, -Math.PI / 2, Math.PI / 2, true);
      } else if (rotation === 180) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y + comp.height, 7, 0, Math.PI, true);
      } else if (rotation === 270) {
       this.ctx.arc(comp.x, comp.y + comp.height / 2, 7, -Math.PI / 2, Math.PI / 2, false);
      }
      this.ctx.fillStyle = '#222e3a';
      this.ctx.fill();
     }

     // Draw notch/dimple for 62256 (SRAM) chip - position depends on rotation
     if (comp.type === '62256') {
      const rotation = comp.rotation || 0;
      this.ctx.beginPath();
      if (rotation === 0) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y, 7, 0, Math.PI, false);
      } else if (rotation === 90) {
       this.ctx.arc(comp.x + comp.width, comp.y + comp.height / 2, 7, -Math.PI / 2, Math.PI / 2, true);
      } else if (rotation === 180) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y + comp.height, 7, 0, Math.PI, true);
      } else if (rotation === 270) {
       this.ctx.arc(comp.x, comp.y + comp.height / 2, 7, -Math.PI / 2, Math.PI / 2, false);
      }
      this.ctx.fillStyle = '#1a252f';
      this.ctx.fill();
     }

     // Draw notch/dimple for 7400-series logic chips - position depends on rotation
     if (comp.type === '7400-series') {
      const rotation = comp.rotation || 0;
      this.ctx.beginPath();
      if (rotation === 0) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y, 6, 0, Math.PI, false);
      } else if (rotation === 90) {
       this.ctx.arc(comp.x + comp.width, comp.y + comp.height / 2, 6, -Math.PI / 2, Math.PI / 2, true);
      } else if (rotation === 180) {
       this.ctx.arc(comp.x + comp.width / 2, comp.y + comp.height, 6, 0, Math.PI, true);
      } else if (rotation === 270) {
       this.ctx.arc(comp.x, comp.y + comp.height / 2, 6, -Math.PI / 2, Math.PI / 2, false);
      }
      this.ctx.fillStyle = '#5a6a7a';
      this.ctx.fill();
     }

     // Draw potentiometer dial/knob
     if (comp.type === 'potentiometer') {
      const centerX = comp.x + comp.width / 2;
      const centerY = comp.y + comp.height / 2;
      const dialRadius = Math.min(comp.width, comp.height) / 2 - 4;
      
      // Draw outer dial ring
      this.ctx.beginPath();
      this.ctx.arc(centerX, centerY, dialRadius, 0, Math.PI * 2);
      this.ctx.fillStyle = '#1a252f';
      this.ctx.fill();
      
      // Draw center indicator/knob
      this.ctx.beginPath();
      this.ctx.arc(centerX, centerY, dialRadius / 2, 0, Math.PI * 2);
      this.ctx.fillStyle = '#c0c0c0';
      this.ctx.fill();
      
      // Draw position marker
      this.ctx.beginPath();
      this.ctx.moveTo(centerX, centerY - dialRadius / 2 + 2);
      this.ctx.lineTo(centerX, centerY - dialRadius + 2);
      this.ctx.strokeStyle = '#fff';
      this.ctx.lineWidth = 2;
      this.ctx.stroke();
      this.ctx.lineWidth = 1;
     }

     // Draw photoresistor zigzag pattern
     if (comp.type === 'photoresistor') {
      const centerX = comp.x + comp.width / 2;
      const centerY = comp.y + comp.height / 2;
      const radius = Math.min(comp.width, comp.height) / 2 - 3;
      
      // Draw circular sensor area
      this.ctx.beginPath();
      this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      this.ctx.fillStyle = '#d35400';
      this.ctx.fill();
      
      // Draw zigzag resistive element
      this.ctx.beginPath();
      this.ctx.moveTo(centerX - radius + 5, centerY - 3);
      this.ctx.lineTo(centerX - radius / 2, centerY + 3);
      this.ctx.lineTo(centerX, centerY - 3);
      this.ctx.lineTo(centerX + radius / 2, centerY + 3);
      this.ctx.lineTo(centerX + radius - 5, centerY - 3);
      this.ctx.strokeStyle = '#2c3e50';
      this.ctx.lineWidth = 2;
      this.ctx.stroke();
      this.ctx.lineWidth = 1;
     }

     // Draw border (thicker if selected) - use body offset for capacitor
     this.ctx.strokeStyle = comp === this.selectedComponent ? '#2196F3' : '#000';
     this.ctx.lineWidth = comp === this.selectedComponent ? 3 : 1;
     if (comp.type === 'capacitor') {
      this.ctx.strokeRect(bodyX, bodyY, comp.width, comp.height);
     } else {
      this.ctx.strokeRect(comp.x, comp.y, comp.width, comp.height);
     }

     // Draw label - use body offset for capacitor
     this.ctx.fillStyle = '#fff';
     this.ctx.font = 'bold 12px monospace';
     this.ctx.textAlign = 'center';
     this.ctx.textBaseline = 'middle';
     if (comp.type === 'capacitor') {
      this.ctx.fillText(comp.label, bodyX + comp.width / 2, bodyY + comp.height / 2);
     } else {
      this.ctx.fillText(comp.label, comp.x + comp.width / 2, comp.y + comp.height / 2);
     }

     // Draw pins
     if (comp.pins && comp.pins > 2) {
      if (comp.type === 'button' || comp.type === 'switch' || comp.type === 'crystal' || comp.type === 'potentiometer') {
       this.drawSimpleComponentPins(comp);
      } else {
       this.drawICPins(comp);
      }
     } else if (comp.pins === 2) {
      if (comp.type === 'photoresistor') {
       this.drawSimpleComponentPins(comp);
      } else {
       this.drawTwoPinComponent(comp);
      }
     }

     // Draw value if exists - use body offset for capacitor
     if (comp.value) {
      this.ctx.fillStyle = '#333';
      this.ctx.font = '10px sans-serif';
      if (comp.type === 'capacitor') {
       this.ctx.fillText(comp.value, bodyX + comp.width / 2, bodyY + comp.height + 15);
      } else {
       this.ctx.fillText(comp.value, comp.x + comp.width / 2, comp.y + comp.height + 15);
      }
     }
    });
   }

   drawICPins(comp) {
    const gridSize = 20;
    const pinRenderSize = 16; // 20px grid - 2px on each side
    const pinMargin = 2; // 2px margin on each side
    const rotation = comp.rotation || 0;
    
    this.ctx.fillStyle = '#c0c0c0';

    // Determine pin layout based on rotation
    // Original layout: pins on left and right sides
    // After rotation, pins follow the component orientation
    if (rotation === 0 || rotation === 180) {
     // Horizontal IC - pins on left and right
     const pinsPerSide = comp.pins / 2;
     
     // Left side pins
     for (let i = 0; i < pinsPerSide; i++) {
      const y = comp.y + (i * gridSize);
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       y + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }

     // Right side pins
     for (let i = 0; i < pinsPerSide; i++) {
      const y = comp.y + (i * gridSize);
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       y + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    } else {
     // Vertical IC (90 or 270 degrees) - pins on top and bottom
     const pinsPerSide = comp.pins / 2;
     
     // Top side pins
     for (let i = 0; i < pinsPerSide; i++) {
      const x = comp.x + (i * gridSize);
      this.ctx.fillRect(
       x + pinMargin,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }

     // Bottom side pins
     for (let i = 0; i < pinsPerSide; i++) {
      const x = comp.x + (i * gridSize);
      this.ctx.fillRect(
       x + pinMargin,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    }
   }

   drawTwoPinComponent(comp) {
    const gridSize = 20;
    const pinRenderSize = 16; // 20px grid - 2px on each side
    const pinMargin = 2; // 2px margin on each side
    const rotation = comp.rotation || 0;
    const isVertical = (rotation === 90 || rotation === 270);
    
    this.ctx.fillStyle = '#c0c0c0';
    this.ctx.strokeStyle = '#888';
    this.ctx.lineWidth = 2;

    if (comp.type === 'resistor') {
     if (!isVertical) {
      // Horizontal resistor - pins on left and right
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + (comp.height - pinRenderSize) / 2,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + (comp.height - pinRenderSize) / 2,
       pinRenderSize,
       pinRenderSize
      );
     } else {
      // Vertical resistor - pins on top and bottom
      this.ctx.fillRect(
       comp.x + (comp.width - pinRenderSize) / 2,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + (comp.width - pinRenderSize) / 2,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    } else if (comp.type === 'led') {
     if (!isVertical) {
      // Horizontal LED - pins on left (anode) and right (cathode)
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + (comp.height - pinRenderSize) / 2,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + (comp.height - pinRenderSize) / 2,
       pinRenderSize,
       pinRenderSize
      );
      
      // Draw + and - indicators for horizontal
      this.ctx.fillStyle = '#333';
      this.ctx.font = 'bold 10px sans-serif';
      this.ctx.textAlign = 'center';
      this.ctx.fillText('+', comp.x - gridSize / 2, comp.y - 3);
      this.ctx.fillText('-', comp.x + comp.width + gridSize / 2, comp.y - 3);
     } else {
      // Vertical LED - pins on top (anode) and bottom (cathode)
      this.ctx.fillRect(
       comp.x + (comp.width - pinRenderSize) / 2,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + (comp.width - pinRenderSize) / 2,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      
      // Draw + and - indicators for vertical
      this.ctx.fillStyle = '#333';
      this.ctx.font = 'bold 10px sans-serif';
      this.ctx.textAlign = 'center';
      this.ctx.fillText('+', comp.x + comp.width / 2, comp.y - gridSize - 3);
      this.ctx.fillText('-', comp.x + comp.width / 2, comp.y + comp.height + gridSize + 13);
     }
    } else if (comp.type === 'capacitor') {
     if (!isVertical) {
      // Horizontal capacitor - pins on left and right, centered on grid cells
      this.ctx.fillRect(
       comp.x - gridSize + (gridSize - pinRenderSize) / 2,
       comp.y + (comp.height - pinRenderSize) / 2 + gridSize / 2,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + comp.width + (gridSize - pinRenderSize) / 2,
       comp.y + (comp.height - pinRenderSize) / 2 + gridSize / 2,
       pinRenderSize,
       pinRenderSize
      );
     } else {
      // Vertical capacitor - pins on top and bottom, centered on grid cells
      this.ctx.fillRect(
       comp.x + (comp.width - pinRenderSize) / 2 + gridSize / 2,
       comp.y - gridSize + (gridSize - pinRenderSize) / 2,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + (comp.width - pinRenderSize) / 2 + gridSize / 2,
       comp.y + comp.height + (gridSize - pinRenderSize) / 2,
       pinRenderSize,
       pinRenderSize
      );
     }
    }
   }

   getLEDLitColor(baseColor) {
    // Make LED color brighter when lit - return RGB values for gradient compatibility
    const colors = {
     '#c0392b': '#ff5555', // Red -> Bright Red
     '#27ae60': '#55ff55', // Green -> Bright Green
     '#2980b9': '#5555ff', // Blue -> Bright Blue
     '#f39c12': '#ffdd33', // Orange -> Bright Orange
     '#8e44ad': '#cc55ff', // Purple -> Bright Purple
     '#16a085': '#55ffbb', // Teal -> Bright Teal
     '#d35400': '#ff7733'  // Dark Orange -> Bright Orange
    };
    return colors[baseColor] || baseColor;
   }

   getComponentPinPositions(comp) {
    const gridSize = 20;
    const positions = [];
    const rotation = comp.rotation || 0;
    const isVertical = (rotation === 90 || rotation === 270);
    
    if (comp.type === 'led') {
     if (!isVertical) {
      // Horizontal LED - pins on left and right
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'anode'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'cathode'
      });
     } else {
      // Vertical LED - pins on top and bottom
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y - gridSize / 2,
       type: 'anode'
      });
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'cathode'
      });
     }
    } else if (comp.type === 'resistor') {
     if (!isVertical) {
      // Horizontal resistor - pins on left and right
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'terminal'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'terminal'
      });
     } else {
      // Vertical resistor - pins on top and bottom
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y - gridSize / 2,
       type: 'terminal'
      });
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'terminal'
      });
     }
    } else if (comp.type === 'power') {
     positions.push({
      x: comp.x + comp.width / 2,
      y: comp.y + comp.height / 2,
      type: 'power'
     });
    } else if (comp.type === 'ground') {
     positions.push({
      x: comp.x + comp.width / 2,
      y: comp.y + comp.height / 2,
      type: 'ground'
     });
    } else if (comp.type === 'button' || comp.type === 'switch') {
     // Button/Switch has 4 pins - layout depends on rotation
     const pinType = comp.type === 'button' ? 'button' : 'switch';
     if (!isVertical) {
      // Left-top pin
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + gridSize / 2,
       type: `${pinType}-left`
      });
      // Left-bottom pin
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + gridSize + gridSize / 2,
       type: `${pinType}-left`
      });
      // Right-top pin
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + gridSize / 2,
       type: `${pinType}-right`
      });
      // Right-bottom pin
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + gridSize + gridSize / 2,
       type: `${pinType}-right`
      });
     } else {
      // Rotated - pins on top and bottom
      positions.push({
       x: comp.x + gridSize / 2,
       y: comp.y - gridSize / 2,
       type: `${pinType}-top`
      });
      positions.push({
       x: comp.x + gridSize + gridSize / 2,
       y: comp.y - gridSize / 2,
       type: `${pinType}-top`
      });
      positions.push({
       x: comp.x + gridSize / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: `${pinType}-bottom`
      });
      positions.push({
       x: comp.x + gridSize + gridSize / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: `${pinType}-bottom`
      });
     }
    } else if (comp.type === 'crystal') {
     // Crystal has 4 pins - layout depends on rotation
     if (!isVertical) {
      // Horizontal - pins on left and right
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + gridSize / 2,
       type: 'crystal-left'
      });
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + gridSize + gridSize / 2,
       type: 'crystal-left'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + gridSize / 2,
       type: 'crystal-right'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + gridSize + gridSize / 2,
       type: 'crystal-right'
      });
     } else {
      // Vertical - pins on top and bottom
      positions.push({
       x: comp.x + gridSize / 2,
       y: comp.y - gridSize / 2,
       type: 'crystal-top'
      });
      positions.push({
       x: comp.x + gridSize + gridSize / 2,
       y: comp.y - gridSize / 2,
       type: 'crystal-top'
      });
      positions.push({
       x: comp.x + gridSize / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'crystal-bottom'
      });
      positions.push({
       x: comp.x + gridSize + gridSize / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'crystal-bottom'
      });
     }
    } else if (comp.type === 'ne555') {
     // NE555 has 8 pins - 4 on each side
     const pinsPerSide = 4;
     
     if (!isVertical) {
      // Normal horizontal orientation
      // Left side pins (from top: 4, 3, 2, 1)
      for (let i = 0; i < pinsPerSide; i++) {
       const pinNum = 4 - i;
       positions.push({
        x: comp.x - gridSize / 2,
        y: comp.y + (i * gridSize) + gridSize / 2,
        type: `555-pin-${pinNum}`,
        pinNumber: pinNum
       });
      }
      
      // Right side pins (from top: 8, 7, 6, 5)
      for (let i = 0; i < pinsPerSide; i++) {
       const pinNum = 8 - i;
       positions.push({
        x: comp.x + comp.width + gridSize / 2,
        y: comp.y + (i * gridSize) + gridSize / 2,
        type: `555-pin-${pinNum}`,
        pinNumber: pinNum
       });
      }
     } else {
      // Vertical orientation - pins on top and bottom
      // Top side pins
      for (let i = 0; i < pinsPerSide; i++) {
       const pinNum = rotation === 90 ? (8 - i) : (1 + i);
       positions.push({
        x: comp.x + (i * gridSize) + gridSize / 2,
        y: comp.y - gridSize / 2,
        type: `555-pin-${pinNum}`,
        pinNumber: pinNum
       });
      }
      
      // Bottom side pins
      for (let i = 0; i < pinsPerSide; i++) {
       const pinNum = rotation === 90 ? (4 - i) : (5 + i);
       positions.push({
        x: comp.x + (i * gridSize) + gridSize / 2,
        y: comp.y + comp.height + gridSize / 2,
        type: `555-pin-${pinNum}`,
        pinNumber: pinNum
       });
      }
     }
    } else if (comp.type === 'capacitor') {
     if (!isVertical) {
      // Horizontal capacitor - pins on left and right, centered on grid cells
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + comp.height / 2 + gridSize / 2,
       type: 'terminal'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + comp.height / 2 + gridSize / 2,
       type: 'terminal'
      });
     } else {
      // Vertical capacitor - pins on top and bottom, centered on grid cells
      positions.push({
       x: comp.x + comp.width / 2 + gridSize / 2,
       y: comp.y - gridSize / 2,
       type: 'terminal'
      });
      positions.push({
       x: comp.x + comp.width / 2 + gridSize / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'terminal'
      });
     }
    } else if (comp.type === 'potentiometer') {
     // Potentiometer has 3 pins: left (terminal 1), center (wiper), right (terminal 2)
     if (!isVertical) {
      // Horizontal - pins on left, center-bottom, right
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'pot-terminal-1'
      });
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'pot-wiper'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'pot-terminal-2'
      });
     } else {
      // Vertical - pins on top, center-right, bottom
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y - gridSize / 2,
       type: 'pot-terminal-1'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'pot-wiper'
      });
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'pot-terminal-2'
      });
     }
    } else if (comp.type === 'photoresistor') {
     // Photoresistor has 2 pins like a resistor
     if (!isVertical) {
      positions.push({
       x: comp.x - gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'terminal'
      });
      positions.push({
       x: comp.x + comp.width + gridSize / 2,
       y: comp.y + comp.height / 2,
       type: 'terminal'
      });
     } else {
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y - gridSize / 2,
       type: 'terminal'
      });
      positions.push({
       x: comp.x + comp.width / 2,
       y: comp.y + comp.height + gridSize / 2,
       type: 'terminal'
      });
     }
    }
    
    return positions;
   }
   
   // Get a specific 555 pin position by pin number
   get555PinPosition(comp, pinNumber) {
    if (comp.type !== 'ne555') return null;
    const pins = this.getComponentPinPositions(comp);
    return pins.find(p => p.pinNumber === pinNumber);
   }

   isPointNear(p1, p2, threshold = 15) {
    const dx = p1.x - p2.x;
    const dy = p1.y - p2.y;
    return Math.sqrt(dx * dx + dy * dy) < threshold;
   }

   traceConnection(startPoint, targetType, visited = new Set()) {
    // Trace connections from a point to find if it reaches a power or ground component
    // Returns true if connection found, false otherwise
    
    const pointKey = `${Math.round(startPoint.x)},${Math.round(startPoint.y)}`;
    if (visited.has(pointKey)) return false;
    visited.add(pointKey);
    
    // Check if we've reached a power or ground component directly
    for (const comp of this.components) {
     if (comp.type === targetType) {
      const pins = this.getComponentPinPositions(comp);
      for (const pin of pins) {
       if (this.isPointNear(startPoint, pin)) {
        return true;
       }
      }
     }
     
     // Check if we've reached a 555 output pin (pin 3) that is HIGH - acts as power source
     if (comp.type === 'ne555' && comp.outputState && targetType === 'power') {
      const outputPin = this.get555PinPosition(comp, 3); // Pin 3 is output
      if (outputPin && this.isPointNear(startPoint, outputPin)) {
       return true;
      }
     }
    }
    
    // Follow all wire connections from this point
    for (const conn of this.connections) {
     let nextPoint = null;
     
     if (this.isPointNear(startPoint, conn.start)) {
      nextPoint = conn.end;
     } else if (this.isPointNear(startPoint, conn.end)) {
      nextPoint = conn.start;
     }
     
     if (nextPoint) {
      // Check if we've reached the target
      if (this.traceConnection(nextPoint, targetType, visited)) {
       return true;
      }
      
      // Check if this point connects to any pass-through component (like resistor, button or switch)
      for (const comp of this.components) {
       if (comp.type === 'resistor') {
        const pins = this.getComponentPinPositions(comp);
        for (let i = 0; i < pins.length; i++) {
         if (this.isPointNear(nextPoint, pins[i])) {
          // Found connection to one pin of resistor, check the other pin
          for (let j = 0; j < pins.length; j++) {
           if (i !== j) {
            if (this.traceConnection(pins[j], targetType, visited)) {
             return true;
            }
           }
          }
         }
        }
       } else if (comp.type === 'button' || comp.type === 'switch') {
        // Button/Switch only allows current through when pressed
        if (comp.isPressed) {
         const pins = this.getComponentPinPositions(comp);
         // Find which pin we're connected to
         for (let i = 0; i < pins.length; i++) {
          if (this.isPointNear(nextPoint, pins[i])) {
           // When pressed, all 4 pins are connected (tactile button behavior)
           // Check all OTHER pins for continuation of circuit
           for (let j = 0; j < pins.length; j++) {
            if (i !== j) {
             if (this.traceConnection(pins[j], targetType, visited)) {
              return true;
             }
            }
           }
          }
         }
        }
       }
      }
     }
    }
    
    return false;
   }

   updateLEDStates() {
    // First update 555 states, then check LEDs
    this.update555States();
    
    // Check all LED components and update their powered state
    for (const comp of this.components) {
     if (comp.type === 'led') {
      const pins = this.getComponentPinPositions(comp);
      const anode = pins.find(p => p.type === 'anode');
      const cathode = pins.find(p => p.type === 'cathode');
      
      if (anode && cathode) {
       const hasPositive = this.traceConnection(anode, 'power');
       const hasGround = this.traceConnection(cathode, 'ground');
       comp.isPowered = hasPositive && hasGround;
       
       // Smoke and mirrors for 555 astable mode:
       // If there's a 555 in astable mode and the LED is connected to it somehow, follow the 555 output
       if (!comp.isPowered) {
        for (const ne555 of this.components) {
         if (ne555.type === 'ne555' && ne555.astableMode && ne555.hasPower) {
          // Check if LED is connected to any 555 pin
          const ne555Pins = this.getComponentPinPositions(ne555);
          for (const pin of ne555Pins) {
           if (this.arePinsConnected(anode, pin) || this.arePinsConnected(cathode, pin)) {
            // LED is connected to the 555 - follow the 555 output state
            comp.isPowered = ne555.outputState;
            break;
           }
          }
         }
        }
       }
      } else {
       comp.isPowered = false;
      }
     }
    }
   }
   
   // Update all 555 timer states based on their pin connections
   update555States() {
    for (const comp of this.components) {
     if (comp.type === 'ne555') {
      // Initialize state if not present
      if (comp.outputState === undefined) {
       comp.outputState = false;
      }
      if (comp.astableMode === undefined) {
       comp.astableMode = false;
      }
      if (comp.monostableMode === undefined) {
       comp.monostableMode = false;
      }
      if (comp.resetActive === undefined) {
       comp.resetActive = false;
      }
      
      // Get pin positions
      const pin1 = this.get555PinPosition(comp, 1); // GND
      const pin2 = this.get555PinPosition(comp, 2); // TRIGGER
      const pin3 = this.get555PinPosition(comp, 3); // OUTPUT
      const pin4 = this.get555PinPosition(comp, 4); // RESET
      const pin5 = this.get555PinPosition(comp, 5); // CONTROL
      const pin6 = this.get555PinPosition(comp, 6); // THRESHOLD
      const pin7 = this.get555PinPosition(comp, 7); // DISCHARGE
      const pin8 = this.get555PinPosition(comp, 8); // Vcc
      
      // Check if 555 has power (Vcc connected to power, GND connected to ground)
      const hasVcc = this.traceConnectionWithout555Output(pin8, 'power');
      const hasGnd = this.traceConnectionWithout555Output(pin1, 'ground');
      
      // Smoke and mirrors: Also check if ANY pin has ground connection (lenient detection)
      let hasAnyGnd = hasGnd;
      if (!hasGnd) {
       const allPins = this.getComponentPinPositions(comp);
       for (const pin of allPins) {
        if (this.traceConnectionWithout555Output(pin, 'ground')) {
         hasAnyGnd = true;
         break;
        }
       }
      }
      
      comp.hasPower = hasVcc && hasAnyGnd;
      
      if (!comp.hasPower) {
       comp.outputState = false;
       comp.astableMode = false;
       comp.monostableMode = false;
       comp.resetActive = false;
       comp.timingValues = null;
       continue;
      }
      
      // Check RESET pin (active LOW) - forces output LOW when grounded
      const resetToVcc = this.arePinsConnected(pin4, pin8);
      const resetLow = !resetToVcc && this.traceConnectionWithout555Output(pin4, 'ground');
      comp.resetActive = resetLow;
      
      if (resetLow) {
       comp.outputState = false;
       comp.astableMode = false;
       comp.monostableMode = false;
       continue;
      }
      
      // Get connected resistors and capacitors for timing calculation
      const timingComponents = this.get555TimingComponents(comp);
      comp.timingValues = this.calculate555Timing(timingComponents);
      
      // Check for ASTABLE MODE: Pins 2 (TRIGGER) and 6 (THRESHOLD) connected together
      const pin2And6Connected = this.arePinsConnected(pin2, pin6);
      
      // Also check if there's a capacitor in the circuit (connected to pin 2/6 area and ground)
      const hasTimingCircuit = this.hasCapacitorToGround(pin2);
      
      // Alternative: Check if there's ANY capacitor connected to the 555 for simpler detection
      const hasAnyTimingCapacitor = this.hasCapacitorConnectedTo555(comp);
      
      // Check for discharge resistor connection (pin 7 to Vcc through resistor)
      const hasDischargeResistor = this.hasResistorConnectedToPin(pin7);
      
      if ((pin2And6Connected && hasTimingCircuit) || (hasAnyTimingCapacitor && hasDischargeResistor)) {
       // ASTABLE MODE - oscillator
       comp.astableMode = true;
       comp.monostableMode = false;
       // Output will be toggled by the simulation loop
      } else if (hasAnyTimingCapacitor && !pin2And6Connected) {
       // MONOSTABLE MODE - one-shot timer
       comp.astableMode = false;
       comp.monostableMode = true;
       
       // Check TRIGGER pin for monostable operation
       const triggerLow = this.traceConnectionWithout555Output(pin2, 'ground');
       if (triggerLow && !comp.monostableTriggered) {
        comp.monostableTriggered = true;
        comp.outputState = true;
        // Set timeout for pulse width (simulated)
        if (comp.timingValues && comp.timingValues.monostablePulse) {
         const pulseMs = Math.min(comp.timingValues.monostablePulse * 1000, 5000); // Cap at 5s for demo
         setTimeout(() => {
          if (comp.monostableMode && comp.monostableTriggered) {
           comp.outputState = false;
           comp.monostableTriggered = false;
           this.updateLEDStates();
           this.draw();
           this.updatePropertiesPanel();
          }
         }, pulseMs > 100 ? pulseMs : 500); // Min 500ms for visibility
        }
       }
      } else {
       comp.astableMode = false;
       comp.monostableMode = false;
       
       // BISTABLE MODE
       // Check TRIGGER pin (active LOW) - if grounded, output goes HIGH
       const triggerLow = this.traceConnectionWithout555Output(pin2, 'ground');
       if (triggerLow) {
        comp.outputState = true;
       }
       
       // Check THRESHOLD pin - if it goes high (connected to power), output goes LOW
       const thresholdHigh = this.traceConnectionWithout555Output(pin6, 'power');
       if (thresholdHigh) {
        comp.outputState = false;
       }
      }
     }
    }
   }
   
   // Get resistors and capacitors connected to 555 for timing calculations
   get555TimingComponents(ne555Comp) {
    const components = {
     resistors: [],
     capacitors: [],
     r1: null, // Resistor between Vcc and Discharge (pin 7)
     r2: null, // Resistor between Discharge (pin 7) and Trigger/Threshold (pin 2/6)
     c: null   // Timing capacitor
    };
    
    const pin2 = this.get555PinPosition(ne555Comp, 2);
    const pin6 = this.get555PinPosition(ne555Comp, 6);
    const pin7 = this.get555PinPosition(ne555Comp, 7);
    const pin8 = this.get555PinPosition(ne555Comp, 8);
    
    for (const comp of this.components) {
     if (comp.type === 'resistor') {
      const resPins = this.getComponentPinPositions(comp);
      const value = this.parseResistorValue(comp.value);
      
      // Check if resistor connects pin 8 (Vcc) to pin 7 (Discharge) - this is R1
      let connectsVccToDischarge = false;
      let connectsDischargeToTrigger = false;
      
      for (const resPin of resPins) {
       if (this.arePinsConnected(resPin, pin8)) {
        for (const otherPin of resPins) {
         if (otherPin !== resPin && this.arePinsConnected(otherPin, pin7)) {
          connectsVccToDischarge = true;
         }
        }
       }
       if (this.arePinsConnected(resPin, pin7)) {
        for (const otherPin of resPins) {
         if (otherPin !== resPin && (this.arePinsConnected(otherPin, pin2) || this.arePinsConnected(otherPin, pin6))) {
          connectsDischargeToTrigger = true;
         }
        }
       }
      }
      
      if (connectsVccToDischarge && !components.r1) {
       components.r1 = value;
      } else if (connectsDischargeToTrigger && !components.r2) {
       components.r2 = value;
      }
      
      components.resistors.push({ component: comp, value: value });
     }
     
     if (comp.type === 'capacitor') {
      const capPins = this.getComponentPinPositions(comp);
      const value = this.parseCapacitorValue(comp.value);
      
      // Check if capacitor is connected to trigger/threshold and ground
      for (const capPin of capPins) {
       if (this.arePinsConnected(capPin, pin2) || this.arePinsConnected(capPin, pin6)) {
        if (!components.c) {
         components.c = value;
        }
       }
      }
      
      components.capacitors.push({ component: comp, value: value });
     }
    }
    
    return components;
   }
   
   // Parse resistor value string to ohms
   parseResistorValue(valueStr) {
    if (!valueStr) return 10000; // Default 10k
    const str = valueStr.toString().toUpperCase();
    let multiplier = 1;
    let numStr = str;
    
    if (str.includes('M')) {
     multiplier = 1000000;
     numStr = str.replace('M', '').replace('Œ©', '').replace('OHM', '').trim();
    } else if (str.includes('K')) {
     multiplier = 1000;
     numStr = str.replace('K', '').replace('Œ©', '').replace('OHM', '').trim();
    } else {
     numStr = str.replace('Œ©', '').replace('OHM', '').trim();
    }
    
    const num = parseFloat(numStr) || 10;
    return num * multiplier;
   }
   
   // Parse capacitor value string to Farads
   parseCapacitorValue(valueStr) {
    if (!valueStr) return 0.000001; // Default 1¬µF
    const str = valueStr.toString().toUpperCase();
    const strOriginal = valueStr.toString(); // Keep original for ¬µ character
    let multiplier = 1;
    let numStr = str;
    
    if (str.includes('MF') || str.includes('MŒúF')) {
     multiplier = 0.001; // milliFarad
     numStr = str.replace('MF', '').replace('MŒúF', '').trim();
    } else if (str.includes('UF') || strOriginal.includes('¬µF') || str.includes('ŒúF')) {
     multiplier = 0.000001; // microFarad
     numStr = str.replace('UF', '').replace('ŒúF', '').trim();
     numStr = strOriginal.replace('¬µF', '').replace('ŒºF', '').trim(); // Also handle lowercase micro
    } else if (str.includes('NF')) {
     multiplier = 0.000000001; // nanoFarad
     numStr = str.replace('NF', '').trim();
    } else if (str.includes('PF')) {
     multiplier = 0.000000000001; // picoFarad
     numStr = str.replace('PF', '').trim();
    } else if (str.includes('F')) {
     multiplier = 1;
     numStr = str.replace('F', '').trim();
    }
    
    const num = parseFloat(numStr) || 1;
    return num * multiplier;
   }
   
   // Calculate 555 timing values based on connected components
   calculate555Timing(timingComponents) {
    const { r1, r2, c } = timingComponents;
    
    if (!c) return null;
    
    const result = {
     capacitance: c,
     capacitanceDisplay: this.formatCapacitance(c)
    };
    
    if (r1 && r2) {
     // Astable mode calculations
     result.r1 = r1;
     result.r2 = r2;
     result.r1Display = this.formatResistance(r1);
     result.r2Display = this.formatResistance(r2);
     
     // t‚ÇÅ (HIGH time) = 0.693 √ó (R1 + R2) √ó C
     result.highTime = 0.693 * (r1 + r2) * c;
     result.highTimeDisplay = this.formatTime(result.highTime);
     
     // t‚ÇÇ (LOW time) = 0.693 √ó R2 √ó C  
     result.lowTime = 0.693 * r2 * c;
     result.lowTimeDisplay = this.formatTime(result.lowTime);
     
     // Period = t‚ÇÅ + t‚ÇÇ
     result.period = result.highTime + result.lowTime;
     result.periodDisplay = this.formatTime(result.period);
     
     // Frequency = 1 / Period = 1.44 / ((R1 + 2√óR2) √ó C)
     result.frequency = 1 / result.period;
     result.frequencyDisplay = this.formatFrequency(result.frequency);
     
     // Duty Cycle = (R1 + R2) / (R1 + 2√óR2) √ó 100%
     result.dutyCycle = ((r1 + r2) / (r1 + 2 * r2)) * 100;
     result.dutyCycleDisplay = result.dutyCycle.toFixed(1) + '%';
    } else if (r1 || r2) {
     // Monostable mode - uses single resistor
     const r = r1 || r2;
     result.r = r;
     result.rDisplay = this.formatResistance(r);
     
     // T = 1.1 √ó R √ó C
     result.monostablePulse = 1.1 * r * c;
     result.monostablePulseDisplay = this.formatTime(result.monostablePulse);
    }
    
    return result;
   }
   
   // Format resistance for display
   formatResistance(ohms) {
    if (ohms >= 1000000) return (ohms / 1000000).toFixed(2) + ' MŒ©';
    if (ohms >= 1000) return (ohms / 1000).toFixed(1) + ' kŒ©';
    return ohms.toFixed(0) + ' Œ©';
   }
   
   // Format capacitance for display
   formatCapacitance(farads) {
    if (farads >= 0.001) return (farads * 1000).toFixed(2) + ' mF';
    if (farads >= 0.000001) return (farads * 1000000).toFixed(2) + ' ¬µF';
    if (farads >= 0.000000001) return (farads * 1000000000).toFixed(2) + ' nF';
    return (farads * 1000000000000).toFixed(2) + ' pF';
   }
   
   // Format time for display
   formatTime(seconds) {
    if (seconds >= 1) return seconds.toFixed(3) + ' s';
    if (seconds >= 0.001) return (seconds * 1000).toFixed(2) + ' ms';
    return (seconds * 1000000).toFixed(2) + ' ¬µs';
   }
   
   // Format frequency for display
   formatFrequency(hz) {
    if (hz >= 1000000) return (hz / 1000000).toFixed(2) + ' MHz';
    if (hz >= 1000) return (hz / 1000).toFixed(2) + ' kHz';
    if (hz >= 1) return hz.toFixed(2) + ' Hz';
    return (hz * 1000).toFixed(2) + ' mHz';
   }
   
   // Check if there's a resistor connected to a specific pin
   hasResistorConnectedToPin(pin) {
    if (!pin) return false;
    
    for (const comp of this.components) {
     if (comp.type === 'resistor') {
      const resPins = this.getComponentPinPositions(comp);
      for (const resPin of resPins) {
       if (this.arePinsConnected(pin, resPin)) {
        return true;
       }
      }
     }
    }
    return false;
   }
   
   // Check if two pins are connected via wires
   arePinsConnected(pin1, pin2, visited = new Set()) {
    if (!pin1 || !pin2) return false;
    
    const key = `${Math.round(pin1.x)},${Math.round(pin1.y)}`;
    if (visited.has(key)) return false;
    visited.add(key);
    
    // Check if pins are directly near each other
    if (this.isPointNear(pin1, pin2, 20)) {
     return true;
    }
    
    // Follow wires from pin1 and see if we reach pin2
    for (const conn of this.connections) {
     let nextPoint = null;
     
     if (this.isPointNear(pin1, conn.start, 15)) {
      nextPoint = conn.end;
     } else if (this.isPointNear(pin1, conn.end, 15)) {
      nextPoint = conn.start;
     }
     
     if (nextPoint) {
      if (this.isPointNear(nextPoint, pin2, 15)) {
       return true;
      }
      // Recursively check
      if (this.arePinsConnected(nextPoint, pin2, visited)) {
       return true;
      }
     }
    }
    
    return false;
   }
   
   // Check if there's a capacitor connected to this pin area that goes to ground
   hasCapacitorToGround(pin) {
    if (!pin) return false;
    
    for (const comp of this.components) {
     if (comp.type === 'capacitor') {
      const capPins = this.getComponentPinPositions(comp);
      // Check if capacitor is connected near this pin
      for (const capPin of capPins) {
       if (this.arePinsConnected(pin, capPin)) {
        // Check if other end of capacitor goes to ground
        for (const otherCapPin of capPins) {
         if (otherCapPin !== capPin) {
          if (this.traceConnectionWithout555Output(otherCapPin, 'ground')) {
           return true;
          }
         }
        }
       }
      }
     }
    }
    return false;
   }
   
   // Simplified check: is there any capacitor connected to any pin of this 555?
   hasCapacitorConnectedTo555(ne555Comp) {
    if (ne555Comp.type !== 'ne555') return false;
    
    for (const comp of this.components) {
     if (comp.type === 'capacitor') {
      const capPins = this.getComponentPinPositions(comp);
      const ne555Pins = this.getComponentPinPositions(ne555Comp);
      
      // Check if any capacitor pin is connected to any 555 pin
      for (const capPin of capPins) {
       for (const ne555Pin of ne555Pins) {
        if (this.arePinsConnected(capPin, ne555Pin)) {
         return true;
        }
       }
      }
     }
    }
    return false;
   }
   
   // Trace connection but don't count 555 output as power source (to avoid circular logic)
   traceConnectionWithout555Output(startPoint, targetType, visited = new Set()) {
    const pointKey = `${Math.round(startPoint.x)},${Math.round(startPoint.y)}`;
    if (visited.has(pointKey)) return false;
    visited.add(pointKey);
    
    // Check if we've reached a power or ground component directly
    for (const comp of this.components) {
     if (comp.type === targetType) {
      const pins = this.getComponentPinPositions(comp);
      for (const pin of pins) {
       if (this.isPointNear(startPoint, pin)) {
        return true;
       }
      }
     }
    }
    
    // Follow all wire connections from this point
    for (const conn of this.connections) {
     let nextPoint = null;
     
     if (this.isPointNear(startPoint, conn.start)) {
      nextPoint = conn.end;
     } else if (this.isPointNear(startPoint, conn.end)) {
      nextPoint = conn.start;
     }
     
     if (nextPoint) {
      if (this.traceConnectionWithout555Output(nextPoint, targetType, visited)) {
       return true;
      }
      
      // Check pass-through components (resistor, button, switch)
      for (const comp of this.components) {
       if (comp.type === 'resistor') {
        const pins = this.getComponentPinPositions(comp);
        for (let i = 0; i < pins.length; i++) {
         if (this.isPointNear(nextPoint, pins[i])) {
          for (let j = 0; j < pins.length; j++) {
           if (i !== j) {
            if (this.traceConnectionWithout555Output(pins[j], targetType, visited)) {
             return true;
            }
           }
          }
         }
        }
       } else if ((comp.type === 'button' || comp.type === 'switch') && comp.isPressed) {
        const pins = this.getComponentPinPositions(comp);
        for (let i = 0; i < pins.length; i++) {
         if (this.isPointNear(nextPoint, pins[i])) {
          for (let j = 0; j < pins.length; j++) {
           if (i !== j) {
            if (this.traceConnectionWithout555Output(pins[j], targetType, visited)) {
             return true;
            }
           }
          }
         }
        }
       }
      }
     }
    }
    
    return false;
   }

   drawSimpleComponentPins(comp) {
    const gridSize = 20;
    const pinRenderSize = 16; // 20px grid - 2px on each side
    const pinMargin = 2; // 2px margin on each side
    const rotation = comp.rotation || 0;
    const isVertical = (rotation === 90 || rotation === 270);
    
    this.ctx.fillStyle = '#c0c0c0';

    if (comp.type === 'crystal' && comp.pins === 4) {
     if (!isVertical) {
      // Horizontal crystal - pins on left and right
      // Top-left pin (left side, top position)
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-left pin (left side, bottom position)
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Top-right pin (right side, top position)
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-right pin (right side, bottom position)
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     } else {
      // Vertical crystal - pins on top and bottom
      // Top-left pin
      this.ctx.fillRect(
       comp.x + pinMargin,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Top-right pin
      this.ctx.fillRect(
       comp.x + gridSize + pinMargin,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-left pin
      this.ctx.fillRect(
       comp.x + pinMargin,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-right pin
      this.ctx.fillRect(
       comp.x + gridSize + pinMargin,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    } else if ((comp.type === 'button' || comp.type === 'switch') && comp.pins === 4) {
     if (!isVertical) {
      // Horizontal button/switch - pins on left and right
      // Top-left pin (left side, top position)
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-left pin (left side, bottom position)
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Top-right pin (right side, top position)
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-right pin (right side, bottom position)
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     } else {
      // Vertical button/switch - pins on top and bottom
      // Top-left pin
      this.ctx.fillRect(
       comp.x + pinMargin,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Top-right pin
      this.ctx.fillRect(
       comp.x + gridSize + pinMargin,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-left pin
      this.ctx.fillRect(
       comp.x + pinMargin,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom-right pin
      this.ctx.fillRect(
       comp.x + gridSize + pinMargin,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    } else if (comp.type === 'potentiometer') {
     // Potentiometer has 3 pins
     if (!isVertical) {
      // Horizontal - pins on left, center-bottom, right
      // Left pin
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + comp.height / 2 - pinRenderSize / 2,
       pinRenderSize,
       pinRenderSize
      );
      // Center-bottom pin (wiper)
      this.ctx.fillRect(
       comp.x + comp.width / 2 - pinRenderSize / 2,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Right pin
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + comp.height / 2 - pinRenderSize / 2,
       pinRenderSize,
       pinRenderSize
      );
     } else {
      // Vertical - pins on top, center-right, bottom
      // Top pin
      this.ctx.fillRect(
       comp.x + comp.width / 2 - pinRenderSize / 2,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      // Center-right pin (wiper)
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + comp.height / 2 - pinRenderSize / 2,
       pinRenderSize,
       pinRenderSize
      );
      // Bottom pin
      this.ctx.fillRect(
       comp.x + comp.width / 2 - pinRenderSize / 2,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    } else if (comp.type === 'photoresistor') {
     // Photoresistor has 2 pins like a resistor
     if (!isVertical) {
      // Horizontal - pins on left and right
      this.ctx.fillRect(
       comp.x - gridSize + pinMargin,
       comp.y + comp.height / 2 - pinRenderSize / 2,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + comp.width + pinMargin,
       comp.y + comp.height / 2 - pinRenderSize / 2,
       pinRenderSize,
       pinRenderSize
      );
     } else {
      // Vertical - pins on top and bottom
      this.ctx.fillRect(
       comp.x + comp.width / 2 - pinRenderSize / 2,
       comp.y - gridSize + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
      this.ctx.fillRect(
       comp.x + comp.width / 2 - pinRenderSize / 2,
       comp.y + comp.height + pinMargin,
       pinRenderSize,
       pinRenderSize
      );
     }
    }
   }

   updatePropertiesPanel() {
    const panel = document.getElementById('properties-content');
    const selector = document.getElementById('7400-series-selector');
    const chipSelect = document.getElementById('7400-chip-select');
    
    // Show/hide 7400 series selector based on selected component
    if (this.selectedComponent && this.selectedComponent.type === '7400-series') {
     selector.style.display = 'block';
     chipSelect.value = this.selectedComponent.chipType || '7400';
    } else {
     selector.style.display = 'none';
    }

    // Handle 7400-series (Logic Gate) special display
    if (this.selectedComponent && this.selectedComponent.type === '7400-series') {
     const comp = this.selectedComponent;
     const chipType = comp.chipType || '7400';
     
     // Select appropriate pin data based on chip type
     let pinData, chipName, chipColor, gateLayout, truthTableHtml, tipText;
     
     if (chipType === '7404') {
      pinData = this.sn7404PinData;
      chipName = 'SN7404 Hex Inverter';
      chipColor = 'linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%)';
      gateLayout = `
       <div style="margin-bottom: 8px;"><strong style="color: #6c5ce7;">üîπ Gate 1:</strong> 1A (pin 1) ‚Üí 1Y (pin 2)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #6c5ce7;">üîπ Gate 2:</strong> 2A (pin 3) ‚Üí 2Y (pin 4)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #6c5ce7;">üîπ Gate 3:</strong> 3A (pin 5) ‚Üí 3Y (pin 6)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #6c5ce7;">üîπ Gate 4:</strong> 4A (pin 9) ‚Üí 4Y (pin 8)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #6c5ce7;">üîπ Gate 5:</strong> 5A (pin 11) ‚Üí 5Y (pin 10)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #6c5ce7;">üîπ Gate 6:</strong> 6A (pin 13) ‚Üí 6Y (pin 12)</div>
       <div><strong style="color: #856404;">‚ö° Power:</strong> VCC (pin 14), GND (pin 7)</div>
      `;
      truthTableHtml = `
       <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; text-align: center;">
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">A</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">Y</div>
        <div>0</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>1</div><div style="color: #dc3545; font-weight: bold;">0</div>
       </div>
      `;
      tipText = 'Inverters are essential for creating active-LOW control signals and complementing logic!';
     } else if (chipType === '7408') {
      pinData = this.sn7408PinData;
      chipName = 'SN7408 Quad AND Gate';
      chipColor = 'linear-gradient(135deg, #0984e3 0%, #74b9ff 100%)';
      gateLayout = `
       <div style="margin-bottom: 8px;"><strong style="color: #0984e3;">üîπ Gate 1:</strong> 1A (pin 1), 1B (pin 2) ‚Üí 1Y (pin 3)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #0984e3;">üîπ Gate 2:</strong> 2A (pin 4), 2B (pin 5) ‚Üí 2Y (pin 6)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #0984e3;">üîπ Gate 3:</strong> 3A (pin 9), 3B (pin 10) ‚Üí 3Y (pin 8)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #0984e3;">üîπ Gate 4:</strong> 4A (pin 12), 4B (pin 13) ‚Üí 4Y (pin 11)</div>
       <div><strong style="color: #856404;">‚ö° Power:</strong> VCC (pin 14), GND (pin 7)</div>
      `;
      truthTableHtml = `
       <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; text-align: center;">
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">A</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">B</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">Y</div>
        <div>0</div><div>0</div><div style="color: #dc3545; font-weight: bold;">0</div>
        <div>0</div><div>1</div><div style="color: #dc3545; font-weight: bold;">0</div>
        <div>1</div><div>0</div><div style="color: #dc3545; font-weight: bold;">0</div>
        <div>1</div><div>1</div><div style="color: #28a745; font-weight: bold;">1</div>
       </div>
      `;
      tipText = 'AND gates are perfect for enabling signals and creating conditions that require multiple inputs!';
     } else if (chipType === '7432') {
      pinData = this.sn7432PinData;
      chipName = 'SN7432 Quad OR Gate';
      chipColor = 'linear-gradient(135deg, #00b894 0%, #55efc4 100%)';
      gateLayout = `
       <div style="margin-bottom: 8px;"><strong style="color: #00b894;">üîπ Gate 1:</strong> 1A (pin 1), 1B (pin 2) ‚Üí 1Y (pin 3)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #00b894;">üîπ Gate 2:</strong> 2A (pin 4), 2B (pin 5) ‚Üí 2Y (pin 6)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #00b894;">üîπ Gate 3:</strong> 3A (pin 9), 3B (pin 10) ‚Üí 3Y (pin 8)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #00b894;">üîπ Gate 4:</strong> 4A (pin 12), 4B (pin 13) ‚Üí 4Y (pin 11)</div>
       <div><strong style="color: #856404;">‚ö° Power:</strong> VCC (pin 14), GND (pin 7)</div>
      `;
      truthTableHtml = `
       <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; text-align: center;">
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">A</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">B</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">Y</div>
        <div>0</div><div>0</div><div style="color: #dc3545; font-weight: bold;">0</div>
        <div>0</div><div>1</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>1</div><div>0</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>1</div><div>1</div><div style="color: #28a745; font-weight: bold;">1</div>
       </div>
      `;
      tipText = 'OR gates are ideal for combining multiple signal sources and creating wired-OR configurations!';
     } else if (chipType === '7402') {
      pinData = this.sn7402PinData;
      chipName = 'SN7402 Quad NOR Gate';
      chipColor = 'linear-gradient(135deg, #e17055 0%, #fab1a0 100%)';
      gateLayout = `
       <div style="margin-bottom: 8px;"><strong style="color: #e17055;">üîπ Gate 1:</strong> 1A (pin 2), 1B (pin 3) ‚Üí 1Y (pin 1)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #e17055;">üîπ Gate 2:</strong> 2A (pin 5), 2B (pin 6) ‚Üí 2Y (pin 4)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #e17055;">üîπ Gate 3:</strong> 3A (pin 8), 3B (pin 9) ‚Üí 3Y (pin 10)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #e17055;">üîπ Gate 4:</strong> 4A (pin 11), 4B (pin 12) ‚Üí 4Y (pin 13)</div>
       <div><strong style="color: #856404;">‚ö° Power:</strong> VCC (pin 14), GND (pin 7)</div>
      `;
      truthTableHtml = `
       <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; text-align: center;">
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">A</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">B</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">Y</div>
        <div>0</div><div>0</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>0</div><div>1</div><div style="color: #dc3545; font-weight: bold;">0</div>
        <div>1</div><div>0</div><div style="color: #dc3545; font-weight: bold;">0</div>
        <div>1</div><div>1</div><div style="color: #dc3545; font-weight: bold;">0</div>
       </div>
      `;
      tipText = 'NOR is a universal gate - any logic function can be built using only NOR gates!';
     } else {
      // Default to 7400 NAND gate
      pinData = this.sn7400PinData;
      chipName = 'SN7400 Quad NAND Gate';
      chipColor = 'linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%)';
      gateLayout = `
       <div style="margin-bottom: 8px;"><strong style="color: #0c5460;">üîπ Gate 1:</strong> 1A (pin 1), 1B (pin 2) ‚Üí 1Y (pin 3)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #0c5460;">üîπ Gate 2:</strong> 2A (pin 4), 2B (pin 5) ‚Üí 2Y (pin 6)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #0c5460;">üîπ Gate 3:</strong> 3A (pin 9), 3B (pin 10) ‚Üí 3Y (pin 8)</div>
       <div style="margin-bottom: 8px;"><strong style="color: #0c5460;">üîπ Gate 4:</strong> 4A (pin 12), 4B (pin 13) ‚Üí 4Y (pin 11)</div>
       <div><strong style="color: #856404;">‚ö° Power:</strong> VCC (pin 14), GND (pin 7)</div>
      `;
      truthTableHtml = `
       <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 4px; text-align: center;">
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">A</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">B</div>
        <div style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 4px;">Y</div>
        <div>0</div><div>0</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>0</div><div>1</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>1</div><div>0</div><div style="color: #28a745; font-weight: bold;">1</div>
        <div>1</div><div>1</div><div style="color: #dc3545; font-weight: bold;">0</div>
       </div>
      `;
      tipText = 'NAND is a universal gate - any logic function can be built using only NAND gates!';
     }
     
     if (this.selectedPin !== null && pinData.pins[this.selectedPin]) {
      // Show specific pin information
      const pin = pinData.pins[this.selectedPin];
      const pinTypeColors = {
       power: { bg: '#fff3cd', border: '#ffc107', text: '#856404' },
       input: { bg: '#d1ecf1', border: '#17a2b8', text: '#0c5460' },
       output: { bg: '#d4edda', border: '#28a745', text: '#155724' }
      };
      const colors = pinTypeColors[pin.type] || pinTypeColors.input;
      
      panel.innerHTML = `
       <div style="background: ${chipColor}; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 12px; opacity: 0.9;">${chipName}</div>
        <div style="font-size: 20px; font-weight: bold;">Pin ${this.selectedPin}: ${pin.name}</div>
        <div style="font-size: 14px; opacity: 0.9;">${pin.fullName}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Type</label>
        <div style="padding: 8px 12px; background: ${colors.bg}; border: 2px solid ${colors.border}; border-radius: 5px; color: ${colors.text}; font-weight: 600; text-transform: uppercase; font-size: 12px;">
         ${pin.type}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Description</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px; font-size: 13px; line-height: 1.6; color: #333;">
         ${pin.description}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">${chipType === '7404' ? 'NOT' : 'NAND'} Truth Table</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px; font-family: monospace; font-size: 12px;">
         ${truthTableHtml}
        </div>
       </div>
       <div style="background: #e8e8e8; border-left: 4px solid #7f8c8d; padding: 12px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #333; font-weight: 600; margin-bottom: 8px;">üí° Quick Reference</div>
        <div style="font-size: 11px; color: #555; line-height: 1.5;">
         Click the <strong>IC body</strong> for essential ${chipType} info<br>
         Click other <strong>pins</strong> to view their details<br>
         Drag the <strong>outer edge</strong> to move the component
        </div>
       </div>
      `;
     } else {
      // Show essential information (body selected)
      const info = pinData.essential;
      
      // Generate key pins based on chip type
      let keyPinsHtml;
      if (chipType === '7404') {
       keyPinsHtml = `
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 14; simulator.updatePropertiesPanel();"><strong>14</strong> - VCC</div>
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 7; simulator.updatePropertiesPanel();"><strong>7</strong> - GND</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 1; simulator.updatePropertiesPanel();"><strong>1</strong> - 1A</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 2; simulator.updatePropertiesPanel();"><strong>2</strong> - 1Y</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 3; simulator.updatePropertiesPanel();"><strong>3</strong> - 2A</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 4; simulator.updatePropertiesPanel();"><strong>4</strong> - 2Y</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 5; simulator.updatePropertiesPanel();"><strong>5</strong> - 3A</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 6; simulator.updatePropertiesPanel();"><strong>6</strong> - 3Y</div>
       `;
      } else if (chipType === '7408') {
       keyPinsHtml = `
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 14; simulator.updatePropertiesPanel();"><strong>14</strong> - VCC</div>
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 7; simulator.updatePropertiesPanel();"><strong>7</strong> - GND</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 1; simulator.updatePropertiesPanel();"><strong>1</strong> - 1A</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 2; simulator.updatePropertiesPanel();"><strong>2</strong> - 1B</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 3; simulator.updatePropertiesPanel();"><strong>3</strong> - 1Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 6; simulator.updatePropertiesPanel();"><strong>6</strong> - 2Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 8; simulator.updatePropertiesPanel();"><strong>8</strong> - 3Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 11; simulator.updatePropertiesPanel();"><strong>11</strong> - 4Y</div>
       `;
      } else if (chipType === '7432') {
       keyPinsHtml = `
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 14; simulator.updatePropertiesPanel();"><strong>14</strong> - VCC</div>
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 7; simulator.updatePropertiesPanel();"><strong>7</strong> - GND</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 1; simulator.updatePropertiesPanel();"><strong>1</strong> - 1A</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 2; simulator.updatePropertiesPanel();"><strong>2</strong> - 1B</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 3; simulator.updatePropertiesPanel();"><strong>3</strong> - 1Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 6; simulator.updatePropertiesPanel();"><strong>6</strong> - 2Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 8; simulator.updatePropertiesPanel();"><strong>8</strong> - 3Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 11; simulator.updatePropertiesPanel();"><strong>11</strong> - 4Y</div>
       `;
      } else if (chipType === '7402') {
       keyPinsHtml = `
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 14; simulator.updatePropertiesPanel();"><strong>14</strong> - VCC</div>
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 7; simulator.updatePropertiesPanel();"><strong>7</strong> - GND</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 1; simulator.updatePropertiesPanel();"><strong>1</strong> - 1Y</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 2; simulator.updatePropertiesPanel();"><strong>2</strong> - 1A</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 4; simulator.updatePropertiesPanel();"><strong>4</strong> - 2Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 10; simulator.updatePropertiesPanel();"><strong>10</strong> - 3Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 13; simulator.updatePropertiesPanel();"><strong>13</strong> - 4Y</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 3; simulator.updatePropertiesPanel();"><strong>3</strong> - 1B</div>
       `;
      } else {
       keyPinsHtml = `
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 14; simulator.updatePropertiesPanel();"><strong>14</strong> - VCC</div>
        <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 7; simulator.updatePropertiesPanel();"><strong>7</strong> - GND</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 1; simulator.updatePropertiesPanel();"><strong>1</strong> - 1A</div>
        <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 2; simulator.updatePropertiesPanel();"><strong>2</strong> - 1B</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 3; simulator.updatePropertiesPanel();"><strong>3</strong> - 1Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 6; simulator.updatePropertiesPanel();"><strong>6</strong> - 2Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 8; simulator.updatePropertiesPanel();"><strong>8</strong> - 3Y</div>
        <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 11; simulator.updatePropertiesPanel();"><strong>11</strong> - 4Y</div>
       `;
      }
      
      panel.innerHTML = `
       <div style="background: ${chipColor}; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 20px; font-weight: bold;">‚ö° ${info.name}</div>
        <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">${info.description}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Applications</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px;">
         <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.6;">
          ${info.applications.map(app => `<li>${app}</li>`).join('')}
         </ul>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Specifications</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px;">
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Supply Voltage</span>
          <span style="font-weight: 600; font-size: 12px;">${info.voltageRange}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Propagation Delay</span>
          <span style="font-weight: 600; font-size: 12px;">${info.propagationDelay}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Fan Out</span>
          <span style="font-weight: 600; font-size: 12px;">${info.fanOut}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Gate Count</span>
          <span style="font-weight: 600; font-size: 12px;">${info.gateCount}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0;">
          <span style="color: #666; font-size: 12px;">Logic Function</span>
          <span style="font-weight: 600; font-size: 12px;">${info.truthTable}</span>
         </div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Gate Layout</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px; font-size: 11px; line-height: 1.6;">
         ${gateLayout}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Key Pins (Click for details)</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 10px;">
         ${keyPinsHtml}
        </div>
       </div>
       <div style="background: #e8e8e8; border-left: 4px solid #7f8c8d; padding: 10px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #333; line-height: 1.5;">
         <strong>üí° Tip:</strong> ${tipText}
        </div>
       </div>
      `;
     }
     return;
    }

    // Handle AT28C256 (EEPROM) special display
    if (this.selectedComponent && this.selectedComponent.type === '28c256') {
     const comp = this.selectedComponent;
     
     if (this.selectedPin !== null && this.at28c256PinData.pins[this.selectedPin]) {
      // Show specific pin information
      const pin = this.at28c256PinData.pins[this.selectedPin];
      const pinTypeColors = {
       power: { bg: '#fff3cd', border: '#ffc107', text: '#856404' },
       control: { bg: '#e2d5f1', border: '#6f42c1', text: '#4a2c7d' },
       address: { bg: '#cce5ff', border: '#004085', text: '#004085' },
       data: { bg: '#d4edda', border: '#155724', text: '#155724' }
      };
      const colors = pinTypeColors[pin.type] || pinTypeColors.control;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #4a4a4a 0%, #6b6b6b 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 12px; opacity: 0.9;">AT28C256 EEPROM</div>
        <div style="font-size: 20px; font-weight: bold;">Pin ${this.selectedPin}: ${pin.name}</div>
        <div style="font-size: 14px; opacity: 0.9;">${pin.fullName}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Type</label>
        <div style="padding: 8px 12px; background: ${colors.bg}; border: 2px solid ${colors.border}; border-radius: 5px; color: ${colors.text}; font-weight: 600; text-transform: uppercase; font-size: 12px;">
         ${pin.type}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Description</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px; font-size: 13px; line-height: 1.6; color: #333;">
         ${pin.description}
        </div>
       </div>
       <div style="background: #e8e8e8; border-left: 4px solid #666; padding: 12px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #333; font-weight: 600; margin-bottom: 8px;">üí° Quick Reference</div>
        <div style="font-size: 11px; color: #555; line-height: 1.5;">
         Click the <strong>IC body</strong> for essential EEPROM info<br>
         Click other <strong>pins</strong> to view their details<br>
         Drag the <strong>outer edge</strong> to move the component
        </div>
       </div>
      `;
     } else {
      // Show essential AT28C256 information (body selected)
      const info = this.at28c256PinData.essential;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #4a4a4a 0%, #6b6b6b 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 20px; font-weight: bold;">üíæ ${info.name}</div>
        <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">${info.description}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Applications</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px;">
         <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.6;">
          ${info.applications.map(app => `<li>${app}</li>`).join('')}
         </ul>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Specifications</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px;">
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Supply Voltage</span>
          <span style="font-weight: 600; font-size: 12px;">${info.voltageRange}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Capacity</span>
          <span style="font-weight: 600; font-size: 12px;">${info.capacity}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Organization</span>
          <span style="font-weight: 600; font-size: 12px;">${info.organization}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Access Time</span>
          <span style="font-weight: 600; font-size: 12px;">${info.accessTime}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Write Time</span>
          <span style="font-weight: 600; font-size: 12px;">${info.writeTime}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0;">
          <span style="color: #666; font-size: 12px;">Endurance</span>
          <span style="font-weight: 600; font-size: 12px;">${info.endurance}</span>
         </div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Groups</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px; font-size: 11px; line-height: 1.6;">
         <div style="margin-bottom: 8px;"><strong style="color: #004085;">üìç Address (A0-A14):</strong> Pins 1-2, 3-10, 21, 23-26</div>
         <div style="margin-bottom: 8px;"><strong style="color: #155724;">üìä Data (I/O0-I/O7):</strong> Pins 11-13, 15-19</div>
         <div style="margin-bottom: 8px;"><strong style="color: #856404;">‚ö° Power:</strong> Pin 14 (GND), Pin 28 (VCC)</div>
         <div><strong style="color: #4a2c7d;">üîß Control:</strong> CE (20), OE (22), WE (27)</div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Key Pins (Click for details)</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 10px;">
         <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 14; simulator.updatePropertiesPanel();"><strong>14</strong> - GND</div>
         <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 28; simulator.updatePropertiesPanel();"><strong>28</strong> - VCC</div>
         <div style="background: #e2d5f1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 20; simulator.updatePropertiesPanel();"><strong>20</strong> - CE</div>
         <div style="background: #e2d5f1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 22; simulator.updatePropertiesPanel();"><strong>22</strong> - OE</div>
         <div style="background: #e2d5f1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 27; simulator.updatePropertiesPanel();"><strong>27</strong> - WE</div>
         <div style="background: #cce5ff; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 10; simulator.updatePropertiesPanel();"><strong>10</strong> - A0</div>
         <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 11; simulator.updatePropertiesPanel();"><strong>11</strong> - I/O0</div>
         <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 19; simulator.updatePropertiesPanel();"><strong>19</strong> - I/O7</div>
        </div>
       </div>
       <div style="background: #e8e8e8; border-left: 4px solid #666; padding: 10px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #333; line-height: 1.5;">
         <strong>üí° Tip:</strong> Click on any pin to see detailed info. Essential for Ben Eater's 6502 program storage!
        </div>
       </div>
      `;
     }
     return;
    }

    // Handle W65C22 (6522 VIA) special display
    if (this.selectedComponent && this.selectedComponent.type === 'w65c22') {
     const comp = this.selectedComponent;
     
     if (this.selectedPin !== null && this.w65c22PinData.pins[this.selectedPin]) {
      // Show specific pin information
      const pin = this.w65c22PinData.pins[this.selectedPin];
      const pinTypeColors = {
       power: { bg: '#fff3cd', border: '#ffc107', text: '#856404' },
       input: { bg: '#d1ecf1', border: '#17a2b8', text: '#0c5460' },
       output: { bg: '#d4edda', border: '#28a745', text: '#155724' },
       control: { bg: '#e2d5f1', border: '#6f42c1', text: '#4a2c7d' },
       io: { bg: '#cce5ff', border: '#004085', text: '#004085' },
       data: { bg: '#d4edda', border: '#155724', text: '#155724' }
      };
      const colors = pinTypeColors[pin.type] || pinTypeColors.input;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #2d5016 0%, #4a7c23 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 12px; opacity: 0.9;">W65C22 VIA</div>
        <div style="font-size: 20px; font-weight: bold;">Pin ${this.selectedPin}: ${pin.name}</div>
        <div style="font-size: 14px; opacity: 0.9;">${pin.fullName}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Type</label>
        <div style="padding: 8px 12px; background: ${colors.bg}; border: 2px solid ${colors.border}; border-radius: 5px; color: ${colors.text}; font-weight: 600; text-transform: uppercase; font-size: 12px;">
         ${pin.type === 'io' ? 'I/O (Bidirectional)' : pin.type}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Description</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px; font-size: 13px; line-height: 1.6; color: #333;">
         ${pin.description}
        </div>
       </div>
       <div style="background: #e8f4ed; border-left: 4px solid #28a745; padding: 12px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #155724; font-weight: 600; margin-bottom: 8px;">üí° Quick Reference</div>
        <div style="font-size: 11px; color: #555; line-height: 1.5;">
         Click the <strong>IC body</strong> for essential VIA info<br>
         Click other <strong>pins</strong> to view their details<br>
         Drag the <strong>outer edge</strong> to move the component
        </div>
       </div>
      `;
     } else {
      // Show essential 6522 VIA information (body selected)
      const info = this.w65c22PinData.essential;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #2d5016 0%, #4a7c23 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 20px; font-weight: bold;">üîå ${info.name}</div>
        <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">${info.description}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Applications</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px;">
         <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.6;">
          ${info.applications.map(app => `<li>${app}</li>`).join('')}
         </ul>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Specifications</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px;">
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Supply Voltage</span>
          <span style="font-weight: 600; font-size: 12px;">${info.voltageRange}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Max Frequency</span>
          <span style="font-weight: 600; font-size: 12px;">${info.maxFrequency}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">I/O Ports</span>
          <span style="font-weight: 600; font-size: 12px;">${info.ioPorts}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Timers</span>
          <span style="font-weight: 600; font-size: 12px;">${info.timers}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0;">
          <span style="color: #666; font-size: 12px;">Features</span>
          <span style="font-weight: 600; font-size: 11px;">${info.features}</span>
         </div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Groups</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px; font-size: 11px; line-height: 1.6;">
         <div style="margin-bottom: 8px;"><strong style="color: #004085;">üìç Port A (PA0-PA7):</strong> Pins 2-9</div>
         <div style="margin-bottom: 8px;"><strong style="color: #004085;">üìç Port B (PB0-PB7):</strong> Pins 10-17</div>
         <div style="margin-bottom: 8px;"><strong style="color: #155724;">üìä Data Bus (D0-D7):</strong> Pins 26-33</div>
         <div style="margin-bottom: 8px;"><strong style="color: #856404;">‚ö° Power:</strong> Pin 1 (VSS), Pin 20 (VDD)</div>
         <div style="margin-bottom: 8px;"><strong style="color: #4a2c7d;">üîß Control:</strong> CA1/CA2 (39-40), CB1/CB2 (18-19)</div>
         <div><strong style="color: #0c5460;">üìç Register Select:</strong> RS0-RS3 (35-38)</div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Key Pins (Click for details)</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 10px;">
         <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 1; simulator.updatePropertiesPanel();"><strong>1</strong> - VSS</div>
         <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 20; simulator.updatePropertiesPanel();"><strong>20</strong> - VDD</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 34; simulator.updatePropertiesPanel();"><strong>34</strong> - RESB</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 25; simulator.updatePropertiesPanel();"><strong>25</strong> - PHI2</div>
         <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 21; simulator.updatePropertiesPanel();"><strong>21</strong> - IRQB</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 22; simulator.updatePropertiesPanel();"><strong>22</strong> - RWB</div>
         <div style="background: #e2d5f1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 40; simulator.updatePropertiesPanel();"><strong>40</strong> - CA1</div>
         <div style="background: #e2d5f1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 18; simulator.updatePropertiesPanel();"><strong>18</strong> - CB1</div>
        </div>
       </div>
       <div style="background: #d4edda; border-left: 4px solid #28a745; padding: 10px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #155724; line-height: 1.5;">
         <strong>üí° Tip:</strong> Click on any pin to see detailed info. Essential for Ben Eater's 6502 project I/O!
        </div>
       </div>
      `;
     }
     return;
    }

    // Handle W65C02S (6502) Microprocessor special display
    if (this.selectedComponent && this.selectedComponent.type === 'w65c02s') {
     const comp = this.selectedComponent;
     
     if (this.selectedPin !== null && this.w65c02sPinData.pins[this.selectedPin]) {
      // Show specific pin information
      const pin = this.w65c02sPinData.pins[this.selectedPin];
      const pinTypeColors = {
       power: { bg: '#fff3cd', border: '#ffc107', text: '#856404' },
       input: { bg: '#d1ecf1', border: '#17a2b8', text: '#0c5460' },
       output: { bg: '#d4edda', border: '#28a745', text: '#155724' },
       control: { bg: '#e2d5f1', border: '#6f42c1', text: '#4a2c7d' },
       address: { bg: '#cce5ff', border: '#004085', text: '#004085' },
       data: { bg: '#d4edda', border: '#155724', text: '#155724' },
       nc: { bg: '#e2e3e5', border: '#6c757d', text: '#383d41' }
      };
      const colors = pinTypeColors[pin.type] || pinTypeColors.input;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 12px; opacity: 0.9;">W65C02S Microprocessor</div>
        <div style="font-size: 20px; font-weight: bold;">Pin ${this.selectedPin}: ${pin.name}</div>
        <div style="font-size: 14px; opacity: 0.9;">${pin.fullName}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Type</label>
        <div style="padding: 8px 12px; background: ${colors.bg}; border: 2px solid ${colors.border}; border-radius: 5px; color: ${colors.text}; font-weight: 600; text-transform: uppercase; font-size: 12px;">
         ${pin.type}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Description</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px; font-size: 13px; line-height: 1.6; color: #333;">
         ${pin.description}
        </div>
       </div>
       <div style="background: #e8f4fd; border-left: 4px solid #2196F3; padding: 12px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #1565c0; font-weight: 600; margin-bottom: 8px;">üí° Quick Reference</div>
        <div style="font-size: 11px; color: #555; line-height: 1.5;">
         Click the <strong>IC body</strong> for essential 6502 info<br>
         Click other <strong>pins</strong> to view their details<br>
         Drag the <strong>outer edge</strong> to move the component
        </div>
       </div>
      `;
     } else {
      // Show essential 6502 information (body selected)
      const info = this.w65c02sPinData.essential;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 20px; font-weight: bold;">üñ•Ô∏è ${info.name}</div>
        <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">${info.description}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Applications</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px;">
         <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.6;">
          ${info.applications.map(app => `<li>${app}</li>`).join('')}
         </ul>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Specifications</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px;">
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Supply Voltage</span>
          <span style="font-weight: 600; font-size: 12px;">${info.voltageRange}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Max Frequency</span>
          <span style="font-weight: 600; font-size: 12px;">${info.maxFrequency}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Architecture</span>
          <span style="font-weight: 600; font-size: 12px;">${info.architecture}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0;">
          <span style="color: #666; font-size: 12px;">Registers</span>
          <span style="font-weight: 600; font-size: 11px;">${info.registers}</span>
         </div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Groups</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px; font-size: 11px; line-height: 1.6;">
         <div style="margin-bottom: 8px;"><strong style="color: #004085;">üìç Address Bus (A0-A15):</strong> Pins 9-20, 22-25</div>
         <div style="margin-bottom: 8px;"><strong style="color: #155724;">üìä Data Bus (D0-D7):</strong> Pins 26-33</div>
         <div style="margin-bottom: 8px;"><strong style="color: #856404;">‚ö° Power:</strong> Pin 8 (VDD), Pin 21 (VSS)</div>
         <div style="margin-bottom: 8px;"><strong style="color: #0c5460;">üîß Control:</strong> RESB (40), PHI2 (37), RWB (34)</div>
         <div><strong style="color: #4a2c7d;">üîî Interrupts:</strong> IRQB (4), NMIB (6)</div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Key Pins (Click for details)</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 10px;">
         <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 8; simulator.updatePropertiesPanel();"><strong>8</strong> - VDD</div>
         <div style="background: #fff3cd; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 21; simulator.updatePropertiesPanel();"><strong>21</strong> - VSS</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 40; simulator.updatePropertiesPanel();"><strong>40</strong> - RESB</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 37; simulator.updatePropertiesPanel();"><strong>37</strong> - PHI2</div>
         <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 34; simulator.updatePropertiesPanel();"><strong>34</strong> - RWB</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 4; simulator.updatePropertiesPanel();"><strong>4</strong> - IRQB</div>
         <div style="background: #d1ecf1; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 6; simulator.updatePropertiesPanel();"><strong>6</strong> - NMIB</div>
         <div style="background: #d4edda; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = 7; simulator.updatePropertiesPanel();"><strong>7</strong> - SYNC</div>
        </div>
       </div>
       <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #856404; line-height: 1.5;">
         <strong>üí° Tip:</strong> Click on any pin to see detailed info. Essential for Ben Eater's 6502 project!
        </div>
       </div>
      `;
     }
     return;
    }

    // Handle 555 Timer IC special display
    if (this.selectedComponent && this.selectedComponent.type === 'ne555') {
     const comp = this.selectedComponent;
     
     if (this.selectedPin !== null && this.ne555PinData.pins[this.selectedPin]) {
      // Show specific pin information
      const pin = this.ne555PinData.pins[this.selectedPin];
      const pinTypeColors = {
       power: { bg: '#fff3cd', border: '#ffc107', text: '#856404' },
       input: { bg: '#d1ecf1', border: '#17a2b8', text: '#0c5460' },
       output: { bg: '#d4edda', border: '#28a745', text: '#155724' },
       control: { bg: '#e2d5f1', border: '#6f42c1', text: '#4a2c7d' }
      };
      const colors = pinTypeColors[pin.type] || pinTypeColors.input;
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 12px; opacity: 0.9;">NE555 Timer IC</div>
        <div style="font-size: 20px; font-weight: bold;">Pin ${this.selectedPin}: ${pin.name}</div>
        <div style="font-size: 14px; opacity: 0.9;">${pin.fullName}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Type</label>
        <div style="padding: 8px 12px; background: ${colors.bg}; border: 2px solid ${colors.border}; border-radius: 5px; color: ${colors.text}; font-weight: 600; text-transform: uppercase; font-size: 12px;">
         ${pin.type}
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Description</label>
        <div style="padding: 12px; background: #f8f9fa; border-radius: 5px; font-size: 13px; line-height: 1.6; color: #333;">
         ${pin.description}
        </div>
       </div>
       <div style="background: #e8f4fd; border-left: 4px solid #2196F3; padding: 12px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #1565c0; font-weight: 600; margin-bottom: 8px;">üí° Quick Reference</div>
        <div style="font-size: 11px; color: #555; line-height: 1.5;">
         Click the <strong>IC body</strong> for essential 555 info<br>
         Click other <strong>pins</strong> to view their details<br>
         Drag the <strong>outer edge</strong> to move the component
        </div>
       </div>
      `;
     } else {
      // Show essential 555 information (body selected)
      const info = this.ne555PinData.essential;
      const statusColor = comp.hasPower ? (comp.outputState ? '#28a745' : '#dc3545') : '#6c757d';
      const statusBg = comp.hasPower ? (comp.outputState ? '#d4edda' : '#f8d7da') : '#e2e3e5';
      const statusText = comp.hasPower ? (comp.outputState ? 'OUTPUT HIGH' : 'OUTPUT LOW') : 'NO POWER';
      const statusIcon = comp.hasPower ? (comp.outputState ? 'üü¢' : 'üî¥') : '‚ö´';
      
      // Mode indicator - now includes monostable
      let modeText, modeBg, modeColor, modeIcon;
      if (comp.resetActive) {
       modeText = '‚õî RESET ACTIVE';
       modeBg = '#f8d7da';
       modeColor = '#721c24';
       modeIcon = 'üî¥';
      } else if (comp.astableMode) {
       modeText = 'üîÑ ASTABLE (Oscillating)';
       modeBg = '#fff3cd';
       modeColor = '#856404';
       modeIcon = '‚ö°';
      } else if (comp.monostableMode) {
       modeText = '‚è±Ô∏è MONOSTABLE (One-Shot)';
       modeBg = '#d1ecf1';
       modeColor = '#0c5460';
       modeIcon = 'üéØ';
      } else {
       modeText = 'üîò BISTABLE (Latched)';
       modeBg = '#e2e3e5';
       modeColor = '#383d41';
       modeIcon = 'üîí';
      }
      
      // Generate timing calculations display
      let timingHtml = '';
      if (comp.timingValues) {
       const tv = comp.timingValues;
       if (comp.astableMode && tv.frequency) {
        timingHtml = `
         <div class="property-group">
          <label class="property-label">üìä Calculated Timing (Astable)</label>
          <div style="background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-radius: 8px; padding: 12px; border: 1px solid #81c784;">
           <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px;">
            <div style="background: white; padding: 8px; border-radius: 5px; text-align: center;">
             <div style="font-size: 10px; color: #666; text-transform: uppercase;">Frequency</div>
             <div style="font-size: 16px; font-weight: 700; color: #2e7d32;">${tv.frequencyDisplay}</div>
            </div>
            <div style="background: white; padding: 8px; border-radius: 5px; text-align: center;">
             <div style="font-size: 10px; color: #666; text-transform: uppercase;">Duty Cycle</div>
             <div style="font-size: 16px; font-weight: 700; color: #1565c0;">${tv.dutyCycleDisplay}</div>
            </div>
           </div>
           <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px;">
            <div style="background: white; padding: 8px; border-radius: 5px; text-align: center;">
             <div style="font-size: 10px; color: #666; text-transform: uppercase;">HIGH Time (t‚ÇÅ)</div>
             <div style="font-size: 14px; font-weight: 600; color: #388e3c;">${tv.highTimeDisplay}</div>
            </div>
            <div style="background: white; padding: 8px; border-radius: 5px; text-align: center;">
             <div style="font-size: 10px; color: #666; text-transform: uppercase;">LOW Time (t‚ÇÇ)</div>
             <div style="font-size: 14px; font-weight: 600; color: #d32f2f;">${tv.lowTimeDisplay}</div>
            </div>
           </div>
           <div style="background: white; padding: 8px; border-radius: 5px; text-align: center;">
            <div style="font-size: 10px; color: #666; text-transform: uppercase;">Period</div>
            <div style="font-size: 14px; font-weight: 600; color: #5e35b1;">${tv.periodDisplay}</div>
           </div>
          </div>
         </div>
         <div class="property-group">
          <label class="property-label">üîß Detected Components</label>
          <div style="background: #f8f9fa; border-radius: 5px; padding: 10px; font-size: 12px;">
           <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #e0e0e0;">
            <span style="color: #666;">R1 (Vcc‚ÜíDIS)</span>
            <span style="font-weight: 600; color: #e65100;">${tv.r1Display || 'Not detected'}</span>
           </div>
           <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #e0e0e0;">
            <span style="color: #666;">R2 (DIS‚ÜíTHR)</span>
            <span style="font-weight: 600; color: #e65100;">${tv.r2Display || 'Not detected'}</span>
           </div>
           <div style="display: flex; justify-content: space-between; padding: 4px 0;">
            <span style="color: #666;">C (Timing Cap)</span>
            <span style="font-weight: 600; color: #1565c0;">${tv.capacitanceDisplay}</span>
           </div>
          </div>
         </div>
         <div class="property-group">
          <label class="property-label">üìê Astable Formulas</label>
          <div style="background: #fff8e1; border-radius: 5px; padding: 10px; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.8; color: #5d4037;">
           <div><strong>f</strong> = 1.44 / ((R1 + 2√óR2) √ó C)</div>
           <div><strong>t‚ÇÅ</strong> = 0.693 √ó (R1 + R2) √ó C</div>
           <div><strong>t‚ÇÇ</strong> = 0.693 √ó R2 √ó C</div>
           <div><strong>D</strong> = (R1 + R2) / (R1 + 2√óR2)</div>
          </div>
         </div>`;
       } else if (comp.monostableMode && tv.monostablePulse) {
        timingHtml = `
         <div class="property-group">
          <label class="property-label">üìä Calculated Timing (Monostable)</label>
          <div style="background: linear-gradient(135deg, #e3f2fd 0%, #e8eaf6 100%); border-radius: 8px; padding: 12px; border: 1px solid #64b5f6;">
           <div style="background: white; padding: 12px; border-radius: 5px; text-align: center; margin-bottom: 10px;">
            <div style="font-size: 10px; color: #666; text-transform: uppercase;">Pulse Width</div>
            <div style="font-size: 20px; font-weight: 700; color: #1565c0;">${tv.monostablePulseDisplay}</div>
           </div>
           <div style="font-size: 11px; color: #37474f; text-align: center;">
            Output goes HIGH for this duration when triggered
           </div>
          </div>
         </div>
         <div class="property-group">
          <label class="property-label">üîß Detected Components</label>
          <div style="background: #f8f9fa; border-radius: 5px; padding: 10px; font-size: 12px;">
           <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #e0e0e0;">
            <span style="color: #666;">R (Timing)</span>
            <span style="font-weight: 600; color: #e65100;">${tv.rDisplay || 'Not detected'}</span>
           </div>
           <div style="display: flex; justify-content: space-between; padding: 4px 0;">
            <span style="color: #666;">C (Timing Cap)</span>
            <span style="font-weight: 600; color: #1565c0;">${tv.capacitanceDisplay}</span>
           </div>
          </div>
         </div>
         <div class="property-group">
          <label class="property-label">üìê Monostable Formula</label>
          <div style="background: #fff8e1; border-radius: 5px; padding: 10px; font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8; color: #5d4037;">
           <div><strong>T</strong> = 1.1 √ó R √ó C</div>
           <div style="font-size: 10px; margin-top: 5px; color: #666;">Output pulse duration</div>
          </div>
         </div>`;
       }
      }
      
      panel.innerHTML = `
       <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 0;">
        <div style="font-size: 20px; font-weight: bold;">‚è±Ô∏è ${info.name}</div>
        <div style="font-size: 13px; opacity: 0.9; margin-top: 5px;">${info.description}</div>
       </div>
       <div class="property-group">
        <label class="property-label">Operating Mode</label>
        <div style="padding: 10px; background: ${modeBg}; border-radius: 5px; color: ${modeColor}; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px;">
         <span style="font-size: 18px;">${modeIcon}</span>
         <span>${modeText}</span>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Circuit Status</label>
        <div style="padding: 12px; background: ${statusBg}; border-radius: 5px; border: 2px solid ${statusColor};">
         <div style="font-size: 16px; font-weight: 700; color: ${statusColor}; margin-bottom: 5px;">
          ${statusIcon} ${statusText}
         </div>
         <div style="font-size: 11px; color: #666; line-height: 1.4;">
          ${comp.resetActive ? 
           'Pin 4 (RESET) is LOW - Output forced to LOW state' :
           (comp.hasPower ? 
           (comp.astableMode ?
            'Output oscillating automatically - LED will blink' :
            (comp.monostableMode ?
             (comp.outputState ? 'Pulse in progress - Output HIGH' : 'Waiting for trigger on Pin 2') :
             (comp.outputState ? 
              'Pin 3 (OUT) is HIGH - Can power connected components' : 
              'Pin 3 (OUT) is LOW - Waiting for trigger'))) : 
           'Connect Vcc (pin 8) to power and GND (pin 1) to ground')}
         </div>
        </div>
       </div>
       ${timingHtml}
       <div class="property-group">
        <label class="property-label">${comp.astableMode ? 'Astable Mode Operation' : (comp.monostableMode ? 'Monostable Mode Operation' : 'Bistable Mode Operation')}</label>
        <div style="background: #e8f4fd; border-radius: 5px; padding: 12px; font-size: 12px; line-height: 1.6;">
         ${comp.astableMode ?
          `<div style="margin-bottom: 8px;"><strong>‚ö° AUTO-OSCILLATION:</strong> Output toggles automatically</div>
           <div style="margin-bottom: 8px;"><strong>üîå Circuit:</strong> Pin 2 & 6 connected, capacitor to GND</div>
           <div><strong>üìä Timing:</strong> ${comp.timingValues ? 'Calculated from R1, R2, C values' : 'Connect R1, R2, C for timing'}</div>` :
          (comp.monostableMode ?
           `<div style="margin-bottom: 8px;"><strong>üéØ ONE-SHOT:</strong> Single pulse when triggered</div>
            <div style="margin-bottom: 8px;"><strong>‚ö° TRIGGER (Pin 2):</strong> Ground briefly to start pulse</div>
            <div><strong>üìä TIMING:</strong> Pulse width set by R √ó C values</div>` :
           `<div style="margin-bottom: 8px;"><strong>üîò TRIGGER (Pin 2):</strong> Ground to set output HIGH</div>
            <div style="margin-bottom: 8px;"><strong>üìà THRESHOLD (Pin 6):</strong> Connect to Vcc to set output LOW</div>
            <div><strong>üîÑ RESET (Pin 4):</strong> Ground to force output LOW</div>`
          )
         }
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Internal Thresholds (5V Supply)</label>
        <div style="background: #f3e5f5; border-radius: 5px; padding: 10px; font-size: 11px;">
         <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #e1bee7;">
          <span style="color: #666;">Trigger (‚Öì Vcc)</span>
          <span style="font-weight: 600; color: #7b1fa2;">~1.67V</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #e1bee7;">
          <span style="color: #666;">Threshold (‚Öî Vcc)</span>
          <span style="font-weight: 600; color: #7b1fa2;">~3.33V</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 4px 0;">
          <span style="color: #666;">Control Default</span>
          <span style="font-weight: 600; color: #7b1fa2;">~3.33V</span>
         </div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Specifications</label>
        <div style="background: #f8f9fa; border-radius: 5px; padding: 12px;">
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Supply Voltage</span>
          <span style="font-weight: 600; font-size: 12px;">${info.voltageRange}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e0e0e0;">
          <span style="color: #666; font-size: 12px;">Max Output</span>
          <span style="font-weight: 600; font-size: 12px;">${info.maxCurrent}</span>
         </div>
         <div style="display: flex; justify-content: space-between; padding: 6px 0;">
          <span style="color: #666; font-size: 12px;">Timing</span>
          <span style="font-weight: 600; font-size: 12px;">${info.timingFormula}</span>
         </div>
        </div>
       </div>
       <div class="property-group">
        <label class="property-label">Pin Reference</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 11px;">
         ${Object.entries(this.ne555PinData.pins).map(([num, pin]) => `
          <div style="background: #f5f5f5; padding: 6px 8px; border-radius: 4px; cursor: pointer;" onclick="simulator.selectedPin = ${num}; simulator.updatePropertiesPanel();">
           <strong>${num}</strong> - ${pin.name}
          </div>
         `).join('')}
        </div>
       </div>
       <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin-top: 15px; border-radius: 4px;">
        <div style="font-size: 12px; color: #856404; line-height: 1.5;">
         <strong>üí° Tip:</strong> Click on any pin to see detailed info. Add resistors and capacitors to see calculated timing!
        </div>
       </div>
      `;
     }
     return;
    }

    if (this.selectedWire) {
     const wire = this.selectedWire;
     const length = Math.sqrt(
      Math.pow(wire.end.x - wire.start.x, 2) + 
      Math.pow(wire.end.y - wire.start.y, 2)
     );
     
     panel.innerHTML = `
      <div class="property-group">
          <label class="property-label">Component Type</label>
          <input type="text" class="property-input" value="Wire Connection" readonly>
      </div>
      <div class="property-group">
          <label class="property-label">Start Position</label>
          <input type="text" class="property-input" value="(${Math.round(wire.start.x)}, ${Math.round(wire.start.y)})" readonly>
      </div>
      <div class="property-group">
          <label class="property-label">End Position</label>
          <input type="text" class="property-input" value="(${Math.round(wire.end.x)}, ${Math.round(wire.end.y)})" readonly>
      </div>
      <div class="property-group">
          <label class="property-label">Length</label>
          <input type="text" class="property-input" value="${Math.round(length)} pixels" readonly>
      </div>
      <div class="property-group">
          <label class="property-label">Color</label>
          <input type="color" class="property-input" value="${wire.color}"
                 onchange="simulator.updateWireProperty('color', this.value)">
      </div>
      <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin-top: 15px; border-radius: 4px;">
       <div style="font-size: 12px; color: #856404; line-height: 1.5;">
        <strong>üí° Tips:</strong><br>
        ‚Ä¢ Press <strong>Delete</strong> to remove this wire<br>
        ‚Ä¢ <strong>Click and drag</strong> to move the wire<br>
        ‚Ä¢ Connected wires will move together
       </div>
      </div>
     `;
     return;
    }

    if (!this.selectedComponent) {
     panel.innerHTML = '<p style="color: #999; font-size: 14px; text-align: center; margin-top: 50px;">Select a component or wire to view properties</p>';
     this.updateQuickTips(null);
     return;
    }

    const comp = this.selectedComponent;
    this.updateQuickTips(comp);
    panel.innerHTML = `
     <div class="property-group">
         <label class="property-label">Component Type</label>
         <input type="text" class="property-input" value="${comp.label}" readonly>
     </div>
     <div class="property-group">
         <label class="property-label">Position X</label>
         <input type="number" class="property-input" value="${Math.round(comp.x)}"
                onchange="simulator.updateComponentProperty('x', this.value)">
     </div>
     <div class="property-group">
         <label class="property-label">Position Y</label>
         <input type="number" class="property-input" value="${Math.round(comp.y)}"
                onchange="simulator.updateComponentProperty('y', this.value)">
     </div>
     <div class="property-group">
         <label class="property-label">Rotation</label>
         <input type="text" class="property-input" value="${comp.rotation || 0}¬∞" readonly>
     </div>
     ${comp.type === 'resistor' ? `
     <div class="property-group">
         <label class="property-label">Resistance Value</label>
         <select class="property-input" onchange="simulator.updateComponentProperty('value', this.value)">
          <option value="100Œ©" ${comp.value === '100Œ©' ? 'selected' : ''}>100Œ©</option>
          <option value="220Œ©" ${comp.value === '220Œ©' ? 'selected' : ''}>220Œ©</option>
          <option value="470Œ©" ${comp.value === '470Œ©' ? 'selected' : ''}>470Œ©</option>
          <option value="1kŒ©" ${comp.value === '1kŒ©' ? 'selected' : ''}>1kŒ©</option>
          <option value="2.2kŒ©" ${comp.value === '2.2kŒ©' ? 'selected' : ''}>2.2kŒ©</option>
          <option value="4.7kŒ©" ${comp.value === '4.7kŒ©' ? 'selected' : ''}>4.7kŒ©</option>
          <option value="10kŒ©" ${comp.value === '10kŒ©' ? 'selected' : ''}>10kŒ©</option>
          <option value="22kŒ©" ${comp.value === '22kŒ©' ? 'selected' : ''}>22kŒ©</option>
          <option value="47kŒ©" ${comp.value === '47kŒ©' ? 'selected' : ''}>47kŒ©</option>
          <option value="100kŒ©" ${comp.value === '100kŒ©' ? 'selected' : ''}>100kŒ©</option>
         </select>
     </div>
     ` : ''}
     ${comp.type === 'capacitor' ? `
     <div class="property-group">
         <label class="property-label">Capacitance Value</label>
         <select class="property-input" onchange="simulator.updateComponentProperty('value', this.value)">
          <option value="10pF" ${comp.value === '10pF' ? 'selected' : ''}>10pF</option>
          <option value="100pF" ${comp.value === '100pF' ? 'selected' : ''}>100pF</option>
          <option value="1nF" ${comp.value === '1nF' ? 'selected' : ''}>1nF</option>
          <option value="10nF" ${comp.value === '10nF' ? 'selected' : ''}>10nF</option>
          <option value="100nF" ${comp.value === '100nF' ? 'selected' : ''}>100nF</option>
          <option value="1¬µF" ${comp.value === '1¬µF' ? 'selected' : ''}>1¬µF</option>
          <option value="10¬µF" ${comp.value === '10¬µF' ? 'selected' : ''}>10¬µF</option>
          <option value="47¬µF" ${comp.value === '47¬µF' ? 'selected' : ''}>47¬µF</option>
          <option value="100¬µF" ${comp.value === '100¬µF' ? 'selected' : ''}>100¬µF</option>
          <option value="470¬µF" ${comp.value === '470¬µF' ? 'selected' : ''}>470¬µF</option>
         </select>
     </div>
     ` : ''}
     ${comp.type === 'led' ? `
     <div class="property-group">
         <label class="property-label">LED Color</label>
         <select class="property-input" onchange="simulator.updateLEDColor(this.value)">
          <option value="Red" ${comp.value === 'Red' ? 'selected' : ''}>Red</option>
          <option value="Yellow" ${comp.value === 'Yellow' ? 'selected' : ''}>Yellow</option>
          <option value="Blue" ${comp.value === 'Blue' ? 'selected' : ''}>Blue</option>
         </select>
     </div>
     ` : ''}
     ${comp.value && comp.type !== 'resistor' && comp.type !== 'capacitor' && comp.type !== 'led' ? `
     <div class="property-group">
         <label class="property-label">Value</label>
         <input type="text" class="property-input" value="${comp.value}"
                onchange="simulator.updateComponentProperty('value', this.value)">
     </div>
     ` : ''}
     ${comp.type === 'led' ? `
     <div class="property-group">
         <label class="property-label">Circuit Status</label>
         <div style="padding: 10px; background: ${comp.isPowered ? '#d4edda' : '#f8d7da'}; border-radius: 5px; border: 2px solid ${comp.isPowered ? '#28a745' : '#dc3545'};">
          <div style="font-size: 14px; font-weight: 600; color: ${comp.isPowered ? '#155724' : '#721c24'}; margin-bottom: 5px;">
           ${comp.isPowered ? 'üí° LED is ON' : '‚ö´ LED is OFF'}
          </div>
          <div style="font-size: 11px; color: #666; line-height: 1.4;">
           ${comp.isPowered ? 'Properly connected to power (+) and ground (-)' : 'Connect anode (+) to power and cathode (-) to ground'}
          </div>
         </div>
     </div>
     ` : ''}
     ${comp.type === 'switch' ? `
     <div class="property-group">
         <label class="property-label">Toggle Switch Status</label>
         <div style="padding: 10px; background: ${comp.isPressed ? '#d4edda' : '#f8d7da'}; border-radius: 5px; border: 2px solid ${comp.isPressed ? '#28a745' : '#dc3545'};">
          <div style="font-size: 14px; font-weight: 600; color: ${comp.isPressed ? '#155724' : '#721c24'}; margin-bottom: 5px;">
           ${comp.isPressed ? 'üü¢ Switch is CLOSED (ON)' : 'üî¥ Switch is OPEN (OFF)'}
          </div>
          <div style="font-size: 11px; color: #666; line-height: 1.4;">
           ${comp.isPressed ? 'Current can flow through the switch' : 'Click to toggle the switch ON/OFF'}
          </div>
         </div>
     </div>
     ` : ''}
     ${comp.type === 'button' ? `
     <div class="property-group">
         <label class="property-label">Momentary Button Status</label>
         <div style="padding: 10px; background: ${comp.isPressed ? '#d4edda' : '#f8d7da'}; border-radius: 5px; border: 2px solid ${comp.isPressed ? '#28a745' : '#dc3545'};">
          <div style="font-size: 14px; font-weight: 600; color: ${comp.isPressed ? '#155724' : '#721c24'}; margin-bottom: 5px;">
           ${comp.isPressed ? 'üü¢ Button PRESSED' : 'üî¥ Button RELEASED'}
          </div>
          <div style="font-size: 11px; color: #666; line-height: 1.4;">
           ${comp.isPressed ? 'Current flowing while held down' : 'Hold mouse down to activate'}
          </div>
         </div>
     </div>
     ` : ''}
     ${comp.type === '7400-series' ? `
     <div class="property-group">
         <label class="property-label">Chip Information</label>
         <div style="padding: 12px; background: #f8f9fa; border-radius: 5px; font-size: 13px; line-height: 1.6;">
          ${comp.chipType === '7400' ? `<strong>7400 - Quad 2-Input NAND Gate</strong><br>Four independent NAND gates. Output LOW only when both inputs are HIGH.` : ''}
          ${comp.chipType === '7402' ? `<strong>7402 - Quad 2-Input NOR Gate</strong><br>Four independent NOR gates. Output HIGH only when both inputs are LOW.` : ''}
          ${comp.chipType === '7404' ? `<strong>7404 - Hex Inverter (NOT Gate)</strong><br>Six independent inverters. Output is always the opposite of input.` : ''}
          ${comp.chipType === '7408' ? `<strong>7408 - Quad 2-Input AND Gate</strong><br>Four independent AND gates. Output HIGH only when both inputs are HIGH.` : ''}
          ${comp.chipType === '7432' ? `<strong>7432 - Quad 2-Input OR Gate</strong><br>Four independent OR gates. Output HIGH when any input is HIGH.` : ''}
         </div>
     </div>
     ` : ''}
     ${comp.pins ? `
     <div class="property-group">
         <label class="property-label">Pins</label>
         <input type="text" class="property-input" value="${comp.pins}" readonly>
     </div>
     ` : ''}
     <div class="property-group">
         <label class="property-label">Color</label>
         <input type="color" class="property-input" value="${comp.color}"
                onchange="simulator.updateComponentProperty('color', this.value)">
     </div>
    `;
   }

   updateQuickTips(component) {
    const tipsContainer = document.getElementById('quickTips');
    if (!tipsContainer) return;
    
    const tips = {
     'w65c02s': [
      { label: '40 Pins', text: 'Click pins to see detailed info' },
      { label: 'Drag', text: 'Click body/border to move' },
      { label: 'Power', text: 'Pin 1 (VSS) = GND, Pin 21 (VDD) = +5V' },
      { label: 'Clock', text: 'Pin 37 (PHI2) needs clock signal' }
     ],
     '28c256': [
      { label: 'EEPROM', text: '32KB program storage' },
      { label: 'Address', text: 'A0-A14 = 15 address lines' },
      { label: 'Data', text: 'D0-D7 = 8-bit data bus' },
      { label: 'Control', text: 'CEÃÖ, OEÃÖ, WEÃÖ for chip control' }
     ],
     'w65c22': [
      { label: 'VIA', text: 'Versatile Interface Adapter' },
      { label: 'I/O', text: 'Two 8-bit ports (PA, PB)' },
      { label: 'Timers', text: '2 programmable timers' },
      { label: 'Shift', text: 'Serial shift register' }
     ],
     'ne555': [
      { label: 'Modes', text: 'Astable, Monostable, Bistable' },
      { label: 'Astable', text: 'Add R1+R2+C for auto-oscillation' },
      { label: 'Monostable', text: 'Add R+C for one-shot pulse' },
      { label: 'Timing', text: 'Calculated from R/C values' },
      { label: 'Reset', text: 'Pin 4 LOW forces output LOW' },
      { label: 'Power', text: 'Pin 1=GND, Pin 8=VCC' }
     ],
     '7400-series': [
      { label: 'Logic IC', text: 'Select chip type from dropdown above' },
      { label: '7400', text: 'NAND - Output LOW when both inputs HIGH' },
      { label: '7402', text: 'NOR - Output HIGH only when both inputs LOW' },
      { label: '7404', text: 'NOT - Six inverters, output opposite of input' },
      { label: '7408', text: 'AND - Output HIGH only when both inputs HIGH' },
      { label: '7432', text: 'OR - Output HIGH when any input is HIGH' },
      { label: 'Power', text: 'Pin 7=GND, Pin 14=VCC (all types)' }
     ],
     'led': [
      { label: 'Polarity', text: 'Top pin (+) to power, bottom (-) to ground' },
      { label: 'Resistor', text: 'Always use resistor (220Œ©-1kŒ©)' },
      { label: 'Auto-detect', text: 'Lights when properly connected' },
      { label: 'Current', text: 'Typical: 10-20mA forward current' }
     ],
     'resistor': [
      { label: 'No Polarity', text: 'Can be connected either direction' },
      { label: 'LED Protection', text: 'Use with LEDs to limit current' },
      { label: 'Pull-up/down', text: 'Common values: 1kŒ©, 10kŒ©' },
      { label: 'Power', text: 'P = I¬≤R, check wattage rating' }
     ],
     'capacitor': [
      { label: 'Filtering', text: 'Smooths power supply noise' },
      { label: 'Decoupling', text: 'Place near IC power pins (0.1¬µF)' },
      { label: 'Timing', text: 'Used with 555 timer (RC circuits)' },
      { label: 'Common', text: '0.1¬µF, 1¬µF, 10¬µF values' }
     ],
     'button': [
      { label: 'Toggle', text: 'Click center to toggle state' },
      { label: 'Drag', text: 'Click border to move' },
      { label: 'Pull-up', text: 'Usually needs pull-up resistor' },
      { label: 'Debounce', text: 'May need capacitor for debouncing' }
     ],
     'crystal': [
      { label: 'Clock', text: 'Provides stable clock frequency' },
      { label: '6502', text: 'Common: 1MHz, 2MHz, 4MHz' },
      { label: 'Capacitors', text: 'Needs two 22pF caps to ground' },
      { label: 'Pins', text: 'Connect to PHI2 and PHI2O pins' }
     ],
     'power': [
      { label: '+5V Rail', text: 'Powers all ICs and components' },
      { label: 'Connect', text: 'Wire to VCC/VDD pins' },
      { label: 'Decoupling', text: 'Add 0.1¬µF cap near each IC' },
      { label: 'Current', text: 'Ensure adequate power supply' }
     ],
     'ground': [
      { label: 'GND Rail', text: 'Common reference for all signals' },
      { label: 'Connect', text: 'Wire to VSS/GND pins' },
      { label: 'Important', text: 'All grounds must connect together' },
      { label: 'Return Path', text: 'Completes all circuits' }
     ]
    };
    
    const defaultTips = [
     { label: 'Drag & Drop', text: 'Drag components onto breadboard' },
     { label: 'Wire Mode', text: 'Click two points to connect' },
     { label: 'Delete', text: 'Select and press Delete key' },
     { label: 'Move', text: 'Click and drag components' },
     { label: 'Rotate', text: 'Select component and press R key' }
    ];
    
    const tipsToShow = component && tips[component.type] ? tips[component.type] : defaultTips;
    const icon = component ? this.getComponentIcon(component.type) : 'üí°';
    
    let html = `<strong style="color: #1976D2;">${icon} Quick Tips:</strong>`;
    tipsToShow.forEach(tip => {
     html += `<span style="font-size: 13px; color: #555;"><strong>${tip.label}:</strong> ${tip.text}</span>`;
    });
    
    tipsContainer.innerHTML = html;
   }
   
   getComponentIcon(type) {
    const icons = {
     'w65c02s': 'üñ•Ô∏è',
     '28c256': 'üíæ',
     '62256': 'üß†',
     'w65c22': 'üîå',
     '7400-series': '‚ö°',
     'ne555': '‚è±Ô∏è',
     'led': 'üí°',
     'resistor': 'üìè',
     'capacitor': 'üîã',
     'button': 'üîò',
     'switch': 'üîò',
     'crystal': 'üíé',
     'potentiometer': 'üéöÔ∏è',
     'photoresistor': '‚òÄÔ∏è',
     'power': 'üîå',
     'ground': '‚èö'
    };
    return icons[type] || 'üí°';
   }

   updateComponentProperty(prop, value) {
    if (this.selectedComponent) {
     if (prop === 'x' || prop === 'y') {
      this.selectedComponent[prop] = parseFloat(value);
      this.updateLEDStates();
     } else if (prop === 'value') {
      // Value changes may affect circuit calculations (e.g., 555 timer)
      this.selectedComponent[prop] = value;
      this.updateLEDStates();
     } else {
      this.selectedComponent[prop] = value;
     }
     this.draw();
    }
   }

   updateLEDColor(colorName) {
    if (this.selectedComponent && this.selectedComponent.type === 'led') {
     const colorMap = {
      'Red': '#c0392b',
      'Yellow': '#f39c12',
      'Blue': '#2980b9'
     };
     this.selectedComponent.value = colorName;
     this.selectedComponent.color = colorMap[colorName] || '#c0392b';
     this.draw();
     this.updatePropertiesPanel();
    }
   }

   change7400ChipType(chipType) {
    if (this.selectedComponent && this.selectedComponent.type === '7400-series') {
     const chipLabels = {
      '7400': '7400',
      '7402': '7402',
      '7404': '7404',
      '7408': '7408',
      '7432': '7432'
     };
     this.selectedComponent.chipType = chipType;
     this.selectedComponent.label = chipLabels[chipType] || '7400';
     this.draw();
     this.updatePropertiesPanel();
     this.updateQuickTips(this.selectedComponent);
    }
   }

   updateWireProperty(prop, value) {
    if (this.selectedWire) {
     this.selectedWire[prop] = value;
     this.draw();
     this.updatePropertiesPanel();
    }
   }

   updateStatusBar() {
    document.getElementById('componentCount').textContent = this.components.length;
    document.getElementById('connectionCount').textContent = this.connections.length;
    
    let selectedText = 'None';
    if (this.selectedComponent) {
     selectedText = this.selectedComponent.label;
    } else if (this.selectedWire) {
     selectedText = 'Wire';
    }
    
    document.getElementById('selectedComponent').textContent = selectedText;
   }

   toggleConnectionMode() {
    this.connectionMode = !this.connectionMode;
    const modeIndicator = document.getElementById('connectionMode');
    modeIndicator.classList.toggle('active', this.connectionMode);
    
    // Update wire mode button appearance
    const wireModeBtn = document.getElementById('wireMode');
    const wireModeText = document.getElementById('wireModeText');
    if (this.connectionMode) {
     wireModeBtn.style.background = '#c0392b';
     wireModeBtn.style.color = 'white';
     wireModeBtn.textContent = 'Wire Mode ON';
     wireModeText.innerHTML = 'üîå Wire Mode Active: Click on two points to create a connection<br><small style="margin-top: 5px; display: block;">üí° Hold <strong>Ctrl</strong> to move wire endpoints | Press <strong>Esc</strong> or <strong>Right-click</strong> to cancel wire</small>';
     // Clear any pending connection start when turning mode back on
     this.connectionStart = null;
     this.canvas.style.cursor = 'crosshair';
    } else {
     wireModeBtn.style.background = '';
     wireModeBtn.style.color = '';
     wireModeBtn.textContent = 'Wire Mode OFF';
     this.editingWire = null;
     this.editingWirePoint = null;
     this.connectionStart = null;
     this.canvas.style.cursor = 'default';
    }
    this.draw();
   }

   toggleGrid() {
    this.showGrid = !this.showGrid;
    document.getElementById('gridStatus').textContent = this.showGrid ? 'ON' : 'OFF';
    this.draw();
   }

   deleteSelected() {
    if (this.selectedComponent) {
     const index = this.components.indexOf(this.selectedComponent);
     if (index > -1) {
      this.components.splice(index, 1);
      this.selectedComponent = null;
      this.updateLEDStates();
      this.draw();
      this.updatePropertiesPanel();
      this.updateStatusBar();
     }
    } else if (this.selectedWire) {
     const index = this.connections.indexOf(this.selectedWire);
     if (index > -1) {
      this.connections.splice(index, 1);
      this.selectedWire = null;
      this.updateLEDStates();
      this.draw();
      this.updatePropertiesPanel();
      this.updateStatusBar();
     }
    }
   }

   rotateSelected() {
    if (this.selectedComponent) {
     // Initialize rotation if not set
     if (typeof this.selectedComponent.rotation === 'undefined') {
      this.selectedComponent.rotation = 0;
     }
     
     // Rotate by 90 degrees
     this.selectedComponent.rotation = (this.selectedComponent.rotation + 90) % 360;
     
     // For non-square components, swap width and height to maintain proper positioning
     const comp = this.selectedComponent;
     if (comp.width !== comp.height) {
      // Swap width and height
      const oldWidth = comp.width;
      const oldHeight = comp.height;
      comp.width = oldHeight;
      comp.height = oldWidth;
      
      // Adjust position to keep component centered at same point
      const centerX = comp.x + oldWidth / 2;
      const centerY = comp.y + oldHeight / 2;
      comp.x = centerX - comp.width / 2;
      comp.y = centerY - comp.height / 2;
      
      // Snap to grid
      const snapped = this.snapToGrid(comp.x, comp.y);
      comp.x = snapped.x;
      comp.y = snapped.y;
     }
     
     this.draw();
     this.updatePropertiesPanel();
    } else if (this.selectedWire) {
     // Rotate wire by 90 degrees around its center
     const wire = this.selectedWire;
     const centerX = (wire.start.x + wire.end.x) / 2;
     const centerY = (wire.start.y + wire.end.y) / 2;
     
     // Rotate start point
     const startDx = wire.start.x - centerX;
     const startDy = wire.start.y - centerY;
     wire.start.x = centerX - startDy;
     wire.start.y = centerY + startDx;
     
     // Rotate end point
     const endDx = wire.end.x - centerX;
     const endDy = wire.end.y - centerY;
     wire.end.x = centerX - endDy;
     wire.end.y = centerY + endDx;
     
     // Snap to grid
     const gridSize = 20;
     wire.start.x = Math.round(wire.start.x / gridSize) * gridSize + gridSize / 2;
     wire.start.y = Math.round(wire.start.y / gridSize) * gridSize + gridSize / 2;
     wire.end.x = Math.round(wire.end.x / gridSize) * gridSize + gridSize / 2;
     wire.end.y = Math.round(wire.end.y / gridSize) * gridSize + gridSize / 2;
     
     this.updateLEDStates();
     this.draw();
     this.updatePropertiesPanel();
    }
   }

   clearCanvas() {
    if (confirm('Are you sure you want to clear all components and connections?')) {
     this.components = [];
     this.connections = [];
     this.selectedComponent = null;
     this.selectedWire = null;
     this.updateLEDStates();
     this.draw();
     this.updatePropertiesPanel();
     this.updateStatusBar();
    }
   }

   newProject() {
    this.clearCanvas();
   }

   saveProject() {
    const project = {
     components: this.components,
     connections: this.connections,
     version: '1.0'
    };
    const json = JSON.stringify(project, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '6502-breadboard-' + Date.now() + '.json';
    a.click();
    URL.revokeObjectURL(url);
   }

   loadProject() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = (e) => {
     const file = e.target.files[0];
     const reader = new FileReader();
     reader.onload = (event) => {
      try {
       const project = JSON.parse(event.target.result);
       this.components = project.components;
       this.connections = project.connections;
       this.draw();
       this.updateStatusBar();
      } catch (err) {
       alert('Error loading project: ' + err.message);
      }
     };
     reader.readAsText(file);
    };
    input.click();
   }

   exportImage() {
    const link = document.createElement('a');
    link.download = '6502-breadboard-' + Date.now() + '.png';
    link.href = this.canvas.toDataURL();
    link.click();
   }

   zoomIn() {
    this.zoom = Math.min(this.zoom + 0.1, 2.0);
    document.getElementById('zoomLevel').textContent = Math.round(this.zoom * 100) + '%';
    this.draw();
   }

   zoomOut() {
    this.zoom = Math.max(this.zoom - 0.1, 0.5);
    document.getElementById('zoomLevel').textContent = Math.round(this.zoom * 100) + '%';
    this.draw();
   }

   resetView() {
    this.zoom = 1.0;
    this.offset = { x: 0, y: 0 };
    document.getElementById('zoomLevel').textContent = '100%';
    this.draw();
   }

   autoRoute() {
    alert('Auto-routing feature coming soon! This will automatically suggest optimal wire routing based on 6502 schematics.');
   }
  }

  // Initialize the simulator
  const simulator = new BreadboardSimulator();
 </script>
<!-- InstanceEndEditable -->
<script>
  // embeddedScript
  // Debugging tool to adjust root link per localhost test, and github pages.

  var href = location.href;
  var pgHref = document.querySelectorAll("[href], [src]");
  if (href.indexOf("localhost") > -1) {
   let pgHrefLen = pgHref.length;
   for (i = 0; i < pgHrefLen; i++) {
    let curVal;
    if (pgHref[i].hasAttribute("href")) {
     curVal = pgHref[i].getAttribute("href");
     pgHref[i].setAttribute("href", curVal.replace("https://isocialpractice.github.io/interactive-html", ""));
    }
    if (pgHref[i].hasAttribute("src")) {
     curVal = pgHref[i].getAttribute("src");
     pgHref[i].setAttribute("src", curVal.replace("https://isocialpractice.github.io/interactive-html", ""));
    }
   }
  }
</script>
</body>
<!-- InstanceEnd --></html>